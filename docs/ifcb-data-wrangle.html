<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ifcb-port aransas – IFCB analysis | Port Aransas</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">IFCB analysis | Port Aransas</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./ifcb-data-wrangle.html" aria-current="page"> 
<span class="menu-text">Analysis</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#set-up" id="toc-set-up" class="nav-link active" data-scroll-target="#set-up"><span class="header-section-number">1</span> Set-up</a></li>
  <li><a href="#preliminary-input-data" id="toc-preliminary-input-data" class="nav-link" data-scroll-target="#preliminary-input-data"><span class="header-section-number">2</span> Preliminary input data</a>
  <ul class="collapse">
  <li><a href="#export-taxa-names-for-manual-curation" id="toc-export-taxa-names-for-manual-curation" class="nav-link" data-scroll-target="#export-taxa-names-for-manual-curation">Export taxa names for manual curation</a></li>
  <li><a href="#add-taxa-curated-to-cell-ids-and-carbon-data" id="toc-add-taxa-curated-to-cell-ids-and-carbon-data" class="nav-link" data-scroll-target="#add-taxa-curated-to-cell-ids-and-carbon-data">Add taxa curated to cell IDs and carbon data</a></li>
  <li><a href="#combine-carbon-and-cell-counts" id="toc-combine-carbon-and-cell-counts" class="nav-link" data-scroll-target="#combine-carbon-and-cell-counts"><span class="header-section-number">2.1</span> Combine carbon and cell counts</a></li>
  <li><a href="#add-seasons" id="toc-add-seasons" class="nav-link" data-scroll-target="#add-seasons"><span class="header-section-number">2.2</span> Add seasons</a></li>
  <li><a href="#data-checkpoint-option-here" id="toc-data-checkpoint-option-here" class="nav-link" data-scroll-target="#data-checkpoint-option-here"><span class="header-section-number">2.3</span> Data checkpoint option here</a></li>
  </ul></li>
  <li><a href="#import-gulf-metadata" id="toc-import-gulf-metadata" class="nav-link" data-scroll-target="#import-gulf-metadata"><span class="header-section-number">3</span> Import Gulf metadata</a>
  <ul class="collapse">
  <li><a href="#temperature-salinity" id="toc-temperature-salinity" class="nav-link" data-scroll-target="#temperature-salinity"><span class="header-section-number">3.1</span> Temperature &amp; Salinity</a></li>
  <li><a href="#river-height-gauge" id="toc-river-height-gauge" class="nav-link" data-scroll-target="#river-height-gauge"><span class="header-section-number">3.2</span> River height gauge</a></li>
  <li><a href="#rainfall" id="toc-rainfall" class="nav-link" data-scroll-target="#rainfall"><span class="header-section-number">3.3</span> Rainfall</a></li>
  <li><a href="#lunar" id="toc-lunar" class="nav-link" data-scroll-target="#lunar"><span class="header-section-number">3.4</span> Lunar</a></li>
  <li><a href="#tide-height" id="toc-tide-height" class="nav-link" data-scroll-target="#tide-height"><span class="header-section-number">3.5</span> Tide height</a></li>
  </ul></li>
  <li><a href="#combine-all-metadata" id="toc-combine-all-metadata" class="nav-link" data-scroll-target="#combine-all-metadata"><span class="header-section-number">4</span> Combine all metadata</a></li>
  <li><a href="#archive" id="toc-archive" class="nav-link" data-scroll-target="#archive"><span class="header-section-number">5</span> Archive</a>
  <ul class="collapse">
  <li><a href="#archive-1" id="toc-archive-1" class="nav-link" data-scroll-target="#archive-1"><span class="header-section-number">5.1</span> ARCHIVE</a></li>
  </ul></li>
  <li><a href="#combine-with-ifcb-data" id="toc-combine-with-ifcb-data" class="nav-link" data-scroll-target="#combine-with-ifcb-data"><span class="header-section-number">6</span> Combine with IFCB data</a></li>
  <li><a href="#ifcb-data-overview" id="toc-ifcb-data-overview" class="nav-link" data-scroll-target="#ifcb-data-overview"><span class="header-section-number">7</span> IFCB data overview</a>
  <ul class="collapse">
  <li><a href="#cells-carbon-and-carbon-per-cell" id="toc-cells-carbon-and-carbon-per-cell" class="nav-link" data-scroll-target="#cells-carbon-and-carbon-per-cell"><span class="header-section-number">7.1</span> Cells, Carbon, and carbon per cell</a>
  <ul class="collapse">
  <li><a href="#plot-biotic---all-years" id="toc-plot-biotic---all-years" class="nav-link" data-scroll-target="#plot-biotic---all-years">Plot biotic - all years</a></li>
  <li><a href="#plot-biotic---one-year" id="toc-plot-biotic---one-year" class="nav-link" data-scroll-target="#plot-biotic---one-year">Plot biotic - one year</a></li>
  </ul></li>
  <li><a href="#all-daily" id="toc-all-daily" class="nav-link" data-scroll-target="#all-daily"><span class="header-section-number">7.2</span> All daily</a></li>
  </ul></li>
  <li><a href="#a-focus-on-dinoflagellates-haptophytes-ciliates-and-diatoms" id="toc-a-focus-on-dinoflagellates-haptophytes-ciliates-and-diatoms" class="nav-link" data-scroll-target="#a-focus-on-dinoflagellates-haptophytes-ciliates-and-diatoms"><span class="header-section-number">8</span> A focus on Dinoflagellates, Haptophytes, Ciliates, and diatoms</a>
  <ul class="collapse">
  <li><a href="#plot-a-year-trend-at-phylum-level" id="toc-plot-a-year-trend-at-phylum-level" class="nav-link" data-scroll-target="#plot-a-year-trend-at-phylum-level">Plot a year trend at Phylum level</a></li>
  <li><a href="#plot-at-cell-type-level-within-each-class" id="toc-plot-at-cell-type-level-within-each-class" class="nav-link" data-scroll-target="#plot-at-cell-type-level-within-each-class"><span class="header-section-number">8.1</span> Plot at cell type level within each class</a>
  <ul class="collapse">
  <li><a href="#tile-plots" id="toc-tile-plots" class="nav-link" data-scroll-target="#tile-plots">Tile plots</a></li>
  <li><a href="#breakdown-stramenopiles" id="toc-breakdown-stramenopiles" class="nav-link" data-scroll-target="#breakdown-stramenopiles">Breakdown Stramenopiles</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#table-summaries" id="toc-table-summaries" class="nav-link" data-scroll-target="#table-summaries"><span class="header-section-number">9</span> Table summaries</a></li>
  <li><a href="#rda-analysis" id="toc-rda-analysis" class="nav-link" data-scroll-target="#rda-analysis"><span class="header-section-number">10</span> RDA analysis</a>
  <ul class="collapse">
  <li><a href="#subset-and-format-data" id="toc-subset-and-format-data" class="nav-link" data-scroll-target="#subset-and-format-data">Subset and format data</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">ifcb-port aransas</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="set-up" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Set-up</h1>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | warning: false</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(svglite)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'scales'

The following object is masked from 'package:purrr':

    discard

The following object is masked from 'package:readr':

    col_factor</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(treemapify)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(compositions); <span class="fu">library</span>(vegan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome to compositions, a package for compositional data analysis.
Find an intro with "? compositions"


Attaching package: 'compositions'

The following objects are masked from 'package:stats':

    anova, cor, cov, dist, var

The following object is masked from 'package:graphics':

    segments

The following objects are masked from 'package:base':

    %*%, norm, scale, scale.default

Loading required package: permute
Loading required package: lattice</code></pre>
</div>
</div>
</section>
<section id="preliminary-input-data" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Preliminary input data</h1>
<p>All data from Port Aransas. Counts by hour. Remove data before January 1 2008, as it was newly deployed and has some inconsistencies. Also using lubridate to convert to R-friendly date/time formats.</p>
<p>Time zone is UTC and units of carbon are pg C per cell.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(counts)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"input-data/counts_hourly_Hu.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use lubridate package to assign "date" format.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DAY =</span> <span class="fu">ymd_hms</span>(X)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE =</span> <span class="fu">date</span>(DAY),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(DAY),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">HOUR =</span> <span class="fu">hour</span>(DAY)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DAY, DATE, MONTH, HOUR, <span class="fu">everything</span>(), <span class="sc">-</span>X) <span class="sc">%&gt;%</span> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as_date</span>(DAY) <span class="sc">&gt;=</span> <span class="fu">as_date</span>(<span class="st">"2008-01-01"</span>) <span class="sc">&amp;</span> </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>           <span class="fu">as_date</span>(DAY) <span class="sc">&lt;=</span> <span class="fu">as_date</span>(<span class="st">"2017-08-24"</span>))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(counts)</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(counts<span class="sc">$</span>DAY)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2008-01-01 00:00:00 UTC" "2017-08-24 13:00:00 UTC"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(counts)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Carbon biomass by day. pgC per cell.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>carbon <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"input-data/carbon_hourly.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DAY =</span> <span class="fu">ymd_hms</span>(X)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE =</span> <span class="fu">date</span>(DAY),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(DAY),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">HOUR =</span> <span class="fu">hour</span>(DAY)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DAY, DATE, MONTH, HOUR, <span class="fu">everything</span>(), <span class="sc">-</span>X) <span class="sc">%&gt;%</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as_date</span>(DAY) <span class="sc">&gt;=</span> <span class="fu">as_date</span>(<span class="st">"2008-01-01"</span>) <span class="sc">&amp;</span> </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">as_date</span>(DAY) <span class="sc">&lt;=</span> <span class="fu">as_date</span>(<span class="st">"2017-08-24"</span>))</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># head(carbon)</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(carbon<span class="sc">$</span>DAY)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2008-01-01 00:00:00 UTC" "2017-08-24 23:00:00 UTC"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(carbon)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Subset so dataset includes “2008-01-01” to “2017-08-24”.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(carbon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  DAY       DATE MONTH HOUR Acantharian Akashiwo Alexandrium
1 2008-01-01 00:00:00 2008-01-01     1    0     0.00000 159.1142           0
2 2008-01-01 01:00:00 2008-01-01     1    1    16.71255   0.0000           0
3 2008-01-01 02:00:00 2008-01-01     1    2    92.22510 602.2458           0
4 2008-01-01 03:00:00 2008-01-01     1    3     0.00000   0.0000           0
5 2008-01-01 04:00:00 2008-01-01     1    4     0.00000   0.0000           0
6 2008-01-01 05:00:00 2008-01-01     1    5   100.86202   0.0000           0
   Anabaena Apedinella Asterionellopsis Asterionellopsis_single Azadinium
1 0.5594705   227.4076        10.444613                0.000000  0.000000
2 0.8932621   203.0570       301.299417                0.000000  7.635808
3 0.0000000   199.5952        27.849519                6.960548  4.693453
4 0.0000000   165.5366       212.613888                3.300985 16.970905
5 0.0000000   199.7480         8.774016               10.211567  0.000000
6 0.0000000   174.2188         0.000000                0.000000  0.000000
  Bacillaria     Beads Brachidinium   Centric Ceratoperidinium Chaetoceros
1          0 356.92220            0 2284.9158           0.0000    35.57445
2          0 217.92633            0  785.0579           0.0000    44.25895
3          0 135.63209            0 1240.9103           0.0000   169.80424
4          0  28.34153            0 1255.0982           0.0000    38.85008
5          0 260.85887            0  830.7046           0.0000   100.05454
6          0 156.10221            0 1430.1122         104.9276   167.53919
  Chaetoceros_danicus Chaetoceros_peruvianus Chaetoceros_simplex
1           11.131907                0.00000            5.861581
2            0.000000               26.89351            7.277983
3            0.000000                0.00000            3.062615
4            0.000000                0.00000           22.016262
5            6.194459                0.00000            5.736234
6            0.000000                0.00000           10.728793
  Chaetoceros_single Chaetoceros_socialis Chattonella
1           7.751966                    0           0
2           8.109594                    0           0
3          15.087342                    0           0
4          14.276835                    0           0
5           2.350216                    0           0
6          12.968174                    0           0
  Chrysochromulina_lanceolata Chrysochromulina_parkae Closterium   Coolia
1                      0.0000                1.720676   0.000000  43.7335
2                      0.0000               17.545814   0.000000   0.0000
3                      0.0000                1.277815   1.391040 139.3426
4                     21.9333               41.557662   0.000000 145.8089
5                      0.0000                3.084570   1.611014   0.0000
6                      0.0000               15.153733   0.000000   0.0000
  Corethron Cyanobacteria Cylindrotheca Cymatosira Cyrtostrombidium
1         0             0      276.8678   23.82860                0
2         0             0      290.8241   18.44607                0
3         0             0      278.1857  116.69991                0
4         0             0      379.2579   86.53513                0
5         0             0      228.4513   31.25462                0
6         0             0      219.3953   31.62481                0
  DactFragCeratul Dactyliosolen_blavyanus Dictyocha Didinium_gargantua
1        927.0760                0.000000   0.00000                  0
2       2490.1635                1.983361  57.31347                  0
3       1873.2355                2.353439   0.00000                  0
4        891.2001                0.000000  85.60992                  0
5       1887.8131                2.732978  66.44188                  0
6       1809.3684                0.000000 100.79414                  0
  Dinobryon Dinophysis Dinophysis_caudata Diploneis   Ditylum    Ebria
1  0.000000          0                  0 154.85249 199.50031 108.3531
2  0.000000          0                  0 111.76216 182.10206 160.4233
3  8.660182          0                  0 176.34121 110.42243  67.0137
4  0.000000          0                  0 427.86412 167.76852 127.6620
5  0.000000          0                  0 173.28080  51.08791 201.1159
6  0.000000          0                  0  97.48964  78.35581 272.4795
  Entomoneis   Ephemera  Eucampia Eucampia_cornuta  Euglenoid Eutreptiella
1  129.11290  663.01878  11.40573         28.88244  50.767818     115.3344
2  100.23604  168.02007 139.86070          0.00000 111.077581     153.5145
3   18.64435  759.94797  43.40430         29.12450 200.610001     255.6296
4   12.54304 2393.85107   0.00000         23.13847  33.228084     136.0085
5   75.00281  213.76582  20.86890          0.00000 105.230263     168.4753
6  200.52902   28.74022   0.00000         73.67337   8.659295     146.6764
  Guinardia Gyrodinium Hemiaulus_curved Hemiaulus_straight
1  42.59698    0.00000          0.00000              0.000
2 393.14919  285.14798          0.00000           1762.614
3 171.98312   44.33664          0.00000              0.000
4 368.02037  150.80662         56.46621              0.000
5 217.38941    0.00000          0.00000              0.000
6 116.94811   36.04988          0.00000              0.000
  Heterocapsa_pseudotriquetra Heterocapsa_rotundata Heterocapsa_spp
1                           0              883.7657        84.32878
2                           0              935.6493        90.63756
3                           0              843.1855       104.39442
4                           0              227.5817        58.83517
5                           0              844.2761        54.38783
6                           0              659.6235       206.62691
  Heterocapsa_triquetra Hypotrich Karenia_brevis Karenia_brevis_dividing
1             73.948275 1734.8510       35.50199                       0
2             61.221048  343.2910      264.06774                       0
3             17.288391 1923.3732      110.14966                       0
4             80.348719    0.0000      677.73856                       0
5             32.181855  933.4426      142.70146                       0
6              8.067885  788.6414      459.43747                       0
  Karenia_spp Karlodinium Karlodinium_dividing Katodinium Laboea Leptocylindrus
1    70.77031    242.8892             84.00577   93.78697      0      38.813833
2    28.33581    326.1653            235.98321  170.45018      0      57.992549
3     0.00000    843.3021            392.40080   90.51191      0      72.434146
4   144.76632   2024.0282            431.21147  111.71241      0      72.536109
5    32.51219    352.9497            283.54008   79.80020      0       9.908991
6   116.93383    830.8973            245.58324   50.21333      0      59.085242
  Licmophora Margalefidinium Mesodinium_rubrum Ochromonas Odontella
1     0.0000               0          355.1278    0.00000         0
2   159.8411               0          422.3798    0.00000         0
3     0.0000               0          935.4774   18.93644         0
4     0.0000               0          652.1271   28.10850         0
5     0.0000               0          560.9124   44.45191         0
6     0.0000               0          598.5335   62.18541         0
  Oltmannsiella Ophiaster Oxyrrhis Oxytoxum Oyster_larvae  Paralia Pediastrum
1             0  1.098665        0   0.0000             0   0.0000          0
2             0  1.734887        0   0.0000             0   0.0000          0
3             0  0.000000        0   0.0000             0   0.0000          0
4             0  0.000000        0   0.0000             0   0.0000          0
5             0  4.829147        0  14.6994             0 226.4716          0
6             0  2.505745        0   0.0000             0   0.0000          0
  Phaeocystis Phalacroma Pleurosigma Polykrikos Polykrikos_hartmannii
1    13.45897   57.18347    771.1238          0                     0
2    28.55544    0.00000    665.1714          0                     0
3    36.27922    0.00000    374.4915          0                     0
4     0.00000    0.00000   1307.3824          0                     0
5     0.00000    0.00000    848.7174          0                     0
6     0.00000  103.38433    715.3608          0                     0
  Prorocentrum_cordatum Prorocentrum_spp Prorocentrum_texanum
1              36.31667        145.40552             1970.409
2              43.46806        182.22308             1177.578
3             102.47874        190.11731             1716.082
4              71.45037         79.12482             1145.247
5             115.10111        140.12000             1996.496
6              72.75706        316.49286             1580.774
  Prorocentrum_triestinum Protoperidinium Pseudochattonella Pseudonitzschia
1                 0.00000               0          261.8416       34.905019
2                21.04571               0          184.5901        5.715618
3                35.33424               0          274.4620       10.801642
4                23.13830               0          508.2426        7.774752
5                 0.00000               0          269.8242        0.000000
6                32.19604               0          220.4636        6.815777
  Pterosperma Pyramimonas Pyrophacus Rhizosolenia Round_Cell Sarcodines
1    3.649177   30.836181          0      0.00000   4053.727    0.00000
2    5.731454    0.000000          0     32.52054   5263.875    0.00000
3   11.809347    6.028479          0      0.00000   7984.944   56.64459
4   11.061727    0.000000          0    825.90609  11488.035    0.00000
5    5.905120    8.526471          0     13.55650   4880.400    0.00000
6   17.063090    9.290905          0    103.05685   4945.824    0.00000
  Scenedesmus Scrippsiella Skeletonema Strobilidium_sp Strom_Strob_Mix
1           0    128.65560   350.32967       4368.6601        2307.397
2           0    156.49346   247.49358          0.0000        3151.893
3           0     71.42283    69.53333       2421.7704        3390.938
4           0     36.20241   241.77098        476.4875        3992.276
5           0    144.79919   219.57780          0.0000        1981.383
6           0    143.85807   301.61146          0.0000        4209.571
  Strombidium_capitatum Strombidium_conicum Surirella Teleaulax Thalassionema
1                     0                   0         0  4033.550     13.625773
2                     0                   0         0  4595.810      0.000000
3                     0                   0         0  4657.029     14.557199
4                     0                   0         0  3655.253      5.872861
5                     0                   0         0  3995.978      3.050031
6                     0                   0         0  3567.730     26.839530
  Thalassiosira  Tin_aggl Tin_hyal Tontoniidae Torodinium  Tripos
1      604.5675  172.5549   0.0000    43.42991   127.8151   0.000
2      393.5562  246.3975 548.1862   879.96400   151.9458   0.000
3      382.2679    0.0000   0.0000   537.86920   216.4731   0.000
4      584.7976 1310.2086   0.0000  1881.21257   212.9679   0.000
5      709.9663 1248.4286   0.0000  1370.18156   160.3497   0.000
6      758.6104    0.0000   0.0000  1736.42714   106.3492 533.143
  Tripos_horridum_muelleri Vicicitus_globosus  Warnowia auxospore   blurry
1                        0              0.000  62.86127 182.45738 16.65614
2                        0              0.000 125.99648  10.47694 48.81622
3                        0              0.000   0.00000  29.46951  0.00000
4                        0              0.000  68.11437   0.00000 57.91541
5                        0              0.000  58.54535  22.06747  3.05748
6                        0            250.663  53.18364   0.00000 36.95537
  bubble centric10 ciliate_small coccolithophorid cyano_chain_sm detritus
1      0  3165.549      264.8746         6.163301       0.000000 47026.01
2      0  3677.422      335.7066         0.000000       2.082921 51290.88
3      0  4037.916      485.3792         0.000000       1.781379 66321.66
4      0  3801.538      468.6007         0.000000       1.786669 74250.09
5      0  3551.326      402.0671         5.288532       5.063429 70300.44
6      0  2734.893      265.2576         0.000000       2.832968 60053.17
  dino_mix fecal_pellets   filament flagellate freshwater_green  pennate
1 1111.496        0.0000   1.847225   400.8619         5.372972 441.8939
2 1142.286     2850.8347   9.118455   549.6867         0.000000 520.9217
3 1631.814        0.0000 128.092857   667.4675         0.000000 453.1319
4 1387.996      762.3384   0.000000   705.2578         0.000000 500.3778
5 1224.238        0.0000   2.683701   399.3128         0.000000 369.1969
6 1253.859     1485.0228   2.411859   349.3765         6.455284 608.7881
  pennate_rod raphidophytes scuticociliates zooplankton unclassified
1           0      156.3684               0           0     922.8547
2           0      359.9536               0           0    1383.6751
3           0      844.1014               0           0    2683.1928
4           0     1374.8297               0           0    2342.7865
5           0      330.8877               0           0    1050.7215
6           0      666.1677               0           0    1293.4999</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  DAY       DATE MONTH HOUR Acantharian   Akashiwo Alexandrium
1 2008-01-01 00:00:00 2008-01-01     1    0  0.00000000 0.07825092           0
2 2008-01-01 01:00:00 2008-01-01     1    1  0.12069528 0.00000000           0
3 2008-01-01 02:00:00 2008-01-01     1    2  0.08140768 0.08140768           0
4 2008-01-01 03:00:00 2008-01-01     1    3  0.00000000 0.00000000           0
5 2008-01-01 04:00:00 2008-01-01     1    4  0.00000000 0.00000000           0
6 2008-01-01 05:00:00 2008-01-01     1    5  0.07820292 0.00000000           0
    Anabaena Apedinella Asterionellopsis Asterionellopsis_single  Azadinium
1 0.07825092   8.238423       0.07790281              0.00000000 0.00000000
2 0.12169322   7.514043       0.12169322              0.00000000 0.12069528
3 0.00000000   6.473308       0.16296764              0.07970263 0.07970263
4 0.00000000   4.741421       0.23710975              0.11865166 0.23710975
5 0.00000000   6.574869       0.07858612              0.08012602 0.00000000
6 0.00000000   5.540887       0.00000000              0.00000000 0.00000000
  Bacillaria     Beads Brachidinium  Centric Ceratoperidinium Chaetoceros
1          0 5.8114178            0 2.824974       0.00000000   0.7857364
2          0 3.3934390            0 2.297202       0.00000000   0.9695540
3          0 2.5039088            0 2.499890       0.00000000   0.8874161
4          0 0.4746066            0 3.082814       0.00000000   0.8295938
5          0 3.7271809            0 2.852072       0.00000000   0.8722646
6          0 2.5893713            0 2.643123       0.07820292   1.1695756
  Chaetoceros_danicus Chaetoceros_peruvianus Chaetoceros_simplex
1          0.07790281              0.0000000           0.3932605
2          0.00000000              0.1206953           0.3630838
3          0.00000000              0.0000000           0.1629676
4          0.00000000              0.0000000           0.4740259
5          0.07858612              0.0000000           0.3148155
6          0.00000000              0.0000000           0.5428584
  Chaetoceros_single Chaetoceros_socialis Chattonella
1         0.39064684                    0           0
2         0.36208583                    0           0
3         0.72986813                    0           0
4         0.59267758                    0           0
5         0.07858612                    0           0
6         0.38783095                    0           0
  Chrysochromulina_lanceolata Chrysochromulina_parkae Closterium    Coolia
1                   0.0000000              0.07825092 0.00000000 0.0790356
2                   0.0000000              0.60647021 0.00000000 0.0000000
3                   0.0000000              0.08155996 0.08155996 0.1594053
4                   0.1184581              0.82978733 0.00000000 0.1184581
5                   0.0000000              0.15717223 0.07858612 0.0000000
6                   0.0000000              0.39308219 0.00000000 0.0000000
  Corethron Cyanobacteria Cylindrotheca Cymatosira Cyrtostrombidium
1         0             0      14.74068  0.1565018                0
2         0             0      14.30392  0.2423885                0
3         0             0      12.13491  0.5686055                0
4         0             0      13.04181  0.5926776                0
5         0             0      11.54758  0.3176598                0
6         0             0      11.25612  0.2344665                0
  DactFragCeratul Dactyliosolen_blavyanus  Dictyocha Didinium_gargantua
1        1.568422              0.00000000 0.00000000                  0
2        2.909660              0.12069528 0.12169322                  0
3        2.184337              0.16126259 0.00000000                  0
4        1.896878              0.00000000 0.11845809                  0
5        2.530979              0.07870389 0.08012602                  0
6        2.482845              0.00000000 0.15557435                  0
  Dinobryon Dinophysis Dinophysis_caudata Diploneis    Ditylum     Ebria
1 0.0000000          0                  0 0.3134402 0.23518933 0.4699421
2 0.0000000          0                  0 0.3630838 0.12069528 0.7281634
3 0.1629676          0                  0 0.6467554 0.07970263 0.2409652
4 0.0000000          0                  0 0.7113292 0.11845809 0.1186517
5 0.0000000          0                  0 0.3146978 0.08012602 0.6309354
6 0.0000000          0                  0 0.2322566 0.07820292 0.6290693
  Entomoneis   Ephemera  Eucampia Eucampia_cornuta  Euglenoid Eutreptiella
1  0.7063527 0.39212774 0.0790356        0.0790356 0.23518933    0.9396245
2  0.6064702 0.60746816 0.4837790        0.0000000 0.60746816    1.2129404
3  0.1611103 0.88927339 0.2409652        0.1628154 0.40579018    2.0181115
4  0.1186517 0.71132924 0.0000000        0.1184581 0.23710975    1.0668971
5  0.3162377 0.16025204 0.1571722        0.0000000 0.55792009    1.3486365
6  0.7049201 0.07820292 0.0000000        0.1564058 0.07889212    1.0133120
  Guinardia Gyrodinium Hemiaulus_curved Hemiaulus_straight
1 0.1569384 0.00000000        0.0000000          0.0000000
2 0.2423885 0.12069528        0.0000000          0.1216932
3 0.4054856 0.08140768        0.0000000          0.0000000
4 0.3559550 0.23710975        0.1184581          0.0000000
5 0.5593422 0.00000000        0.0000000          0.0000000
6 0.2337773 0.07668224        0.0000000          0.0000000
  Heterocapsa_pseudotriquetra Heterocapsa_rotundata Heterocapsa_spp
1                           0             19.284475       0.6284499
2                           0             19.513771       0.7271655
3                           0             16.613821       0.8077134
4                           0              4.741034       0.3553743
5                           0             17.124676       0.3992080
6                           0             13.926069       1.3252922
  Heterocapsa_triquetra Hypotrich Karenia_brevis Karenia_brevis_dividing
1            0.78390737 0.6284499      0.1561537                       0
2            0.72716549 0.2423885      0.3640817                       0
3            0.16296764 0.8131331      0.1628154                       0
4            0.59287115 0.0000000      0.8301745                       0
5            0.23587612 0.4777941      0.3963637                       0
6            0.07820292 0.3886624      0.7788455                       0
  Karenia_spp Karlodinium Karlodinium_dividing Katodinium Laboea Leptocylindrus
1  0.07903560    3.532283             1.175599  0.6288864      0      1.0198814
2  0.12169322    4.968465             3.033349  0.9685560      0      1.0922451
3  0.00000000   11.359961             4.286809  0.8092662      0      0.6481559
4  0.23730331   26.204014             4.622769  0.7117164      0      0.9478583
5  0.07870389    5.300670             3.564438  0.7097571      0      0.3161199
6  0.23446647   11.348683             2.962969  0.5435476      0      1.0170426
  Licmophora Margalefidinium Mesodinium_rubrum Ochromonas Odontella
1  0.0000000               0         0.7823380 0.00000000         0
2  0.1206953               0         0.8478608 0.00000000         0
3  0.0000000               0         1.4574221 0.08155996         0
4  0.0000000               0         1.3045875 0.11845809         0
5  0.0000000               0         1.1070719 0.07870389         0
6  0.0000000               0         1.1697178 0.15709504         0
  Oltmannsiella  Ophiaster Oxyrrhis   Oxytoxum Oyster_larvae    Paralia
1             0 0.07825092        0 0.00000000             0 0.00000000
2             0 0.12069528        0 0.00000000             0 0.00000000
3             0 0.00000000        0 0.00000000             0 0.00000000
4             0 0.00000000        0 0.00000000             0 0.00000000
5             0 0.16025204        0 0.08012602             0 0.07858612
6             0 0.07668224        0 0.00000000             0 0.00000000
  Pediastrum Phaeocystis Phalacroma Pleurosigma Polykrikos
1          0  0.07903560 0.07903560   0.4692459          0
2          0  0.12069528 0.00000000   0.4847770          0
3          0  0.08140768 0.00000000   0.3223729          0
4          0  0.00000000 0.00000000   0.7117164          0
5          0  0.00000000 0.00000000   0.3976681          0
6          0  0.00000000 0.07668224   0.7028525          0
  Polykrikos_hartmannii Prorocentrum_cordatum Prorocentrum_spp
1                     0             0.2344046       0.07825092
2                     0             0.2413906       0.12069528
3                     0             0.4039329       0.08140768
4                     0             0.2371097       0.11865166
5                     0             0.7121303       0.07870389
6                     0             0.3922507       0.15709504
  Prorocentrum_texanum Prorocentrum_triestinum Protoperidinium
1            0.9404092              0.00000000               0
2            0.6064702              0.12169322               0
3            0.8875683              0.08140768               0
4            0.5926776              0.11865166               0
5            0.9525083              0.00000000               0
6            0.7795347              0.15557435               0
  Pseudochattonella Pseudonitzschia Pterosperma Pyramimonas Pyrophacus
1         0.6287980       0.4703787   0.1569384  0.23710680          0
2         0.6074682       0.1216932   0.2423885  0.00000000          0
3         1.3763190       0.2425180   0.4834832  0.07970263          0
4         1.7780327       0.1184581   0.4740259  0.00000000          0
5         1.1901599       0.0000000   0.2361117  0.08012602          0
6         1.1673657       0.1577842   0.7011895  0.07889212          0
  Rhizosolenia Round_Cell Sarcodines Scenedesmus Scrippsiella Skeletonema
1    0.0000000   88.59796  0.0000000           0    1.1758582   1.0965629
2    0.2413906  107.65342  0.0000000           0    0.9695540   1.3306419
3    0.0000000  138.97413  0.1629676           0    0.7266103   0.9671187
4    0.2373033  177.48836  0.0000000           0    0.2369162   0.9476647
5    0.1602520   86.06848  0.0000000           0    0.7891765   0.7921385
6    0.1555744   89.23177  0.0000000           0    0.5442368   1.0922041
  Strobilidium_sp Strom_Strob_Mix Strombidium_capitatum Strombidium_conicum
1       0.1561537        2.196436                     0                   0
2       0.0000000        1.815419                     0                   0
3       0.1612626        2.761163                     0                   0
4       0.1184581        2.963775                     0                   0
5       0.0000000        1.972941                     0                   0
6       0.0000000        2.644502                     0                   0
  Surirella Teleaulax Thalassionema Thalassiosira  Tin_aggl  Tin_hyal
1         0  60.87996    0.23405654      4.316538 0.0790356 0.0000000
2         0  68.01542    0.00000000      4.606379 0.1206953 0.1206953
3         0  62.79700    0.16296764      4.536604 0.0000000 0.0000000
4         0  41.61092    0.11845809      4.267588 0.3557614 0.0000000
5         0  57.97770    0.08012602      6.012565 0.2388382 0.0000000
6         0  50.10976    0.23598715      5.292187 0.0000000 0.0000000
  Tontoniidae Torodinium   Tripos Tripos_horridum_muelleri Vicicitus_globosus
1  0.07825092  0.2340565 0.000000                        0         0.00000000
2  0.48377905  0.2423885 0.000000                        0         0.00000000
3  0.24267027  0.3223729 0.000000                        0         0.00000000
4  0.59306471  0.3557614 0.000000                        0         0.00000000
5  0.63212204  0.2372983 0.000000                        0         0.00000000
6  0.70064262  0.2337773 0.157095                        0         0.07820292
    Warnowia auxospore     blurry bubble centric10 ciliate_small
1 0.15807120 0.2363221 0.31265557      0  92.48403      3.056765
2 0.24238850 0.1216932 0.12169322      0 104.37569      3.878216
3 0.00000000 0.2426703 0.00000000      0 101.54038      4.693696
4 0.23730331 0.0000000 1.30458752      0  80.25884      4.385659
5 0.08012602 0.1602520 0.08012602      0  97.38284      3.555670
6 0.07820292 0.0000000 0.53677566      0  68.32543      2.640082
  coccolithophorid cyano_chain_sm detritus dino_mix fecal_pellets   filament
1       0.07825092      0.0000000 119.7167 5.408481     0.0000000 0.07790281
2       0.00000000      0.2423885 171.9482 6.061708     0.1216932 0.12069528
3       0.00000000      0.1611103 152.3281 7.525549     0.0000000 0.24437532
4       0.00000000      0.2369162 115.1095 5.928131     0.1184581 0.00000000
5       0.07870389      0.2359939 159.8917 6.096604     0.0000000 0.15871214
6       0.00000000      0.3089388 142.3614 5.929954     0.1555744 0.23598715
  flagellate freshwater_green  pennate pennate_rod raphidophytes
1  10.592930       0.15615373 8.158166           0     0.4711633
2  13.444079       0.00000000 9.338444           0     1.4543310
3  14.822403       0.00000000 7.266468           0     3.0894427
4  13.041810       0.00000000 5.217576           0     6.0473631
5  10.112177       0.00000000 5.773491           0     1.1054142
6   7.471344       0.07668224 6.006636           0     2.3079282
  scuticociliates zooplankton unclassified
1               0           0     8.476144
2               0           0     9.940922
3               0           0    12.690518
4               0           0    15.294643
5               0           0     8.392531
6               0           0     8.798419</code></pre>
</div>
</div>
<section id="export-taxa-names-for-manual-curation" class="level3">
<h3 class="anchored" data-anchor-id="export-taxa-names-for-manual-curation">Export taxa names for manual curation</h3>
<p>Export for manual curation</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tax_export &lt;- counts %&gt;% </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#     pivot_longer(cols = -c(DAY), names_to = "CELL_ID", values_to = "COUNT") %&gt;% #Add in time here when we have it.</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     select(CELL_ID) %&gt;% distinct()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="add-taxa-curated-to-cell-ids-and-carbon-data" class="level3">
<h3 class="anchored" data-anchor-id="add-taxa-curated-to-cell-ids-and-carbon-data">Add taxa curated to cell IDs and carbon data</h3>
<p>Siddarth contributed to this taxa list.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>tax_curated <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"input-data/tax-list.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CELL_ID<span class="sc">:</span>Species) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Add to cell ID information</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>counts_long_wtax <span class="ot">&lt;-</span> counts <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(DAY, DATE, MONTH, HOUR), <span class="at">names_to =</span> <span class="st">"CELL_ID"</span>, <span class="at">values_to =</span> <span class="st">"COUNT"</span>, <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COUNT <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tax_curated)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(CELL_ID)`</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(counts_long_wtax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 16
  DAY                 DATE       MONTH  HOUR CELL_ID           COUNT
  &lt;dttm&gt;              &lt;date&gt;     &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;             &lt;dbl&gt;
1 2008-01-01 00:00:00 2008-01-01     1     0 Akashiwo         0.0783
2 2008-01-01 00:00:00 2008-01-01     1     0 Anabaena         0.0783
3 2008-01-01 00:00:00 2008-01-01     1     0 Apedinella       8.24  
4 2008-01-01 00:00:00 2008-01-01     1     0 Asterionellopsis 0.0779
5 2008-01-01 00:00:00 2008-01-01     1     0 Beads            5.81  
6 2008-01-01 00:00:00 2008-01-01     1     0 Centric          2.82  
# ℹ 10 more variables: COURSE_CLASSIFICATION &lt;chr&gt;, TYPE &lt;chr&gt;, Domain &lt;chr&gt;,
#   Supergroup &lt;chr&gt;, Phylum &lt;chr&gt;, Class &lt;chr&gt;, Order &lt;chr&gt;, Family &lt;chr&gt;,
#   Genus &lt;chr&gt;, Species &lt;chr&gt;</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># range(counts_long_wtax$COUNT)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Add to carbon data</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>carbon_long_wtax <span class="ot">&lt;-</span> carbon <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(DAY, DATE, MONTH, HOUR), <span class="at">names_to =</span> <span class="st">"CELL_ID"</span>, <span class="at">values_to =</span> <span class="st">"CARBON"</span>, <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CARBON <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tax_curated)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(CELL_ID)`</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(carbon_long_wtax)</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># range(carbon_long_wtax$CARBON)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="combine-carbon-and-cell-counts" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="combine-carbon-and-cell-counts"><span class="header-section-number">2.1</span> Combine carbon and cell counts</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>combined_gom_long <span class="ot">&lt;-</span> carbon_long_wtax <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(counts_long_wtax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(DAY, DATE, MONTH, HOUR, CELL_ID,
COURSE_CLASSIFICATION, TYPE, Domain, Supergroup, Phylum, Class, Order, Family,
Genus, Species)`</code></pre>
</div>
</div>
<p>Types of classifications in dataset.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(combined_gom_long<span class="sc">$</span>COURSE_CLASSIFICATION)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
      Bacteria   Biol unknown  Cyanobacteria    IFCB excess         Larvae 
         23128         470682          54241         247756           2200 
Microeukaryote 
       4193189 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(combined_gom_long<span class="sc">$</span>TYPE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Biol unknown         Cell    Cell type     Non-biol 
      336583      3876186       599772       178655 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(combined_gom_long)</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># table(combined_gom_long$COURSE_CLASSIFICATION)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<blockquote class="blockquote">
<p>What is the range of cellular carbon for each cell ID?</p>
</blockquote>
<p>There are 130 entries.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(combined_gom_long<span class="sc">$</span>CELL_ID))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 130</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(combined_gom_long<span class="sc">$</span>Phylum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Dinoflagellate" "Cyanobacteria"  "Ochrophyta"     ""              
 [5] "Haptophyta"     "Cnidaria"       "Cercozoa"       "Euglenozoa"    
 [9] "Ciliophora"     "Chlorophyta"    "Cryptophyta"    "Retaria"       
[13] "Charophyta"    </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>rm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"IFCB excess"</span>, <span class="st">"Larvae"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># hist(combined_gom_long$CARBON)</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>combined_gom_long <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(!(COURSE_CLASSIFICATION %in% rm)) %&gt;% </span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COURSE_CLASSIFICATION <span class="sc">==</span> <span class="st">"Microeukaryote"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(Supergroup == "Alveolata") %&gt;% </span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> CELL_ID, <span class="at">y =</span> CARBON, <span class="at">fill =</span> Phylum)) <span class="sc">+</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(Phylum), <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">space =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_wrap(vars(Phylum), scales = "free", as.table = FALSE) +</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="fu">bquote</span>(<span class="st">"pg C"</span><span class="sc">~</span>cell<span class="sc">^-</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">"outside"</span>,</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#d9d9d9"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="2688"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ?facet_wrap()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="add-seasons" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="add-seasons"><span class="header-section-number">2.2</span> Add seasons</h2>
<p>Make data frames to assign season</p>
<p>Spring = March 1 - May 31 Summer = June 1 - Aug 31 Fall = Sept 1 - Nov 30 Winter = Dec 1 - Feb (March 1 (-1))</p>
<p>Make a new dataframe to just add seasons (manually) to the date. I’m subsetting to 2024 to include leap day years.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df_season <span class="ot">&lt;-</span> counts <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(DAY, DATE, MONTH, HOUR), <span class="at">names_to =</span> <span class="st">"CELL_ID"</span>, <span class="at">values_to =</span> <span class="st">"COUNT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATA_GAP =</span> <span class="fu">case_when</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(COUNT) <span class="sc">~</span> <span class="st">"Missing"</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Not missing"</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_tmp =</span>  <span class="fu">as.Date</span>(<span class="fu">format</span>(DAY, <span class="st">'2024-%m-%d'</span>)), </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">SEASON =</span> <span class="fu">case_when</span>(<span class="fu">between</span>(date_tmp, <span class="fu">ymd</span>(<span class="st">'2024-03-01'</span>), <span class="fu">ymd</span>(<span class="st">'2024-05-31'</span>)) <span class="sc">~</span> <span class="st">"Spring"</span>,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">between</span>(date_tmp, <span class="fu">ymd</span>(<span class="st">'2024-06-01'</span>), <span class="fu">ymd</span>(<span class="st">'2024-08-31'</span>)) <span class="sc">~</span> <span class="st">"Summer"</span>, </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">between</span>(date_tmp, <span class="fu">ymd</span>(<span class="st">'2024-09-01'</span>), <span class="fu">ymd</span>(<span class="st">'2024-11-30'</span>)) <span class="sc">~</span> <span class="st">"Fall"</span>, </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Winter"</span>)) <span class="sc">%&gt;%</span> <span class="co"># Winter needs to be "else" because you can't select between.</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DAY, date_tmp, SEASON, DATA_GAP) <span class="sc">|&gt;</span> <span class="fu">distinct</span>() <span class="sc">|&gt;</span> </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YEAR =</span> <span class="fu">year</span>(DAY),</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(DAY),</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">DATE =</span> <span class="fu">day</span>(DAY),</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">HOUR =</span> <span class="fu">hour</span>(DAY)) <span class="sc">|&gt;</span> </span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SEASON) <span class="sc">|&gt;</span> </span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month_start_tmp =</span> <span class="fu">case_when</span>(</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    SEASON <span class="sc">==</span> <span class="st">"Winter"</span> <span class="sc">~</span> <span class="fu">max</span>(MONTH),</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">min</span>(MONTH)),</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_start_tmp =</span> <span class="fu">case_when</span>(SEASON <span class="sc">==</span> <span class="st">"Winter"</span> <span class="sc">~</span> YEAR <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>                               <span class="cn">TRUE</span> <span class="sc">~</span> YEAR),</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month_end_tmp =</span> <span class="fu">case_when</span>(</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>    SEASON <span class="sc">==</span> <span class="st">"Winter"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">max</span>(MONTH))) <span class="sc">|&gt;</span> </span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SEASON, MONTH) <span class="sc">|&gt;</span> </span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">day_start_tmp =</span> <span class="fu">min</span>(<span class="fu">day</span>(DAY)),</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">day_end_tmp =</span> <span class="fu">case_when</span>(</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>           (SEASON <span class="sc">==</span> <span class="st">"Winter"</span> <span class="sc">&amp;</span> <span class="fu">leap_year</span>(YEAR) <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="dv">29</span>,</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>           (SEASON <span class="sc">==</span> <span class="st">"Winter"</span> <span class="sc">&amp;</span> <span class="fu">leap_year</span>(YEAR) <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">~</span> <span class="dv">28</span>,</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>           (SEASON <span class="sc">==</span> <span class="st">"Summer"</span> <span class="sc">|</span> SEASON <span class="sc">==</span> <span class="st">"Spring"</span>) <span class="sc">~</span> <span class="dv">31</span>,</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>           SEASON <span class="sc">==</span> <span class="st">"Fall"</span> <span class="sc">~</span> <span class="dv">30</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>         )) <span class="sc">|&gt;</span> </span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"start"</span>, year_start_tmp, month_start_tmp, day_start_tmp, <span class="at">sep =</span> <span class="st">"-"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"end"</span>, YEAR, month_end_tmp, day_end_tmp, <span class="at">sep =</span> <span class="st">"-"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">START =</span> <span class="fu">ymd</span>(start),</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">END =</span> <span class="fu">ymd</span>(end),</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">START_noy =</span> <span class="fu">mdy</span>(<span class="fu">paste</span>(<span class="fu">month</span>(START), <span class="fu">day</span>(START), <span class="st">"2024"</span>, <span class="at">sep =</span> <span class="st">"-"</span>)),</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">END_noy =</span> <span class="fu">mdy</span>(<span class="fu">paste</span>(<span class="fu">month</span>(END), <span class="fu">day</span>(END), <span class="st">"2024"</span>, <span class="at">sep =</span> <span class="st">"-"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DAY, DATE, MONTH, YEAR, HOUR, SEASON, START, END, START_noy, END_noy) <span class="sc">|&gt;</span> <span class="fu">distinct</span>()</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a><span class="co"># head(df_season)</span></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a><span class="co"># View(df_season |&gt; select(SEASON, START, </span><span class="re">END</span><span class="co">) |&gt; distinct())</span></span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>df_oneyear <span class="ot">&lt;-</span> df_season <span class="sc">|&gt;</span> </span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE =</span> <span class="fu">mdy</span>(<span class="fu">paste</span>(<span class="fu">month</span>(DAY), <span class="fu">day</span>(DAY), <span class="st">"2024"</span>, <span class="at">sep =</span> <span class="st">"-"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SEASON, START_noy, END_noy, DATE) <span class="sc">|&gt;</span> </span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(!(SEASON == "Winter" &amp; (month(START_noy) == 12))) |&gt; </span></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a><span class="co"># head(df_oneyear)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Test seasonal plot</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot multiple years</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_season, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as_date</span>(DAY))) <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> (<span class="fu">filter</span>(df_season, SEASON <span class="sc">==</span> <span class="st">"Fall"</span>)), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"#cc5500"</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> START, <span class="at">xmax =</span> END, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">10000</span>)) <span class="sc">+</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> (<span class="fu">filter</span>(df_season, SEASON <span class="sc">==</span> <span class="st">"Spring"</span>)), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"#bccbae"</span>,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> START, <span class="at">xmax =</span> END, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">10000</span>)) <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> (<span class="fu">filter</span>(df_season, SEASON <span class="sc">==</span> <span class="st">"Summer"</span>)), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"#ffbf00"</span>,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> START, <span class="at">xmax =</span> END, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">10000</span>)) <span class="sc">+</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> (<span class="fu">filter</span>(df_season, SEASON <span class="sc">==</span> <span class="st">"Winter"</span>)), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"#5d4e62"</span>,</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> START, <span class="at">xmax =</span> END, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">10000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot one year</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_oneyear, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as_date</span>(DATE))) <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> (<span class="fu">filter</span>(df_oneyear, SEASON <span class="sc">==</span> <span class="st">"Fall"</span>)), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"#cc5500"</span>,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> START_noy, <span class="at">xmax =</span> END_noy, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">10000</span>)) <span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> (<span class="fu">filter</span>(df_oneyear, SEASON <span class="sc">==</span> <span class="st">"Spring"</span>)), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"#bccbae"</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> START_noy, <span class="at">xmax =</span> END_noy, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">10000</span>)) <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> (<span class="fu">filter</span>(df_oneyear, SEASON <span class="sc">==</span> <span class="st">"Summer"</span>)), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"#ffbf00"</span>,</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> START_noy, <span class="at">xmax =</span> END_noy, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">10000</span>)) <span class="sc">+</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> (<span class="fu">filter</span>(df_oneyear, SEASON <span class="sc">==</span> <span class="st">"Winter"</span>)), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"#5d4e62"</span>,</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> <span class="fu">as_date</span>(<span class="st">"2024-01-01"</span>), <span class="at">xmax =</span> END_noy, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">10000</span>)) <span class="sc">+</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> (<span class="fu">filter</span>(df_oneyear, SEASON <span class="sc">==</span> <span class="st">"Winter"</span>)), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"#5d4e62"</span>,</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> START_noy, <span class="at">xmax =</span> <span class="fu">as_date</span>(<span class="st">"2024-12-31"</span>), <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">10000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Combine with existing data frame.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>combined_gom_long_season <span class="ot">&lt;-</span> combined_gom_long <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_season <span class="sc">%&gt;%</span> <span class="fu">select</span>(DAY, SEASON, START, END)) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">day_noyear =</span> <span class="fu">paste</span>(MONTH, <span class="fu">day</span>(DAY), <span class="st">"2024"</span>, <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DAY_NOYEAR =</span> <span class="fu">mdy</span>(day_noyear)) <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>day_noyear)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(DAY)`</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(df_season$SEASON)</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(combined_gom_long_season$SEASON)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head()</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># save(combined_gom_long, combined_gom_long_season, df_season, file = "output-data/ifcb-data-04142025.RData") #</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-checkpoint-option-here" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="data-checkpoint-option-here"><span class="header-section-number">2.3</span> Data checkpoint option here</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load(file = "output-data/ifcb-data-04142025.RData", verbose = TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="import-gulf-metadata" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Import Gulf metadata</h1>
<p>Metadata information compiled by Siddarth Seshampally.</p>
<section id="temperature-salinity" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="temperature-salinity"><span class="header-section-number">3.1</span> Temperature &amp; Salinity</h2>
<p>Import from TABS D manual pull of data.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>tabs_d <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="at">file =</span> <span class="st">"input-data/TABS_D/tabs_D_salt.asc"</span>,</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_names =</span> <span class="cn">FALSE</span>, <span class="at">delim =</span> <span class="st">" "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 174802 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: " "
chr  (2): X1, X14
dbl  (4): X4, X7, X9, X11
lgl  (7): X3, X5, X6, X8, X10, X12, X13
time (1): X2

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tabs_d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  X1     X2    X3       X4 X5    X6       X7 X8       X9 X10     X11 X12   X13  
  &lt;chr&gt;  &lt;tim&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;
1 10/15… 08:00 NA     26.1 NA    NA     4.93 NA     31.5 NA        0 NA    NA   
2 10/15… 08:30 NA     26.1 NA    NA     4.93 NA     31.5 NA        0 NA    NA   
3 10/15… 09:00 NA     26.1 NA    NA     4.93 NA     31.5 NA        0 NA    NA   
4 10/15… 09:30 NA     25.8 NA    NA     4.87 NA     31.2 NA        0 NA    NA   
5 10/15… 10:00 NA     25.9 NA    NA     4.87 NA     31.2 NA        0 NA    NA   
6 10/15… 10:30 NA     25.9 NA    NA     4.87 NA     31.1 NA        0 NA    NA   
# ℹ 1 more variable: X14 &lt;chr&gt;</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ?read_delim()</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>tabs_d_qc <span class="ot">&lt;-</span> tabs_d <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">date =</span> X1, <span class="at">time =</span> X2, <span class="at">temp =</span> X4, <span class="at">sal =</span> X9)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tabs_d_qc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  date       time    temp   sal
  &lt;chr&gt;      &lt;time&gt; &lt;dbl&gt; &lt;dbl&gt;
1 10/15/2010 08:00   26.1  31.5
2 10/15/2010 08:30   26.1  31.5
3 10/15/2010 09:00   26.1  31.5
4 10/15/2010 09:30   25.8  31.2
5 10/15/2010 10:00   25.9  31.2
6 10/15/2010 10:30   25.9  31.1</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>tabs_temp_sal_2010 <span class="ot">&lt;-</span> tabs_d_qc <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE =</span> <span class="fu">mdy</span>(date),</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(DATE),</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">DAY =</span> <span class="fu">day</span>(DATE),</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">HOUR =</span> <span class="fu">hour</span>(<span class="fu">hms</span>(time)),</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">MIN =</span> <span class="fu">minute</span>(<span class="fu">hms</span>(time))) <span class="sc">%&gt;%</span> </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DATE, MONTH, DAY, HOUR, MIN, <span class="at">TEMP =</span> temp, <span class="at">SAL =</span> sal) <span class="sc">%&gt;%</span> </span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as_date</span>(DATE) <span class="sc">&lt;=</span> <span class="fu">as_date</span>(<span class="st">"2017-08-24"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">NOTES =</span> <span class="st">"temp and salinity from TABS D data water property data"</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(tabs_temp_sal_2010<span class="sc">$</span>DATE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2010-10-15" "2017-08-24"</code></pre>
</div>
</div>
<p>Water Property Data (from TABS website).</p>
<p>Date | Time | WaterT |Conduct| Salt | Chloro |Crude Oil| Fuel Oil| WaterT | | (UTC) | (°C) | | | | | | (°C) | ==========+========+========+=======+=======+=========+=========+=========+=========+ 04/14/2025 00:00:00 21.65 47.54 33.37 0.00 0.00 04/14/2025 00:30:00 21.60 47.54 33.40 0.00 0.00 04/14/2025 01:00:00 21.64 47.58 33.40 0.00 0.00</p>
<p>Above data from TABs starts in 2010. Import other TABS data that has earlier temperature values. Column headers are: | (UTC) | (cm/s)| (cm/s)| (cm/s)| (0T) | (0C) |</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>tabs_temp_vel <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"input-data/TABS_D/TABS_D_vel_2007-2016.txt"</span>, <span class="at">skip =</span> <span class="dv">3</span>, <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 126912 Columns: 1
── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr (1): X1

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tabs_temp_vel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 1
  X1                                                              
  &lt;chr&gt;                                                           
1 09/01/2007 00:00:00   -16.63    -1.65    16.71    264.3     30.4
2 09/01/2007 00:30:00   -14.49    -0.21    14.49    269.2     30.5
3 09/01/2007 01:00:00   -13.10    -1.97    13.25    261.4     30.5
4 09/01/2007 01:30:00   -17.10    -1.29    17.15    265.7     30.4
5 09/01/2007 02:00:00   -19.66     1.23    19.70    273.6     30.4
6 09/01/2007 02:30:00   -15.26    -2.47    15.46    260.8     30.4</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ?read_delim()</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>temp_tabs <span class="ot">&lt;-</span> tabs_temp_vel <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(X1, <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"time"</span>, <span class="st">"cm"</span>, <span class="st">"cm2"</span>, <span class="st">"cm3"</span>, <span class="st">"temp"</span>), <span class="at">sep =</span> <span class="st">"   "</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE_TIME =</span> <span class="fu">str_trim</span>(date), <span class="at">TEMP =</span> <span class="fu">str_trim</span>(temp)) <span class="sc">%&gt;%</span> </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DATE_TIME, TEMP) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">whole_date =</span> <span class="fu">mdy_hms</span>(DATE_TIME),</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(whole_date),</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">DAY =</span> <span class="fu">day</span>(whole_date),</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">DATE =</span> <span class="fu">date</span>(whole_date),</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">HOUR =</span> <span class="fu">hour</span>(whole_date),</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">MIN =</span> <span class="fu">minute</span>(whole_date)) <span class="sc">%&gt;%</span> </span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DATE, MONTH, DAY, HOUR, MIN, TEMP) <span class="sc">%&gt;%</span> </span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as_date</span>(DATE) <span class="sc">&gt;=</span> <span class="fu">as_date</span>(<span class="st">"2008-01-01"</span>) <span class="sc">&amp;</span> </span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>           <span class="fu">as_date</span>(DATE) <span class="sc">&lt;=</span> <span class="fu">as_date</span>(<span class="st">"2010-10-15"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">SAL =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">NOTES =</span> <span class="st">"temp from TABS D water vel data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 6 pieces. Additional pieces discarded in 1716 rows [341, 381, 385,
1103, 1104, 1111, 1131, 1145, 2240, 2463, 2464, 2476, 2501, 2512, 2513, 2523,
2550, 2647, 2648, 2660, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 6 pieces. Missing pieces filled with `NA` in 10783 rows [16778, 50149,
107820, 107821, 107822, 107823, 110893, 110894, 110895, 110896, 110903, 110904,
110905, 110906, 110907, 110908, 110909, 110910, 110911, 110912, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `whole_date = mdy_hms(DATE_TIME)`.
Caused by warning:
!  2 failed to parse.</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(temp_tabs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  DATE       MONTH   DAY  HOUR   MIN TEMP  SAL   NOTES                          
  &lt;date&gt;     &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;lgl&gt; &lt;chr&gt;                          
1 2008-01-01     1     1     0     0 16.2  NA    temp from TABS D water vel data
2 2008-01-01     1     1     0    30 16.3  NA    temp from TABS D water vel data
3 2008-01-01     1     1     1     0 16.3  NA    temp from TABS D water vel data
4 2008-01-01     1     1     1    30 16.3  NA    temp from TABS D water vel data
5 2008-01-01     1     1     2     0 16.2  NA    temp from TABS D water vel data
6 2008-01-01     1     1     2    30 16.1  NA    temp from TABS D water vel data</code></pre>
</div>
</div>
<p>Combine all temperature data and some salinity data.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>temp_sal_tabs <span class="ot">&lt;-</span> <span class="fu">rbind</span>(temp_tabs, tabs_temp_sal_2010)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(temp_sal_tabs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  DATE       MONTH   DAY  HOUR   MIN TEMP    SAL NOTES                          
  &lt;date&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;                          
1 2008-01-01     1     1     0     0 16.2     NA temp from TABS D water vel data
2 2008-01-01     1     1     0    30 16.3     NA temp from TABS D water vel data
3 2008-01-01     1     1     1     0 16.3     NA temp from TABS D water vel data
4 2008-01-01     1     1     1    30 16.3     NA temp from TABS D water vel data
5 2008-01-01     1     1     2     0 16.2     NA temp from TABS D water vel data
6 2008-01-01     1     1     2    30 16.1     NA temp from TABS D water vel data</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(temp_sal_tabs<span class="sc">$</span>DATE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2008-01-01" "2017-08-24"</code></pre>
</div>
</div>
<p>Import other salinity data from Siddarth</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># temp_sal &lt;- read.csv("input-data/NOAA_NERRS")</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co"># head(temp_sal)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="river-height-gauge" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="river-height-gauge"><span class="header-section-number">3.2</span> River height gauge</h2>
<p>Run <code>metadata-retrival/USGS pulling data.R</code></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>usgs_clean <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"input-data/usgs_07374000_cleaned.csv"</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(usgs_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  agency_cd site_no       date water_temp_C water_temp_code discharge_cfs
1      USGS 7374000 2007-01-01          9.8               A        431000
2      USGS 7374000 2007-01-02          9.6               A        458000
3      USGS 7374000 2007-01-03          9.2               A        499000
4      USGS 7374000 2007-01-04          9.1               A        540000
5      USGS 7374000 2007-01-05          9.4               A        585000
6      USGS 7374000 2007-01-06          9.3               A        605000
  discharge_code gage_height_ft gage_height_code conductivity_uScm
1              A          17.32                A               376
2              A          18.64                A               358
3              A          20.61                A               363
4              A          22.43                A               377
5              A          24.30                A               360
6              A          25.07                A               345
  conductivity_code dissolved_oxygen_mgL dissolved_oxygen_code turbidity_ntu
1                 A                   NA                  &lt;NA&gt;           0.2
2                 A                   NA                  &lt;NA&gt;           0.2
3                 A                   NA                  &lt;NA&gt;           0.2
4                 A                 10.5                     A           0.2
5                 A                 10.4                     A           0.2
6                 A                 10.4                     A           0.2
  turbidity_code salinity_psu salinity_code pH pH_code
1              A           NA          &lt;NA&gt; NA    &lt;NA&gt;
2              A           NA          &lt;NA&gt; NA    &lt;NA&gt;
3              A           NA          &lt;NA&gt; NA    &lt;NA&gt;
4              A           NA          &lt;NA&gt; NA    &lt;NA&gt;
5              A           NA          &lt;NA&gt; NA    &lt;NA&gt;
6              A           NA          &lt;NA&gt; NA    &lt;NA&gt;</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hist(usgs_clean$gage_height_ft)</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(usgs_clean, aes(x = date, y = gage_height_ft)) +</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># geom_bar(stat = "identity")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Clean up output and set up lubridate.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>discharge_ft <span class="ot">&lt;-</span> usgs_clean <span class="sc">%&gt;%</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, gage_height_ft) <span class="sc">%&gt;%</span> </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE =</span> <span class="fu">ymd</span>(date),</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(DATE),</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">DAY =</span> <span class="fu">day</span>(DATE)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>date)</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(discharge_ft)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  gage_height_ft       DATE MONTH DAY
1          17.32 2007-01-01     1   1
2          18.64 2007-01-02     1   2
3          20.61 2007-01-03     1   3
4          22.43 2007-01-04     1   4
5          24.30 2007-01-05     1   5
6          25.07 2007-01-06     1   6</code></pre>
</div>
</div>
<p>Add water gauge height to temperature and salinity data</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>temp_sal_tabs_gauge <span class="ot">&lt;-</span> temp_sal_tabs <span class="sc">%&gt;%</span> </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(discharge_ft)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(DATE, MONTH, DAY)`</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(temp_sal_tabs_gauge)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  DATE       MONTH   DAY  HOUR   MIN TEMP    SAL NOTES            gage_height_ft
  &lt;date&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;                     &lt;dbl&gt;
1 2008-01-01     1     1     0     0 16.2     NA temp from TABS …           23.0
2 2008-01-01     1     1     0    30 16.3     NA temp from TABS …           23.0
3 2008-01-01     1     1     1     0 16.3     NA temp from TABS …           23.0
4 2008-01-01     1     1     1    30 16.3     NA temp from TABS …           23.0
5 2008-01-01     1     1     2     0 16.2     NA temp from TABS …           23.0
6 2008-01-01     1     1     2    30 16.1     NA temp from TABS …           23.0</code></pre>
</div>
</div>
</section>
<section id="rainfall" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="rainfall"><span class="header-section-number">3.3</span> Rainfall</h2>
<p>Next steps: SKH - review precipitation from another source?</p>
<blockquote class="blockquote">
<p>Any code to run for this? Siddard - can you document this?</p>
</blockquote>
<p>HPCP is likeley inches. Hourly Precipitation Data (HPD)</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>rainfall <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"input-data/precipitation.csv"</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(rainfall<span class="sc">$</span>HPCP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>What are rainfall units?? Is it HDCP?</p>
</blockquote>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>rainfall_df <span class="ot">&lt;-</span> rainfall <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="at">date =</span> DATE, <span class="at">PRECIP_in =</span> HPCP) <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE_TIME =</span> <span class="fu">ymd_hm</span>(date),</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(DATE_TIME),</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">DAY =</span> <span class="fu">day</span>(DATE_TIME),</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">HOUR =</span> <span class="fu">hour</span>(DATE_TIME),</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">MIN =</span> <span class="fu">minute</span>(DATE_TIME),</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">DATE =</span> <span class="fu">date</span>(DATE_TIME)) <span class="sc">%&gt;%</span> </span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DATE, MONTH, DAY, HOUR, MIN, PRECIP_in)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rainfall_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        DATE MONTH DAY HOUR MIN PRECIP_in
1 2007-01-01     1   1    1   0      0.00
2 2007-01-03     1   3   13   0      0.00
3 2007-01-03     1   3   14   0      0.00
4 2007-01-03     1   3   15   0      0.00
5 2007-01-03     1   3   16   0      0.25
6 2007-01-03     1   3   17   0      0.25</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(temp_sal_tabs_gauge)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  DATE       MONTH   DAY  HOUR   MIN TEMP    SAL NOTES            gage_height_ft
  &lt;date&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;                     &lt;dbl&gt;
1 2008-01-01     1     1     0     0 16.2     NA temp from TABS …           23.0
2 2008-01-01     1     1     0    30 16.3     NA temp from TABS …           23.0
3 2008-01-01     1     1     1     0 16.3     NA temp from TABS …           23.0
4 2008-01-01     1     1     1    30 16.3     NA temp from TABS …           23.0
5 2008-01-01     1     1     2     0 16.2     NA temp from TABS …           23.0
6 2008-01-01     1     1     2    30 16.1     NA temp from TABS …           23.0</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># range(rainfall_df$HOUR)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(temp_sal_tabs_gauge)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  DATE       MONTH   DAY  HOUR   MIN TEMP    SAL NOTES            gage_height_ft
  &lt;date&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;                     &lt;dbl&gt;
1 2008-01-01     1     1     0     0 16.2     NA temp from TABS …           23.0
2 2008-01-01     1     1     0    30 16.3     NA temp from TABS …           23.0
3 2008-01-01     1     1     1     0 16.3     NA temp from TABS …           23.0
4 2008-01-01     1     1     1    30 16.3     NA temp from TABS …           23.0
5 2008-01-01     1     1     2     0 16.2     NA temp from TABS …           23.0
6 2008-01-01     1     1     2    30 16.1     NA temp from TABS …           23.0</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># range(temp_sal_tabs_gauge$HOUR)</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>temp_sal_gauge_rain <span class="ot">&lt;-</span> temp_sal_tabs_gauge <span class="sc">%&gt;%</span> </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(rainfall_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(DATE, MONTH, DAY, HOUR, MIN)`</code></pre>
</div>
</div>
</section>
<section id="lunar" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="lunar"><span class="header-section-number">3.4</span> Lunar</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>lunar <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"input-data/Lunar cycle values.csv"</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lunar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     Moon.Phase        Date Time..Universal.Time.
1     Full Moon  2007 Jan 3                 13:57
2  Last Quarter 2007 Jan 11                 12:45
3      New Moon 2007 Jan 19                  4:01
4 First Quarter 2007 Jan 25                 23:01
5     Full Moon  2007 Feb 2                  5:45
6  Last Quarter 2007 Feb 10                  9:51</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>lunar_df <span class="ot">&lt;-</span> lunar <span class="sc">%&gt;%</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Date, <span class="at">Phase =</span> Moon.Phase) <span class="sc">%&gt;%</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE =</span> <span class="fu">ymd</span>(Date),</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(DATE),</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">DAY =</span> <span class="fu">day</span>(DATE)) <span class="sc">%&gt;%</span> </span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Date)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lunar_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          Phase       DATE MONTH DAY
1     Full Moon 2007-01-03     1   3
2  Last Quarter 2007-01-11     1  11
3      New Moon 2007-01-19     1  19
4 First Quarter 2007-01-25     1  25
5     Full Moon 2007-02-02     2   2
6  Last Quarter 2007-02-10     2  10</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>temp_sal_gauge_rain_moon <span class="ot">&lt;-</span> temp_sal_gauge_rain <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lunar_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(DATE, MONTH, DAY)`</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(temp_sal_gauge_rain_moon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
  DATE       MONTH   DAY  HOUR   MIN TEMP    SAL NOTES  gage_height_ft PRECIP_in
  &lt;date&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;
1 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
2 2008-01-01     1     1     0    30 16.3     NA temp …           23.0        NA
3 2008-01-01     1     1     1     0 16.3     NA temp …           23.0         0
4 2008-01-01     1     1     1    30 16.3     NA temp …           23.0        NA
5 2008-01-01     1     1     2     0 16.2     NA temp …           23.0        NA
6 2008-01-01     1     1     2    30 16.1     NA temp …           23.0        NA
# ℹ 1 more variable: Phase &lt;chr&gt;</code></pre>
</div>
</div>
<p>All metadata is taking shape to be at minute 0 and 30 for every hour!</p>
</section>
<section id="tide-height" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="tide-height"><span class="header-section-number">3.5</span> Tide height</h2>
<p>see <code>Tide height.R</code> code.</p>
<p>Download MLLW</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>tide_height <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"input-data/port_aransas_water_levels_6min_2007_2017-4142025.csv"</span>)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tide_height)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         timestamp  MLLW std_dev    flag quality
1 2007-01-01 00:00 0.295   0.008 1,0,0,0       p
2 2007-01-01 00:06 0.298   0.008 1,0,0,0       p
3 2007-01-01 00:12 0.308   0.007 1,0,0,0       p
4 2007-01-01 00:18 0.307   0.008 1,0,0,0       p
5 2007-01-01 00:24 0.308   0.009 1,0,0,0       p
6 2007-01-01 00:30 0.312   0.006 1,0,0,0       p</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hist(tide_height$change)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Subtract tide height from previous entry to see if tide is incoming or outgoing.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>tide_height_df <span class="ot">&lt;-</span> tide_height <span class="sc">%&gt;%</span> </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE_TIME =</span> <span class="fu">ymd_hm</span>(timestamp),</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(DATE_TIME),</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">DAY =</span> <span class="fu">day</span>(DATE_TIME),</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">HOUR =</span> <span class="fu">hour</span>(DATE_TIME),</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">MIN =</span> <span class="fu">minute</span>(DATE_TIME),</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">DATE =</span> <span class="fu">date</span>(DATE_TIME)) <span class="sc">%&gt;%</span> </span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MIN <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="co"># Sample only on the hour or at 30 minutes.</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DIFFERENCE =</span> MLLW <span class="sc">-</span> <span class="fu">lag</span>(MLLW, <span class="at">default =</span> <span class="fu">first</span>(MLLW))) <span class="sc">%&gt;%</span> </span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tide_direction =</span> <span class="fu">case_when</span>(</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>      DIFFERENCE <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Incoming"</span>,</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>      DIFFERENCE <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Outgoing"</span>,</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No Change"</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span> </span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DATE, MONTH, DAY, HOUR, MIN, MLLW, DIFFERENCE, tide_direction) </span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tide_height_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        DATE MONTH DAY HOUR MIN  MLLW DIFFERENCE tide_direction
1 2007-01-01     1   1    0   0 0.295      0.000      No Change
2 2007-01-01     1   1    1   0 0.302      0.007       Incoming
3 2007-01-01     1   1    2   0 0.293     -0.009       Outgoing
4 2007-01-01     1   1    3   0 0.270     -0.023       Outgoing
5 2007-01-01     1   1    4   0 0.260     -0.010       Outgoing
6 2007-01-01     1   1    5   0 0.224     -0.036       Outgoing</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(tide_height_df<span class="sc">$</span>DIFFERENCE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># table(tide_height_df$tide_direction)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="combine-all-metadata" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Combine all metadata</h1>
<p>Combine with all other data</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>temp_sal_gauge_rain_moon_tide <span class="ot">&lt;-</span> temp_sal_gauge_rain_moon <span class="sc">%&gt;%</span> </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tide_height_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(DATE, MONTH, DAY, HOUR, MIN)`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(., tide_height_df): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 2697 of `x` matches multiple rows in `y`.
ℹ Row 32740 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(temp_sal_gauge_rain_moon_tide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  DATE       MONTH   DAY  HOUR   MIN TEMP    SAL NOTES  gage_height_ft PRECIP_in
  &lt;date&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;
1 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
2 2008-01-01     1     1     0    30 16.3     NA temp …           23.0        NA
3 2008-01-01     1     1     1     0 16.3     NA temp …           23.0         0
4 2008-01-01     1     1     1    30 16.3     NA temp …           23.0        NA
5 2008-01-01     1     1     2     0 16.2     NA temp …           23.0        NA
6 2008-01-01     1     1     2    30 16.1     NA temp …           23.0        NA
# ℹ 4 more variables: Phase &lt;chr&gt;, MLLW &lt;dbl&gt;, DIFFERENCE &lt;dbl&gt;,
#   tide_direction &lt;chr&gt;</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View(temp_sal_gauge_rain_moon_tide)</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="co"># hist(temp_sal_gauge_rain_moon_tide$SAL)</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>hourly_metadata <span class="ot">&lt;-</span> temp_sal_gauge_rain_moon_tide <span class="sc">%&gt;%</span> </span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MIN <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(temp_sal_gauge_rain_moon_tide, <span class="at">file =</span> <span class="st">"output-data/allmetadata-04142025.csv"</span>)</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(hourly_metadata, <span class="at">file =</span> <span class="st">"output-data/hourly_allmetadata-04142025.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="archive" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Archive</h1>
<p>Downloaded from TABS D historical data.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># folder_path &lt;- "/Users/skhu/Desktop/Projects/GoM-IFCB-PortAransas/input-data/TABS_D"</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="co"># file_list &lt;- list.files(folder_path, pattern = "*.txt", full.names = TRUE)</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # Print the list of files to ensure they are correctly detected</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print(file_list)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Function to load and format input data</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load_and_preprocess &lt;- function(file_path) {</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Read the file, skipping the first two header lines</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   data &lt;- read_table(file_path, skip = 2, col_names = FALSE)</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Assign proper column names for PTAT2</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   colnames(data) &lt;- c("YY","MM","DD","hh","mm",</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "DEPTH","OTMP","COND","SAL","O2%","O2PPM",</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "CLCON","TURB","PH","EH")</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Combine date and time columns into a datetime column using lubridate</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   data &lt;- data %&gt;%</span></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(</span></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a><span class="co">#       YY = as.integer(YY),</span></span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a><span class="co">#       MM = as.integer(MM),</span></span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a><span class="co">#       DD = as.integer(DD),</span></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a><span class="co">#       hh = as.integer(hh),</span></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a><span class="co">#       mm = as.integer(mm),</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a><span class="co">#       datetime = make_datetime(YY, MM, DD, hh, mm)  # Ensure hourly accuracy</span></span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(data)</span></span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and merge all data files</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="co"># all_data &lt;- file_list %&gt;%</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   lapply(load_and_preprocess) %&gt;%</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   bind_rows()</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="co"># # Check the combined dataset</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print(dim(all_data))  # Print the dimensions of the data</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a><span class="co"># print(head(all_data))  # View the first few rows</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a><span class="co"># table(all_data$O2PPM)</span></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a><span class="co"># range(all_data$datetime)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="archive-1" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="archive-1"><span class="header-section-number">5.1</span> ARCHIVE</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># folder_path &lt;- "/Users/skhu/Desktop/Projects/GoM-IFCB-PortAransas/input-data/PTAT2/Standard-Meterological-Data/"</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="co"># file_list &lt;- list.files(folder_path, pattern = "*.txt", full.names = TRUE)</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # Print the list of files to ensure they are correctly detected</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print(file_list)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Function to load and format input data</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load_and_preprocess &lt;- function(file_path) {</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Read the file, skipping the first two header lines</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   data &lt;- read_table(file_path, skip = 2, col_names = FALSE)</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   # # Assign proper column names for PTAT2</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   # colnames(data) &lt;- c("YY", "MM", "DD", "hh", "mm", "WDIR", "WSPD", "GST",</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   #                     "WVHT", "DPD", "APD", "MWD", "PRES", "ATMP", "WTMP",</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   #                     "DEWP", "VIS", "TIDE")</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Combine date and time columns into a datetime column using lubridate</span></span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   data &lt;- data %&gt;%</span></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(</span></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a><span class="co">#       YY = as.integer(YY),</span></span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a><span class="co">#       MM = as.integer(MM),</span></span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a><span class="co">#       DD = as.integer(DD),</span></span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a><span class="co">#       hh = as.integer(hh),</span></span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a><span class="co">#       mm = as.integer(mm),</span></span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a><span class="co">#       datetime = make_datetime(YY, MM, DD, hh, mm)  # Ensure hourly accuracy</span></span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb116-21"><a href="#cb116-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(data)</span></span>
<span id="cb116-22"><a href="#cb116-22" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and merge all data files</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="co"># all_data &lt;- file_list %&gt;%</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   lapply(load_and_preprocess) %&gt;%</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   bind_rows()</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the combined dataset</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print(dim(all_data))  # Print the dimensions of the data</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="co"># print(head(all_data))  # View the first few rows</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a><span class="co"># range(all_data$datetime)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Below needs to modified. We cannot group by year - we need to look at a parameters over time.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract year for aggregation</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="co"># head(all_data)</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="co"># all_data &lt;- all_data %&gt;%</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   unite(day, YY, MM, DD, sep = "-", remove = FALSE) %&gt;% </span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(year = format(datetime, "%Y"))</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # Group by year and calculate averages</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a><span class="co"># yearly_data &lt;- all_data %&gt;%</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year) %&gt;%</span></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     avg_ATMP = mean(as.numeric(ATMP), na.rm = TRUE),</span></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     avg_WTMP = mean(as.numeric(WTMP), na.rm = TRUE)</span></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert year to a numeric format for plotting</span></span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a><span class="co"># yearly_data$year &lt;- as.numeric(yearly_data$year)</span></span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a><span class="co"># # Check the aggregated data</span></span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a><span class="co"># print(head(yearly_data))</span></span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb118-22"><a href="#cb118-22" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create a full sequence of years</span></span>
<span id="cb118-23"><a href="#cb118-23" aria-hidden="true" tabindex="-1"></a><span class="co"># full_years &lt;- data.frame(year = 2008:2017)</span></span>
<span id="cb118-24"><a href="#cb118-24" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb118-25"><a href="#cb118-25" aria-hidden="true" tabindex="-1"></a><span class="co"># # Merge the full sequence with the aggregated data</span></span>
<span id="cb118-26"><a href="#cb118-26" aria-hidden="true" tabindex="-1"></a><span class="co"># yearly_data &lt;- full_years %&gt;%</span></span>
<span id="cb118-27"><a href="#cb118-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(yearly_data, by = "year")</span></span>
<span id="cb118-28"><a href="#cb118-28" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb118-29"><a href="#cb118-29" aria-hidden="true" tabindex="-1"></a><span class="co"># # Check the updated yearly data</span></span>
<span id="cb118-30"><a href="#cb118-30" aria-hidden="true" tabindex="-1"></a><span class="co"># print(yearly_data)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="combine-with-ifcb-data" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Combine with IFCB data</h1>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_gom_long_season)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 21
  DAY                 DATE       MONTH  HOUR CELL_ID            CARBON
  &lt;dttm&gt;              &lt;date&gt;     &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;               &lt;dbl&gt;
1 2008-01-01 00:00:00 2008-01-01     1     0 Akashiwo          159.   
2 2008-01-01 00:00:00 2008-01-01     1     0 Anabaena            0.559
3 2008-01-01 00:00:00 2008-01-01     1     0 Apedinella        227.   
4 2008-01-01 00:00:00 2008-01-01     1     0 Asterionellopsis   10.4  
5 2008-01-01 00:00:00 2008-01-01     1     0 Beads             357.   
6 2008-01-01 00:00:00 2008-01-01     1     0 Centric          2285.   
# ℹ 15 more variables: COURSE_CLASSIFICATION &lt;chr&gt;, TYPE &lt;chr&gt;, Domain &lt;chr&gt;,
#   Supergroup &lt;chr&gt;, Phylum &lt;chr&gt;, Class &lt;chr&gt;, Order &lt;chr&gt;, Family &lt;chr&gt;,
#   Genus &lt;chr&gt;, Species &lt;chr&gt;, COUNT &lt;dbl&gt;, SEASON &lt;chr&gt;, START &lt;date&gt;,
#   END &lt;date&gt;, DAY_NOYEAR &lt;date&gt;</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hourly_metadata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  DATE       MONTH   DAY  HOUR   MIN TEMP    SAL NOTES  gage_height_ft PRECIP_in
  &lt;date&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;
1 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
2 2008-01-01     1     1     1     0 16.3     NA temp …           23.0         0
3 2008-01-01     1     1     2     0 16.2     NA temp …           23.0        NA
4 2008-01-01     1     1     3     0 16.0     NA temp …           23.0        NA
5 2008-01-01     1     1     4     0 15.9     NA temp …           23.0        NA
6 2008-01-01     1     1     5     0 15.8     NA temp …           23.0        NA
# ℹ 4 more variables: Phase &lt;chr&gt;, MLLW &lt;dbl&gt;, DIFFERENCE &lt;dbl&gt;,
#   tide_direction &lt;chr&gt;</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>combined_biol_metadata <span class="ot">&lt;-</span> hourly_metadata <span class="sc">%&gt;%</span> </span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(combined_gom_long_season, <span class="at">by =</span> <span class="fu">join_by</span>(DATE, MONTH, HOUR))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in right_join(., combined_gom_long_season, by = join_by(DATE, MONTH, : Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 1 of `x` matches multiple rows in `y`.
ℹ Row 103889 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(combined_biol_metadata)</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(combined_biol_metadata$SEASON)</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_biol_metadata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 32
  DATE       MONTH DAY.x  HOUR   MIN TEMP    SAL NOTES  gage_height_ft PRECIP_in
  &lt;date&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;
1 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
2 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
3 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
4 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
5 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
6 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
# ℹ 22 more variables: Phase &lt;chr&gt;, MLLW &lt;dbl&gt;, DIFFERENCE &lt;dbl&gt;,
#   tide_direction &lt;chr&gt;, DAY.y &lt;dttm&gt;, CELL_ID &lt;chr&gt;, CARBON &lt;dbl&gt;,
#   COURSE_CLASSIFICATION &lt;chr&gt;, TYPE &lt;chr&gt;, Domain &lt;chr&gt;, Supergroup &lt;chr&gt;,
#   Phylum &lt;chr&gt;, Class &lt;chr&gt;, Order &lt;chr&gt;, Family &lt;chr&gt;, Genus &lt;chr&gt;,
#   Species &lt;chr&gt;, COUNT &lt;dbl&gt;, SEASON &lt;chr&gt;, START &lt;date&gt;, END &lt;date&gt;,
#   DAY_NOYEAR &lt;date&gt;</code></pre>
</div>
</div>
</section>
<section id="ifcb-data-overview" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> IFCB data overview</h1>
<p>Make a bar plot of the course classification types available from the IFCB.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_gom_long_season)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 21
  DAY                 DATE       MONTH  HOUR CELL_ID            CARBON
  &lt;dttm&gt;              &lt;date&gt;     &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;               &lt;dbl&gt;
1 2008-01-01 00:00:00 2008-01-01     1     0 Akashiwo          159.   
2 2008-01-01 00:00:00 2008-01-01     1     0 Anabaena            0.559
3 2008-01-01 00:00:00 2008-01-01     1     0 Apedinella        227.   
4 2008-01-01 00:00:00 2008-01-01     1     0 Asterionellopsis   10.4  
5 2008-01-01 00:00:00 2008-01-01     1     0 Beads             357.   
6 2008-01-01 00:00:00 2008-01-01     1     0 Centric          2285.   
# ℹ 15 more variables: COURSE_CLASSIFICATION &lt;chr&gt;, TYPE &lt;chr&gt;, Domain &lt;chr&gt;,
#   Supergroup &lt;chr&gt;, Phylum &lt;chr&gt;, Class &lt;chr&gt;, Order &lt;chr&gt;, Family &lt;chr&gt;,
#   Genus &lt;chr&gt;, Species &lt;chr&gt;, COUNT &lt;dbl&gt;, SEASON &lt;chr&gt;, START &lt;date&gt;,
#   END &lt;date&gt;, DAY_NOYEAR &lt;date&gt;</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>combined_gom_long_season <span class="sc">|&gt;</span> </span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(COURSE_CLASSIFICATION, TYPE) <span class="sc">|&gt;</span> </span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_OCCUR =</span> <span class="fu">n</span>(),</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_counts =</span> <span class="fu">sum</span>(COUNT),</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_carbon =</span> <span class="fu">sum</span>(CARBON)) <span class="sc">|&gt;</span> </span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"total_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">area =</span> value, <span class="at">fill =</span> COURSE_CLASSIFICATION)) <span class="sc">+</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_treemap</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(TYPE), <span class="at">cols =</span> <span class="fu">vars</span>(name)) <span class="sc">+</span></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'COURSE_CLASSIFICATION'. You can override
using the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>Based on the above, we will focus primarily on the pink color, microeukaryotes, which will include cells and cell type.</p>
</blockquote>
<p>Repeat with only microeukaryotes</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>combined_gom_long_season <span class="sc">|&gt;</span> </span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COURSE_CLASSIFICATION <span class="sc">==</span> <span class="st">"Microeukaryote"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Supergroup, Phylum) <span class="sc">|&gt;</span> </span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">var_sum_count =</span> <span class="fu">sum</span>(COUNT),</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">var_sum_carbon =</span> <span class="fu">sum</span>(CARBON)) <span class="sc">|&gt;</span> </span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"var_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Supergroup, <span class="at">y =</span> value, <span class="at">fill =</span> Phylum)) <span class="sc">+</span></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(name), <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Sum of cell counts"</span>, <span class="at">x =</span> <span class="st">"Supergroup"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Supergroup'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<section id="cells-carbon-and-carbon-per-cell" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="cells-carbon-and-carbon-per-cell"><span class="header-section-number">7.1</span> Cells, Carbon, and carbon per cell</h2>
<p>Carbon units are pgC per cell; Cells are cells per ml.</p>
<p>cell * carbon = pgC per ml</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_biol_metadata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 32
  DATE       MONTH DAY.x  HOUR   MIN TEMP    SAL NOTES  gage_height_ft PRECIP_in
  &lt;date&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;
1 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
2 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
3 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
4 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
5 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
6 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
# ℹ 22 more variables: Phase &lt;chr&gt;, MLLW &lt;dbl&gt;, DIFFERENCE &lt;dbl&gt;,
#   tide_direction &lt;chr&gt;, DAY.y &lt;dttm&gt;, CELL_ID &lt;chr&gt;, CARBON &lt;dbl&gt;,
#   COURSE_CLASSIFICATION &lt;chr&gt;, TYPE &lt;chr&gt;, Domain &lt;chr&gt;, Supergroup &lt;chr&gt;,
#   Phylum &lt;chr&gt;, Class &lt;chr&gt;, Order &lt;chr&gt;, Family &lt;chr&gt;, Genus &lt;chr&gt;,
#   Species &lt;chr&gt;, COUNT &lt;dbl&gt;, SEASON &lt;chr&gt;, START &lt;date&gt;, END &lt;date&gt;,
#   DAY_NOYEAR &lt;date&gt;</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>plot_biotic <span class="ot">&lt;-</span> combined_biol_metadata <span class="sc">%&gt;%</span> </span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pgC_ml =</span> COUNT <span class="sc">*</span> CARBON) <span class="sc">%&gt;%</span> </span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DATE, CELL_ID, COURSE_CLASSIFICATION, TYPE, Domain, Supergroup, Phylum, Class, Order, Family, Genus, Species, SEASON, CARBON, COUNT, pgC_ml, START, END, DAY_NOYEAR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="plot-biotic---all-years" class="level3">
<h3 class="anchored" data-anchor-id="plot-biotic---all-years">Plot biotic - all years</h3>
<p>We want to add information to the dates for when there are Karenia notifications and a data gap.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>kar_gap <span class="ot">&lt;-</span> plot_biotic <span class="sc">%&gt;%</span> </span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CELL_ID <span class="sc">==</span> <span class="st">"Karenia_brevis"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ADD =</span> <span class="fu">case_when</span>(</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">grepl</span>(<span class="st">"Karenia_brevis"</span>, CELL_ID) <span class="sc">&amp;</span> COUNT <span class="sc">&gt;</span> <span class="dv">2</span>) <span class="sc">~</span> <span class="st">"Notification"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">WEEK =</span> <span class="fu">cut</span>(DATE, <span class="st">"week"</span>, <span class="at">start.on.monday =</span> <span class="cn">TRUE</span>),</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">YEAR =</span> <span class="fu">year</span>(<span class="fu">as_date</span>(DATE))) <span class="sc">%&gt;%</span> </span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(WEEK, YEAR, ADD) <span class="sc">%&gt;%</span> </span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>values_byweek <span class="ot">&lt;-</span> plot_biotic <span class="sc">%&gt;%</span> </span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COURSE_CLASSIFICATION <span class="sc">==</span> <span class="st">"Microeukaryote"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Plantae"</span> <span class="sc">&amp;</span> Supergroup <span class="sc">!=</span> <span class="st">"Animalia/Metazoa"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>START, <span class="sc">-</span>END, <span class="sc">-</span>DAY_NOYEAR) <span class="sc">%&gt;%</span> </span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(DATE, CELL_ID, COURSE_CLASSIFICATION, TYPE, Domain, Supergroup, Phylum, Class, Order, Family, Genus, Species, SEASON), <span class="at">names_to =</span> <span class="st">"VARIABLE"</span>, <span class="at">values_to =</span> <span class="st">"VALUE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average the variable PER day for a single Cell ID type</span></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(VARIABLE, DATE, CELL_ID, SEASON) <span class="sc">%&gt;%</span> </span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">MEAN_bycell_day =</span> <span class="fu">mean</span>(VALUE)) <span class="sc">%&gt;%</span> </span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sum total cells for a single day</span></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DATE, SEASON, VARIABLE) <span class="sc">%&gt;%</span> </span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM_byday =</span> <span class="fu">sum</span>(MEAN_bycell_day)) <span class="sc">%&gt;%</span> </span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a column to specify the WEEK - have week start on Mondays</span></span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">WEEK =</span> <span class="fu">cut</span>(DATE, <span class="st">"week"</span>, <span class="at">start.on.monday =</span> <span class="cn">TRUE</span>),</span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(<span class="fu">as_date</span>(DATE)),</span>
<span id="cb137-18"><a href="#cb137-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">YEAR =</span> <span class="fu">year</span>(<span class="fu">as_date</span>(DATE))) <span class="sc">%&gt;%</span> </span>
<span id="cb137-19"><a href="#cb137-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get mean, min, and max for each week</span></span>
<span id="cb137-20"><a href="#cb137-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(WEEK, SEASON, YEAR, VARIABLE) <span class="sc">%&gt;%</span> </span>
<span id="cb137-21"><a href="#cb137-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">MEAN_WEEK =</span> <span class="fu">mean</span>(SUM_byday),</span>
<span id="cb137-22"><a href="#cb137-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">MAX_WEEK =</span> <span class="fu">max</span>(SUM_byday),</span>
<span id="cb137-23"><a href="#cb137-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">MIN_WEEK =</span> <span class="fu">min</span>(SUM_byday)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'VARIABLE', 'DATE', 'CELL_ID'. You can
override using the `.groups` argument.
`summarise()` has grouped output by 'DATE', 'SEASON'. You can override using
the `.groups` argument.
`summarise()` has grouped output by 'WEEK', 'SEASON', 'YEAR'. You can override
using the `.groups` argument.</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(values_byweek)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
# Groups:   WEEK, SEASON, YEAR [2]
  WEEK       SEASON  YEAR VARIABLE MEAN_WEEK MAX_WEEK MIN_WEEK
  &lt;fct&gt;      &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 2007-12-31 Winter  2008 CARBON      56195.   82761.  37467. 
2 2007-12-31 Winter  2008 COUNT         310.     373.    263. 
3 2007-12-31 Winter  2008 pgC_ml    1124443. 1581473. 709056. 
4 2008-01-07 Winter  2008 CARBON      49301.   94753.  19648. 
5 2008-01-07 Winter  2008 COUNT         203.     494.     29.2
6 2008-01-07 Winter  2008 pgC_ml     918768. 2670613.  19474. </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>oneyr_counts <span class="ot">&lt;-</span> values_byweek <span class="sc">%&gt;%</span> </span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VARIABLE_LABEL =</span> <span class="fu">factor</span>(VARIABLE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"COUNT"</span>, <span class="st">"CARBON"</span>, <span class="st">"pgC_ml"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="fu">bquote</span>(<span class="st">"Cells"</span><span class="sc">~</span>ml<span class="sc">^-</span><span class="dv">1</span>), <span class="fu">bquote</span>(<span class="st">"pg Carbon"</span><span class="sc">~</span>cell<span class="sc">^-</span><span class="dv">1</span>), <span class="fu">bquote</span>(<span class="st">"pg Carbon"</span><span class="sc">~</span>ml<span class="sc">^-</span><span class="dv">1</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as_date</span>(WEEK), <span class="at">y =</span> MEAN_WEEK)) <span class="sc">+</span> </span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> MIN_WEEK, <span class="at">ymax =</span> MAX_WEEK, <span class="at">color =</span> SEASON, <span class="at">alpha =</span> <span class="fl">0.5</span>), <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">19</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="fu">aes</span>(<span class="at">color =</span> SEASON)) <span class="sc">+</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(VARIABLE_LABEL), <span class="at">scales =</span> <span class="st">"free"</span>, </span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> label_parsed, <span class="at">switch =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%b %y"</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">date_breaks =</span> <span class="st">"3 months"</span>, <span class="at">date_minor_breaks =</span> <span class="st">"month"</span>) <span class="sc">+</span></span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#cc5500"</span>,<span class="st">"#bccbae"</span>,<span class="st">"#ffbf00"</span>,<span class="st">"#5d4e62"</span>)) <span class="sc">+</span></span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"IFCB time series"</span>, <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">"outside"</span>,</span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb141-19"><a href="#cb141-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb141-20"><a href="#cb141-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb141-21"><a href="#cb141-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#d9d9d9"</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>)) <span class="sc">+</span></span>
<span id="cb141-22"><a href="#cb141-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> (kar_gap <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ADD <span class="sc">==</span> <span class="st">"Notification"</span>)), <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as_date</span>(WEEK), <span class="at">y =</span> <span class="dv">10000</span>), <span class="at">shape =</span> <span class="dv">19</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)</span>
<span id="cb141-23"><a href="#cb141-23" aria-hidden="true" tabindex="-1"></a><span class="co"># labs(y = bquote("FLP cells " ~ mL^-1), x = "Incubation hours") + </span></span>
<span id="cb141-24"><a href="#cb141-24" aria-hidden="true" tabindex="-1"></a>oneyr_counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="2880"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point(data = (kar_gap %&gt;% filter(ADD == "Notification")), aes(x = as_date(WEEK), y = 10000), shape = 19, color = "red", alpha = 0.6) +</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point(data = (kar_gap %&gt;% filter(ADD != "Notification")), aes(x = as_date(WEEK), y = 0), size = 3, alpha = 0.6, shape = 17, color = "#bdbdbd")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<blockquote class="blockquote">
<p>This is a good supplementary figure or summary figure for a poster explaining the IFCB.</p>
</blockquote>
</section>
<section id="plot-biotic---one-year" class="level3">
<h3 class="anchored" data-anchor-id="plot-biotic---one-year">Plot biotic - one year</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(plot_biotic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 19
  DATE       CELL_ID  COURSE_CLASSIFICATION TYPE  Domain Supergroup Phylum Class
  &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;                 &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;
1 2008-01-01 Akashiwo Microeukaryote        Cell  "Euka… "Alveolat… "Dino… "Din…
2 2008-01-01 Anabaena Cyanobacteria         Cell  "Bact… "Cyanobac… "Cyan… "Cya…
3 2008-01-01 Apedine… Microeukaryote        Cell  "Euka… "Strameno… "Ochr… "Dic…
4 2008-01-01 Asterio… Microeukaryote        Cell  "Euka… "Strameno… "Ochr… "Bac…
5 2008-01-01 Beads    IFCB excess           Non-… ""     ""         ""     ""   
6 2008-01-01 Centric  Microeukaryote        Cell… "Euka… "Strameno… "Ochr… "Bac…
# ℹ 11 more variables: Order &lt;chr&gt;, Family &lt;chr&gt;, Genus &lt;chr&gt;, Species &lt;chr&gt;,
#   SEASON &lt;chr&gt;, CARBON &lt;dbl&gt;, COUNT &lt;dbl&gt;, pgC_ml &lt;dbl&gt;, START &lt;date&gt;,
#   END &lt;date&gt;, DAY_NOYEAR &lt;date&gt;</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>biotic_1yr <span class="ot">&lt;-</span> plot_biotic <span class="sc">%&gt;%</span> </span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Group by cell ID to get mean for a single day</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DAY_NOYEAR, DATE, CELL_ID, SEASON, COURSE_CLASSIFICATION) <span class="sc">%&gt;%</span> </span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">PER_DAY_CELL =</span> <span class="fu">mean</span>(COUNT),</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">PER_DAY_CARBON =</span> <span class="fu">mean</span>(CARBON),</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">PER_DAY_CARBON_ml =</span> <span class="fu">mean</span>(pgC_ml)) <span class="sc">%&gt;%</span> </span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># NOW sum up the different cell types that contribute to the course classification per day</span></span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DAY_NOYEAR, DATE, SEASON, COURSE_CLASSIFICATION) <span class="sc">%&gt;%</span> </span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">PER_DAY_COURSE_CELL =</span> <span class="fu">sum</span>(PER_DAY_CELL),</span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">PER_DAY_COURSE_CARBON =</span> <span class="fu">sum</span>(PER_DAY_CARBON),</span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">PER_DAY_COURSE_CARBONml =</span> <span class="fu">sum</span>(PER_DAY_CARBON_ml)) <span class="sc">%&gt;%</span> </span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb145-14"><a href="#cb145-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now average by year</span></span>
<span id="cb145-15"><a href="#cb145-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DAY_NOYEAR, COURSE_CLASSIFICATION, SEASON) <span class="sc">%&gt;%</span>  </span>
<span id="cb145-16"><a href="#cb145-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">MEAN_COUNTS_1yr =</span> <span class="fu">mean</span>(PER_DAY_COURSE_CELL),</span>
<span id="cb145-17"><a href="#cb145-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">MEAN_CARBON_1yr =</span> <span class="fu">mean</span>(PER_DAY_COURSE_CARBON),</span>
<span id="cb145-18"><a href="#cb145-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">MEAN_CARBONml_1yr =</span> <span class="fu">mean</span>(PER_DAY_COURSE_CARBONml)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'DAY_NOYEAR', 'DATE', 'CELL_ID', 'SEASON'.
You can override using the `.groups` argument.
`summarise()` has grouped output by 'DAY_NOYEAR', 'DATE', 'SEASON'. You can
override using the `.groups` argument.
`summarise()` has grouped output by 'DAY_NOYEAR', 'COURSE_CLASSIFICATION'. You
can override using the `.groups` argument.</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(biotic_1yr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
# Groups:   DAY_NOYEAR, COURSE_CLASSIFICATION [6]
  DAY_NOYEAR COURSE_CLASSIFICATION SEASON MEAN_COUNTS_1yr MEAN_CARBON_1yr
  &lt;date&gt;     &lt;chr&gt;                 &lt;chr&gt;            &lt;dbl&gt;           &lt;dbl&gt;
1 2024-01-01 Bacteria              Winter          0.105            219. 
2 2024-01-01 Biol unknown          Winter        182.            124017. 
3 2024-01-01 Cyanobacteria         Winter          0.535             29.3
4 2024-01-01 IFCB excess           Winter         20.2            12394. 
5 2024-01-01 Larvae                Winter          0.0793          1656. 
6 2024-01-01 Microeukaryote        Winter        218.             78674. 
# ℹ 1 more variable: MEAN_CARBONml_1yr &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>YMAX <span class="ot">&lt;-</span> <span class="fu">max</span>(biotic_1yr<span class="sc">$</span>MEAN_CARBON_1yr)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>YMAX <span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="co"># YMAX</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>biotic_1yr <span class="sc">%&gt;%</span> </span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"MEAN_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VARIABLE_LABEL =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MEAN_COUNTS_1yr"</span>, <span class="st">"MEAN_CARBON_1yr"</span>, <span class="st">"MEAN_CARBONml_1yr"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="fu">bquote</span>(<span class="st">"Cells"</span><span class="sc">~</span>ml<span class="sc">^-</span><span class="dv">1</span>), <span class="fu">bquote</span>(<span class="st">"pg Carbon"</span><span class="sc">~</span>cell<span class="sc">^-</span><span class="dv">1</span>), <span class="fu">bquote</span>(<span class="st">"pg Carbon"</span><span class="sc">~</span>ml<span class="sc">^-</span><span class="dv">1</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> DAY_NOYEAR, <span class="at">y =</span> value, <span class="at">fill =</span> COURSE_CLASSIFICATION)) <span class="sc">+</span> </span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%b"</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(VARIABLE_LABEL), <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">labeller =</span> label_parsed) <span class="sc">+</span></span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#fead5d"</span>, <span class="st">"#1468b3"</span>,<span class="st">"#00ac43"</span>,<span class="st">"#f6f86d"</span>,<span class="st">"#fc7e66"</span>, <span class="st">"#c304aa"</span>)) <span class="sc">+</span></span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb149-19"><a href="#cb149-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">xmin =</span> <span class="fu">as_date</span>(<span class="st">"2024-09-01"</span>), <span class="at">xmax =</span> <span class="fu">as_date</span>(<span class="st">"2024-11-30"</span>), <span class="at">ymin =</span> (YMAX), <span class="at">ymax =</span> (YMAX<span class="sc">+</span><span class="dv">40</span>), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"#cc5500"</span>) <span class="sc">+</span></span>
<span id="cb149-20"><a href="#cb149-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">xmin =</span> <span class="fu">as_date</span>(<span class="st">"2024-03-01"</span>), <span class="at">xmax =</span> <span class="fu">as_date</span>(<span class="st">"2024-5-31"</span>), <span class="at">ymin =</span> (YMAX), <span class="at">ymax =</span> (YMAX<span class="sc">+</span><span class="dv">40</span>), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"#bccbae"</span>) <span class="sc">+</span></span>
<span id="cb149-21"><a href="#cb149-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">xmin =</span> <span class="fu">as_date</span>(<span class="st">"2024-06-01"</span>), <span class="at">xmax =</span> <span class="fu">as_date</span>(<span class="st">"2024-08-31"</span>), <span class="at">ymin =</span> (YMAX), <span class="at">ymax =</span> (YMAX<span class="sc">+</span><span class="dv">40</span>), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"#ffbf00"</span>) <span class="sc">+</span></span>
<span id="cb149-22"><a href="#cb149-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">xmin =</span> <span class="fu">as_date</span>(<span class="st">"2024-12-01"</span>), <span class="at">xmax =</span> <span class="fu">as_date</span>(<span class="st">"2024-12-31"</span>), <span class="at">ymin =</span> (YMAX), <span class="at">ymax =</span> (YMAX<span class="sc">+</span><span class="dv">40</span>), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"#5d4e62"</span>) <span class="sc">+</span></span>
<span id="cb149-23"><a href="#cb149-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">xmin =</span> <span class="fu">as_date</span>(<span class="st">"2024-01-01"</span>), <span class="at">xmax =</span> <span class="fu">as_date</span>(<span class="st">"2024-02-29"</span>), <span class="at">ymin =</span> (YMAX), <span class="at">ymax =</span> (YMAX<span class="sc">+</span><span class="dv">40</span>),, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"#5d4e62"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Spring = March 1 - May 31 </span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Summer = June 1 - Aug 31 </span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Fall = Sept 1 - Nov 30 </span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Winter = Dec 1 - Feb (March 1 (-1))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="all-daily" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="all-daily"><span class="header-section-number">7.2</span> All daily</h2>
<p>Look at by hour and season for different supergroups.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>combined_biol_metadata <span class="sc">|&gt;</span> </span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COURSE_CLASSIFICATION <span class="sc">==</span> <span class="st">"Microeukaryote"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Phylum <span class="sc">!=</span> <span class="st">"Cnidaria"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove any zeroes</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COUNT <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(COUNT)) <span class="sc">%&gt;%</span> </span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get average for a given hour in the same month and season for an individual day.</span></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(HOUR, SEASON, Supergroup, Phylum) <span class="sc">%&gt;%</span> </span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">MEAN_COUNT_DAILY =</span> <span class="fu">mean</span>(COUNT),</span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">MAX_COUNT_DAILY =</span> <span class="fu">max</span>(COUNT),</span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">MIN_COUNT_DAILY =</span> <span class="fu">min</span>(COUNT)) <span class="sc">%&gt;%</span> </span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> (HOUR), <span class="at">y =</span> MEAN_COUNT_DAILY, <span class="at">color =</span> SEASON)) <span class="sc">+</span></span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">group =</span> Phylum)) <span class="sc">+</span></span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">19</span>) <span class="sc">+</span></span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(Supergroup), <span class="at">cols =</span> <span class="fu">vars</span>(SEASON), <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb151-16"><a href="#cb151-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#cc5500"</span>,<span class="st">"#bccbae"</span>,<span class="st">"#ffbf00"</span>,<span class="st">"#5d4e62"</span>)) <span class="sc">+</span></span>
<span id="cb151-17"><a href="#cb151-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb151-18"><a href="#cb151-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="fu">bquote</span>(<span class="st">"log cell"</span><span class="sc">~</span>ml<span class="sc">^-</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb151-19"><a href="#cb151-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb151-20"><a href="#cb151-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb151-21"><a href="#cb151-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb151-22"><a href="#cb151-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb151-23"><a href="#cb151-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#d9d9d9"</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'HOUR', 'SEASON', 'Supergroup'. You can
override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>Each line represents a phylum, so there are some withe more variability than others. We also know that cell types are not equally represented across the supergroups in the IFCB data, therefore, we need to focus on the stramenopiles and alveolata vs.&nbsp;other supergroups.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>alv_stram <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Stramenopiles"</span>, <span class="st">"Alveolata"</span>)</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="co"># counts_long_wtax_wseason</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>combined_biol_metadata <span class="sc">|&gt;</span> </span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COURSE_CLASSIFICATION <span class="sc">==</span> <span class="st">"Microeukaryote"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Phylum <span class="sc">!=</span> <span class="st">"Cnidaria"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(Supergroup <span class="sc">%in%</span> alv_stram)) <span class="sc">%&gt;%</span> </span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove any zeroes</span></span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COUNT <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(COUNT)) <span class="sc">%&gt;%</span> </span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get average for a given hour in the same month and season for an individual day.</span></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(HOUR, SEASON, Supergroup, Phylum, CELL_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">MEAN_COUNT_DAILY =</span> <span class="fu">mean</span>(COUNT),</span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">MAX_COUNT_DAILY =</span> <span class="fu">max</span>(COUNT),</span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">MIN_COUNT_DAILY =</span> <span class="fu">min</span>(COUNT)) <span class="sc">%&gt;%</span> </span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> (HOUR), <span class="at">y =</span> MEAN_COUNT_DAILY, <span class="at">color =</span> SEASON)) <span class="sc">+</span></span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">group =</span> CELL_ID)) <span class="sc">+</span></span>
<span id="cb153-16"><a href="#cb153-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">19</span>) <span class="sc">+</span></span>
<span id="cb153-17"><a href="#cb153-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(Supergroup), <span class="at">cols =</span> <span class="fu">vars</span>(SEASON), <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb153-18"><a href="#cb153-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb153-19"><a href="#cb153-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#cc5500"</span>,<span class="st">"#bccbae"</span>,<span class="st">"#ffbf00"</span>,<span class="st">"#5d4e62"</span>)) <span class="sc">+</span></span>
<span id="cb153-20"><a href="#cb153-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb153-21"><a href="#cb153-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="fu">bquote</span>(<span class="st">"log cell"</span><span class="sc">~</span>ml<span class="sc">^-</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb153-22"><a href="#cb153-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb153-23"><a href="#cb153-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb153-24"><a href="#cb153-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb153-25"><a href="#cb153-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb153-26"><a href="#cb153-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#d9d9d9"</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'HOUR', 'SEASON', 'Supergroup', 'Phylum'.
You can override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="a-focus-on-dinoflagellates-haptophytes-ciliates-and-diatoms" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> A focus on Dinoflagellates, Haptophytes, Ciliates, and diatoms</h1>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_biol_metadata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 32
  DATE       MONTH DAY.x  HOUR   MIN TEMP    SAL NOTES  gage_height_ft PRECIP_in
  &lt;date&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;
1 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
2 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
3 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
4 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
5 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
6 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
# ℹ 22 more variables: Phase &lt;chr&gt;, MLLW &lt;dbl&gt;, DIFFERENCE &lt;dbl&gt;,
#   tide_direction &lt;chr&gt;, DAY.y &lt;dttm&gt;, CELL_ID &lt;chr&gt;, CARBON &lt;dbl&gt;,
#   COURSE_CLASSIFICATION &lt;chr&gt;, TYPE &lt;chr&gt;, Domain &lt;chr&gt;, Supergroup &lt;chr&gt;,
#   Phylum &lt;chr&gt;, Class &lt;chr&gt;, Order &lt;chr&gt;, Family &lt;chr&gt;, Genus &lt;chr&gt;,
#   Species &lt;chr&gt;, COUNT &lt;dbl&gt;, SEASON &lt;chr&gt;, START &lt;date&gt;, END &lt;date&gt;,
#   DAY_NOYEAR &lt;date&gt;</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(combined_biol_metadata<span class="sc">$</span>Phylum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Dinoflagellate" "Cyanobacteria"  "Ochrophyta"     ""              
 [5] "Haptophyta"     "Cnidaria"       "Cercozoa"       "Euglenozoa"    
 [9] "Ciliophora"     "Chlorophyta"    "Cryptophyta"    "Retaria"       
[13] "Charophyta"    </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>dino_diatom_cil_hapto <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Ochrophyta"</span>, <span class="st">"Dinoflagellate"</span>, <span class="st">"Ciliophora"</span>, <span class="st">"Haptophyta"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> combined_biol_metadata <span class="sc">|&gt;</span> </span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Phylum <span class="sc">%in%</span> dino_diatom_cil_hapto) <span class="sc">%&gt;%</span> </span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Phylum, Class, CELL_ID) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>?<span class="fu">count</span>()</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a><span class="co"># head(tmp)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="plot-a-year-trend-at-phylum-level" class="level3">
<h3 class="anchored" data-anchor-id="plot-a-year-trend-at-phylum-level">Plot a year trend at Phylum level</h3>
<p>First cell counts.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>oneyr_phylum <span class="ot">&lt;-</span> combined_biol_metadata <span class="sc">|&gt;</span> </span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Phylum <span class="sc">%in%</span> dino_diatom_cil_hapto) <span class="sc">%&gt;%</span> </span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove any zeroes</span></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COUNT <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(COUNT)) <span class="sc">%&gt;%</span> </span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DATE, COUNT, Phylum, CELL_ID, CARBON, Class, DAY_NOYEAR) <span class="sc">%&gt;%</span></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add up cell types for a single day. </span></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DATE, Phylum, CELL_ID, DAY_NOYEAR) <span class="sc">%&gt;%</span> </span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM_CELLS_day =</span> <span class="fu">sum</span>(COUNT),</span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">SUM_CARBON_day =</span> <span class="fu">sum</span>(CARBON)) <span class="sc">%&gt;%</span> </span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a column to specify the WEEK - have week start on Mondays</span></span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(WEEK = cut(DATE, "week", start.on.monday = TRUE),</span></span>
<span id="cb161-14"><a href="#cb161-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#        MONTH = month(as_date(DATE)),</span></span>
<span id="cb161-15"><a href="#cb161-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#        YEAR = year(as_date(DATE))) %&gt;% </span></span>
<span id="cb161-16"><a href="#cb161-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get mean, min, and max for each week</span></span>
<span id="cb161-17"><a href="#cb161-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DAY_NOYEAR, Phylum) <span class="sc">%&gt;%</span> </span>
<span id="cb161-18"><a href="#cb161-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Take average across years.</span></span>
<span id="cb161-19"><a href="#cb161-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group_by(DAY_NOYEAR, Phylum) %&gt;% </span></span>
<span id="cb161-20"><a href="#cb161-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">MEAN_CELLS_day_1yr =</span> <span class="fu">mean</span>(SUM_CELLS_day),</span>
<span id="cb161-21"><a href="#cb161-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">MAX_CELLS_day_1yr =</span> <span class="fu">max</span>(SUM_CELLS_day),</span>
<span id="cb161-22"><a href="#cb161-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">MIN_CELLS_day_1yr =</span> <span class="fu">min</span>(SUM_CELLS_day),</span>
<span id="cb161-23"><a href="#cb161-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">SEM_CELLS_day_1yr =</span> (<span class="fu">sd</span>(SUM_CELLS_day)<span class="sc">/</span><span class="fu">n</span>()),</span>
<span id="cb161-24"><a href="#cb161-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">MEAN_C_day_1yr =</span> <span class="fu">mean</span>(SUM_CARBON_day),</span>
<span id="cb161-25"><a href="#cb161-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">MAX_C_day_1yr =</span> <span class="fu">max</span>(SUM_CARBON_day),</span>
<span id="cb161-26"><a href="#cb161-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">MIN_C_day_1yr =</span> <span class="fu">min</span>(SUM_CARBON_day),</span>
<span id="cb161-27"><a href="#cb161-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">SEM_C_day_1yr =</span> (<span class="fu">sd</span>(SUM_CARBON_day<span class="sc">/</span><span class="fu">n</span>()))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'DATE', 'Phylum', 'CELL_ID'. You can
override using the `.groups` argument.
`summarise()` has grouped output by 'DAY_NOYEAR'. You can override using the
`.groups` argument.</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard error of the mean = SD / sample size</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="co"># head(oneyr_phylum)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>oneyr_phylum <span class="sc">%&gt;%</span> </span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as_date</span>(DAY_NOYEAR), <span class="at">fill =</span> Phylum, <span class="at">color =</span> Phylum)) <span class="sc">+</span></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> (MEAN_CELLS_day_1yr<span class="sc">-</span>SEM_CELLS_day_1yr), <span class="at">ymax =</span> (MEAN_CELLS_day_1yr<span class="sc">+</span>SEM_CELLS_day_1yr), <span class="at">fill =</span> Phylum)) <span class="sc">+</span></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> MEAN_CELLS_day_1yr), <span class="at">shape =</span> <span class="dv">19</span>) <span class="sc">+</span></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> MEAN_CELLS_day_1yr)) <span class="sc">+</span></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_linerange(aes(ymin = MIN_CELLS_day_1yr, ymax = MAX_CELLS_day_1yr, color = Phylum, alpha = 0.3), linewidth = 0.3) +</span></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   geom_point(shape = 19, size = 2, aes(color = Phylum)) +</span></span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_area(stat = "identity", position = "stack") +</span></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%b"</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(Phylum), <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">labeller =</span> label_parsed) <span class="sc">+</span></span>
<span id="cb164-13"><a href="#cb164-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Cells per ml"</span>) <span class="sc">+</span></span>
<span id="cb164-14"><a href="#cb164-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#1468b3"</span>,<span class="st">"#fc7e66"</span>, <span class="st">"#00ac43"</span>,<span class="st">"#fead5d"</span>, <span class="st">"#c304aa"</span>)) <span class="sc">+</span></span>
<span id="cb164-15"><a href="#cb164-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#1468b3"</span>,<span class="st">"#fc7e66"</span>, <span class="st">"#00ac43"</span>,<span class="st">"#fead5d"</span>, <span class="st">"#c304aa"</span>)) <span class="sc">+</span></span>
<span id="cb164-16"><a href="#cb164-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb164-17"><a href="#cb164-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb164-18"><a href="#cb164-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb164-19"><a href="#cb164-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb164-20"><a href="#cb164-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb164-21"><a href="#cb164-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey80"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>Repeat with carbon</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>oneyr_phylum <span class="sc">%&gt;%</span> </span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as_date</span>(DAY_NOYEAR), <span class="at">fill =</span> Phylum, <span class="at">color =</span> Phylum)) <span class="sc">+</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> (MEAN_C_day_1yr<span class="sc">-</span>SEM_C_day_1yr), <span class="at">ymax =</span> (MEAN_C_day_1yr<span class="sc">+</span>SEM_C_day_1yr), <span class="at">fill =</span> Phylum)) <span class="sc">+</span></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> MEAN_C_day_1yr), <span class="at">shape =</span> <span class="dv">19</span>) <span class="sc">+</span></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> MEAN_C_day_1yr)) <span class="sc">+</span></span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_linerange(aes(ymin = MIN_CELLS_day_1yr, ymax = MAX_CELLS_day_1yr, color = Phylum, alpha = 0.3), linewidth = 0.3) +</span></span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   geom_point(shape = 19, size = 2, aes(color = Phylum)) +</span></span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_area(stat = "identity", position = "stack") +</span></span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%b"</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb165-12"><a href="#cb165-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(Phylum), <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">labeller =</span> label_parsed) <span class="sc">+</span></span>
<span id="cb165-13"><a href="#cb165-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"pg Carbon"</span>) <span class="sc">+</span></span>
<span id="cb165-14"><a href="#cb165-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#1468b3"</span>,<span class="st">"#fc7e66"</span>, <span class="st">"#00ac43"</span>,<span class="st">"#fead5d"</span>, <span class="st">"#c304aa"</span>)) <span class="sc">+</span></span>
<span id="cb165-15"><a href="#cb165-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#1468b3"</span>,<span class="st">"#fc7e66"</span>, <span class="st">"#00ac43"</span>,<span class="st">"#fead5d"</span>, <span class="st">"#c304aa"</span>)) <span class="sc">+</span></span>
<span id="cb165-16"><a href="#cb165-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb165-17"><a href="#cb165-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb165-18"><a href="#cb165-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb165-19"><a href="#cb165-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb165-20"><a href="#cb165-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb165-21"><a href="#cb165-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey80"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plot-at-cell-type-level-within-each-class" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="plot-at-cell-type-level-within-each-class"><span class="header-section-number">8.1</span> Plot at cell type level within each class</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_biol_metadata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 32
  DATE       MONTH DAY.x  HOUR   MIN TEMP    SAL NOTES  gage_height_ft PRECIP_in
  &lt;date&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;
1 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
2 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
3 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
4 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
5 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
6 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
# ℹ 22 more variables: Phase &lt;chr&gt;, MLLW &lt;dbl&gt;, DIFFERENCE &lt;dbl&gt;,
#   tide_direction &lt;chr&gt;, DAY.y &lt;dttm&gt;, CELL_ID &lt;chr&gt;, CARBON &lt;dbl&gt;,
#   COURSE_CLASSIFICATION &lt;chr&gt;, TYPE &lt;chr&gt;, Domain &lt;chr&gt;, Supergroup &lt;chr&gt;,
#   Phylum &lt;chr&gt;, Class &lt;chr&gt;, Order &lt;chr&gt;, Family &lt;chr&gt;, Genus &lt;chr&gt;,
#   Species &lt;chr&gt;, COUNT &lt;dbl&gt;, SEASON &lt;chr&gt;, START &lt;date&gt;, END &lt;date&gt;,
#   DAY_NOYEAR &lt;date&gt;</code></pre>
</div>
</div>
<p>Diatom genus of choice!</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># diatom_genus &lt;- c("Chaetoceros", "")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot a year trend for Cell types within the classes.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>diatom_genus_oneyr <span class="ot">&lt;-</span> combined_biol_metadata <span class="sc">|&gt;</span> </span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Class <span class="sc">%in%</span> <span class="st">"Bacillariophyceae"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove any zeroes</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COUNT <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(COUNT)) <span class="sc">%&gt;%</span> </span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DATE, COUNT, Order, Family, Genus, CELL_ID, CARBON, DAY_NOYEAR) <span class="sc">%&gt;%</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add up Genus level types for a single day. </span></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DATE, Order, Family, Genus, CELL_ID, DAY_NOYEAR) <span class="sc">%&gt;%</span> </span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM_CELLS_day =</span> <span class="fu">sum</span>(COUNT),</span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">SUM_CARBON_day =</span> <span class="fu">sum</span>(CARBON)) <span class="sc">%&gt;%</span> </span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DAY_NOYEAR, Genus) <span class="sc">%&gt;%</span> </span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Take average across years.</span></span>
<span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">MEAN_CELLS_day_1yr =</span> <span class="fu">mean</span>(SUM_CELLS_day),</span>
<span id="cb169-15"><a href="#cb169-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">MAX_CELLS_day_1yr =</span> <span class="fu">max</span>(SUM_CELLS_day),</span>
<span id="cb169-16"><a href="#cb169-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">MIN_CELLS_day_1yr =</span> <span class="fu">min</span>(SUM_CELLS_day),</span>
<span id="cb169-17"><a href="#cb169-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">SEM_CELLS_day_1yr =</span> (<span class="fu">sd</span>(SUM_CELLS_day)<span class="sc">/</span><span class="fu">n</span>()),</span>
<span id="cb169-18"><a href="#cb169-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">MEAN_C_day_1yr =</span> <span class="fu">mean</span>(SUM_CARBON_day),</span>
<span id="cb169-19"><a href="#cb169-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">MAX_C_day_1yr =</span> <span class="fu">max</span>(SUM_CARBON_day),</span>
<span id="cb169-20"><a href="#cb169-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">MIN_C_day_1yr =</span> <span class="fu">min</span>(SUM_CARBON_day),</span>
<span id="cb169-21"><a href="#cb169-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">SEM_C_day_1yr =</span> (<span class="fu">sd</span>(SUM_CARBON_day<span class="sc">/</span><span class="fu">n</span>()))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'DATE', 'Order', 'Family', 'Genus',
'CELL_ID'. You can override using the `.groups` argument.
`summarise()` has grouped output by 'DAY_NOYEAR'. You can override using the
`.groups` argument.</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard error of the mean = SD / sample size</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(diatom_genus_oneyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
# Groups:   DAY_NOYEAR [1]
  DAY_NOYEAR Genus        MEAN_CELLS_day_1yr MAX_CELLS_day_1yr MIN_CELLS_day_1yr
  &lt;date&gt;     &lt;chr&gt;                     &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;
1 2024-01-01 ""                       106.              1286.             0.177 
2 2024-01-01 "Chaetocero…              99.2             1042.             0.0769
3 2024-01-01 "Corethron"                9.12              23.8            0.540 
4 2024-01-01 "Cymatosira"              74.0              181.            12.2   
5 2024-01-01 "Dactylioso…              18.8               63.4            0.759 
6 2024-01-01 "Diploneis"               18.3               67.0            3.49  
# ℹ 5 more variables: SEM_CELLS_day_1yr &lt;dbl&gt;, MEAN_C_day_1yr &lt;dbl&gt;,
#   MAX_C_day_1yr &lt;dbl&gt;, MIN_C_day_1yr &lt;dbl&gt;, SEM_C_day_1yr &lt;dbl&gt;</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># length(unique(diatom_oneyr$CELL_ID)) # 37 unique cell types under diatoms. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Parse diatom data:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>tmp_diatom <span class="ot">&lt;-</span> combined_biol_metadata <span class="sc">|&gt;</span> </span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Class <span class="sc">%in%</span> <span class="st">"Bacillariophyceae"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Phylum, Class, Order, Family, Genus, Species, CELL_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>perct_diatom  <span class="ot">&lt;-</span> combined_biol_metadata <span class="sc">|&gt;</span> </span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Class <span class="sc">%in%</span> <span class="st">"Bacillariophyceae"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Phylum, Class, Order, Family, Genus, Species, CELL_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot diatoms.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>diatom_genus_oneyr <span class="sc">%&gt;%</span> </span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(!(Genus != "")) %&gt;% </span></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as_date</span>(DAY_NOYEAR), <span class="at">fill =</span> Genus)) <span class="sc">+</span></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="fu">aes</span>(<span class="at">y =</span> MEAN_CELLS_day_1yr), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%b"</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_y_log10() +</span></span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_grid(rows = vars(Order), scales = "free", labeller = label_parsed) +</span></span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Cells per ml"</span>) <span class="sc">+</span></span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_color_manual(values = c("#1468b3","#fc7e66", "#00ac43","#fead5d", "#c304aa")) +</span></span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_manual(values = c("#1468b3","#fc7e66", "#00ac43","#fead5d", "#c304aa")) +</span></span>
<span id="cb175-12"><a href="#cb175-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb175-13"><a href="#cb175-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb175-14"><a href="#cb175-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb175-15"><a href="#cb175-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb175-16"><a href="#cb175-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb175-17"><a href="#cb175-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey80"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<section id="tile-plots" class="level3">
<h3 class="anchored" data-anchor-id="tile-plots">Tile plots</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>combined_biol_metadata <span class="sc">|&gt;</span> </span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Phylum, Class, Order) <span class="sc">|&gt;</span> </span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(COUNT),</span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">COUNT =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">area =</span> SUM, <span class="at">fill =</span> Class, <span class="at">subgroup =</span> Order, <span class="at">label =</span> Order)) <span class="sc">+</span></span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_treemap</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_treemap_subgroup_border</span>(<span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_treemap_text</span>(<span class="at">place =</span> <span class="st">"centre"</span>,<span class="at">size =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Most abundant Alveolata"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Phylum', 'Class'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>combined_biol_metadata <span class="sc">|&gt;</span> </span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Phylum, Class, Order) <span class="sc">|&gt;</span> </span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM_CARBON =</span> <span class="fu">sum</span>(CARBON)) <span class="sc">|&gt;</span> </span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">area =</span> SUM_CARBON, <span class="at">fill =</span> Class, <span class="at">subgroup =</span> Order, <span class="at">label =</span> Order)) <span class="sc">+</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_treemap</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_treemap_subgroup_border</span>(<span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_treemap_text</span>(<span class="at">place =</span> <span class="st">"centre"</span>,<span class="at">size =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="st">"Alveolata by carbon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Phylum', 'Class'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="breakdown-stramenopiles" class="level3">
<h3 class="anchored" data-anchor-id="breakdown-stramenopiles">Breakdown Stramenopiles</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>combined_biol_metadata <span class="sc">|&gt;</span> </span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">==</span> <span class="st">"Stramenopiles"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Phylum, Class, Order) <span class="sc">|&gt;</span> </span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(COUNT),</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">COUNT =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">area =</span> SUM, <span class="at">fill =</span> Class, <span class="at">subgroup =</span> Order, <span class="at">label =</span> Order)) <span class="sc">+</span></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_treemap</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_treemap_subgroup_border</span>(<span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_treemap_text</span>(<span class="at">place =</span> <span class="st">"centre"</span>,<span class="at">size =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Most abundant Stramenopiles"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Phylum', 'Class'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>combined_biol_metadata <span class="sc">|&gt;</span> </span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">==</span> <span class="st">"Stramenopiles"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Phylum, Class, Order) <span class="sc">|&gt;</span> </span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM_CARBON =</span> <span class="fu">sum</span>(CARBON)) <span class="sc">|&gt;</span> </span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">area =</span> SUM_CARBON, <span class="at">fill =</span> Class, <span class="at">subgroup =</span> Order, <span class="at">label =</span> Order)) <span class="sc">+</span></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_treemap</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_treemap_subgroup_border</span>(<span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_treemap_text</span>(<span class="at">place =</span> <span class="st">"centre"</span>,<span class="at">size =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Stramenopiles by carbon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Phylum', 'Class'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="table-summaries" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Table summaries</h1>
<p>What is the overall range of pgC per ml for each of these cell types?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_biol_metadata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 32
  DATE       MONTH DAY.x  HOUR   MIN TEMP    SAL NOTES  gage_height_ft PRECIP_in
  &lt;date&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;
1 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
2 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
3 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
4 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
5 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
6 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
# ℹ 22 more variables: Phase &lt;chr&gt;, MLLW &lt;dbl&gt;, DIFFERENCE &lt;dbl&gt;,
#   tide_direction &lt;chr&gt;, DAY.y &lt;dttm&gt;, CELL_ID &lt;chr&gt;, CARBON &lt;dbl&gt;,
#   COURSE_CLASSIFICATION &lt;chr&gt;, TYPE &lt;chr&gt;, Domain &lt;chr&gt;, Supergroup &lt;chr&gt;,
#   Phylum &lt;chr&gt;, Class &lt;chr&gt;, Order &lt;chr&gt;, Family &lt;chr&gt;, Genus &lt;chr&gt;,
#   Species &lt;chr&gt;, COUNT &lt;dbl&gt;, SEASON &lt;chr&gt;, START &lt;date&gt;, END &lt;date&gt;,
#   DAY_NOYEAR &lt;date&gt;</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> combined_biol_metadata <span class="sc">%&gt;%</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COURSE_CLASSIFICATION <span class="sc">==</span> <span class="st">"Microeukaryote"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span> <span class="sc">|</span> Supergroup <span class="sc">==</span> <span class="st">"Stramenopiles"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pgC_ml =</span> COUNT <span class="sc">*</span> CARBON) <span class="sc">%&gt;%</span> </span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Supergroup, Phylum, Class, Order, Family, Genus, CELL_ID, COUNT, CARBON, pgC_ml) <span class="sc">%&gt;%</span></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(COUNT, CARBON, pgC_ml)) <span class="sc">%&gt;%</span> </span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Supergroup, Phylum, Class, Order, Family, Genus, CELL_ID, name) <span class="sc">%&gt;%</span> </span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">MEAN =</span> <span class="fu">mean</span>(value),</span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">MAX =</span> <span class="fu">max</span>(value),</span>
<span id="cb186-10"><a href="#cb186-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">MIN =</span> <span class="fu">min</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb186-11"><a href="#cb186-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Taxonomy, Supergroup, Phylum, Class, Order, Family, Genus, <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb186-12"><a href="#cb186-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> name, <span class="at">values_from =</span> <span class="fu">c</span>(MEAN, MAX, MIN), <span class="at">names_sep =</span> <span class="st">"_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Supergroup', 'Phylum', 'Class', 'Order',
'Family', 'Genus', 'CELL_ID'. You can override using the `.groups` argument.</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># table</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(table, file = "output-data/table_alveolata_stramenopiles_totalstats.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_biol_metadata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 32
  DATE       MONTH DAY.x  HOUR   MIN TEMP    SAL NOTES  gage_height_ft PRECIP_in
  &lt;date&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;
1 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
2 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
3 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
4 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
5 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
6 2008-01-01     1     1     0     0 16.2     NA temp …           23.0        NA
# ℹ 22 more variables: Phase &lt;chr&gt;, MLLW &lt;dbl&gt;, DIFFERENCE &lt;dbl&gt;,
#   tide_direction &lt;chr&gt;, DAY.y &lt;dttm&gt;, CELL_ID &lt;chr&gt;, CARBON &lt;dbl&gt;,
#   COURSE_CLASSIFICATION &lt;chr&gt;, TYPE &lt;chr&gt;, Domain &lt;chr&gt;, Supergroup &lt;chr&gt;,
#   Phylum &lt;chr&gt;, Class &lt;chr&gt;, Order &lt;chr&gt;, Family &lt;chr&gt;, Genus &lt;chr&gt;,
#   Species &lt;chr&gt;, COUNT &lt;dbl&gt;, SEASON &lt;chr&gt;, START &lt;date&gt;, END &lt;date&gt;,
#   DAY_NOYEAR &lt;date&gt;</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(combined_biol_metadata$Class)</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>combined_biol_metadata <span class="sc">%&gt;%</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COURSE_CLASSIFICATION <span class="sc">==</span> <span class="st">"Microeukaryote"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span> <span class="sc">|</span> Supergroup <span class="sc">==</span> <span class="st">"Stramenopiles"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Class <span class="sc">==</span> <span class="st">"Bacillariophyceae"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pgC_ml =</span> COUNT <span class="sc">*</span> CARBON) <span class="sc">%&gt;%</span> </span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DATE, Supergroup, Phylum, Class, Order, CELL_ID, COUNT, CARBON, pgC_ml) <span class="sc">%&gt;%</span></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(COUNT, CARBON, pgC_ml)) <span class="sc">%&gt;%</span> </span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DATE, Supergroup, Phylum, Class, Order, CELL_ID, name) <span class="sc">%&gt;%</span> </span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">MEAN =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VARIABLE_LABEL =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"COUNT"</span>, <span class="st">"CARBON"</span>, <span class="st">"pgC_ml"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="fu">bquote</span>(<span class="st">"Cells"</span><span class="sc">~</span>ml<span class="sc">^-</span><span class="dv">1</span>), <span class="fu">bquote</span>(<span class="st">"pg Carbon"</span><span class="sc">~</span>cell<span class="sc">^-</span><span class="dv">1</span>), <span class="fu">bquote</span>(<span class="st">"pg Carbon"</span><span class="sc">~</span>ml<span class="sc">^-</span><span class="dv">1</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb191-13"><a href="#cb191-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Order, <span class="at">y =</span> MEAN)) <span class="sc">+</span></span>
<span id="cb191-14"><a href="#cb191-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb191-15"><a href="#cb191-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb191-16"><a href="#cb191-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_x_date(date_labels = "%b", expand = c(0,0)) +</span></span>
<span id="cb191-17"><a href="#cb191-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb191-18"><a href="#cb191-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_flip() +</span></span>
<span id="cb191-19"><a href="#cb191-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(VARIABLE_LABEL), <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">labeller =</span> label_parsed) <span class="sc">+</span></span>
<span id="cb191-20"><a href="#cb191-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>) <span class="co">#+</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'DATE', 'Supergroup', 'Phylum', 'Class',
'Order', 'CELL_ID'. You can override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ifcb-data-wrangle_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_manual(values = c("#fead5d", "#1468b3","#00ac43","#f6f86d","#fc7e66", "#c304aa"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="rda-analysis" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> RDA analysis</h1>
<p>RDA reveals relationships among the sites (transcript profiles by site) and the environmental parameters. We can explore the relationship among all transcripts by site, and then model the effect that each environmental parameter has on it.</p>
<p>To perform the RDA analysis, we need to isolate biotic vs.&nbsp;abiotic parameters. Normalize them individually and then run the RDA.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load("input-data/data_annotated_wtax_wseason.RData", verbose = TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="subset-and-format-data" class="level3">
<h3 class="anchored" data-anchor-id="subset-and-format-data">Subset and format data</h3>
<p>Goal is to keep as many parameters as possible, but also export the biological data as a matrix that has the same dimensions as the metadata.</p>
<p>Isolate the abiotic parameters.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get non-numeric data here.</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="co"># season_cat &lt;- combined_biol_metadata %&gt;% </span></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(DAY, SEASON) %&gt;% </span></span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   distinct()</span></span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a><span class="co"># # Isolate numeric data</span></span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a><span class="co"># #WDIR, WSPD, ATMP, WTMP(SST), TIDE</span></span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a><span class="co"># abiotic_rda_input &lt;- combined_biol_metadata %&gt;% </span></span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   # select(DAY, WDIR, WSPD, ATMP, WTMP, TIDE) %&gt;% </span></span>
<span id="cb195-10"><a href="#cb195-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(DAY, ATMP, WTMP, TIDE) %&gt;% </span></span>
<span id="cb195-11"><a href="#cb195-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(ATMP != 999.0 | WTMP != 999.0 | TIDE != 999.0) %&gt;% </span></span>
<span id="cb195-12"><a href="#cb195-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   distinct() </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Repeat for biotic data</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(combined_biol_metadata$Phylum)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="co"># biotic_rda_input &lt;- combined_biol_metadata %&gt;% </span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(COURSE_CLASSIFICATION == "Microeukaryote" | COURSE_CLASSIFICATION == "Cyanobacteria") %&gt;% </span></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   # filter(Phylum == "Ochrophyta") %&gt;% </span></span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(DAY, CELL_ID, COUNT) %&gt;% distinct() %&gt;% </span></span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_wider(names_from = CELL_ID, values_from = COUNT, values_fn = mean, values_fill = 0) %&gt;% </span></span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   distinct() </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Compare dates. Create intersection of date time.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># biotic_rows &lt;- as.character((unique(biotic_rda_input$DAY)))</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="co"># abiotic_rows &lt;- as.character((unique(abiotic_rda_input$DAY)))</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="co"># intersect_rows &lt;- intersect(biotic_rows, abiotic_rows)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Compile matrices with date select as well.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># biotic_rda_input_filtered &lt;- biotic_rda_input %&gt;% </span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(as_datetime(DAY) %in% as_datetime(intersect_rows)) %&gt;% </span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   column_to_rownames(var = "DAY") %&gt;% </span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate_if(is.character, as.numeric) %&gt;%</span></span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   as.matrix</span></span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a><span class="co"># abiotic_rda_input_filtered &lt;- abiotic_rda_input %&gt;% </span></span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(as_datetime(DAY) %in% as_datetime(intersect_rows)) %&gt;% </span></span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   column_to_rownames(var = "DAY") %&gt;% </span></span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate_if(is.character, as.numeric) %&gt;%</span></span>
<span id="cb199-11"><a href="#cb199-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   as.matrix</span></span>
<span id="cb199-12"><a href="#cb199-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-13"><a href="#cb199-13" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(biotic_rda_input_filtered)</span></span>
<span id="cb199-14"><a href="#cb199-14" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(abiotic_rda_input_filtered)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Perform standardizations / normalizations</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a><span class="co"># standard_metadata &lt;- vegan::decostand(abiotic_rda_input_filtered, MARGIN = 2, method = "standardize", na.action = na.exclude)</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a><span class="co"># metadata_normed_all &lt;- data.frame(standard_metadata) %&gt;% </span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   rownames_to_column(var = "DAY") %&gt;% </span></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(DAY = as_datetime(DAY)) %&gt;% </span></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   right_join(season_cat) %&gt;% </span></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   drop_na() %&gt;% </span></span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   column_to_rownames(var = "DAY")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># biotic_rda_standard_count &lt;- vegan::decostand(biotic_rda_input_filtered, MARGIN = 2, method = "normalize")</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a><span class="co">#chi.square</span></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ?vegan::decostand</span></span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Repeat for carbon</span></span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a><span class="co"># repeat for carbon in ml.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Run the RDA</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rda_counts &lt;- rda(biotic_rda_standard_count ~ ., </span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a><span class="co">#                   data = metadata_normed_all)</span></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # ?rda()</span></span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a><span class="co"># # rda_counts</span></span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(rda_counts)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.5.0 (2025-04-11)
Platform: aarch64-apple-darwin20
Running under: macOS Sequoia 15.4

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Chicago
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] vegan_2.6-10       lattice_0.22-6     permute_0.9-7      compositions_2.0-8
 [5] treemapify_2.5.6   scales_1.3.0       svglite_2.1.3      patchwork_1.3.0   
 [9] lubridate_1.9.4    forcats_1.0.0      stringr_1.5.1      dplyr_1.1.4       
[13] purrr_1.0.4        readr_2.1.5        tidyr_1.3.1        tibble_3.2.1      
[17] ggplot2_3.5.2      tidyverse_2.0.0   

loaded via a namespace (and not attached):
 [1] ggfittext_0.10.2    gtable_0.3.6        tensorA_0.36.2.1   
 [4] xfun_0.52           tzdb_0.5.0          vctrs_0.6.5        
 [7] tools_4.5.0         generics_0.1.3      parallel_4.5.0     
[10] DEoptimR_1.1-3-1    cluster_2.1.8.1     pkgconfig_2.0.3    
[13] Matrix_1.7-3        lifecycle_1.0.4     compiler_4.5.0     
[16] farver_2.1.2        munsell_0.5.1       htmltools_0.5.8.1  
[19] yaml_2.3.10         pillar_1.10.2       crayon_1.5.3       
[22] MASS_7.3-65         nlme_3.1-168        robustbase_0.99-4-1
[25] tidyselect_1.2.1    digest_0.6.37       stringi_1.8.7      
[28] labeling_0.4.3      splines_4.5.0       fastmap_1.2.0      
[31] grid_4.5.0          colorspace_2.1-1    cli_3.6.4          
[34] magrittr_2.0.3      utf8_1.2.4          withr_3.0.2        
[37] bit64_4.6.0-1       timechange_0.3.0    rmarkdown_2.29     
[40] bit_4.6.0           hms_1.1.3           evaluate_1.0.3     
[43] knitr_1.50          mgcv_1.9-1          rlang_1.1.6        
[46] Rcpp_1.0.14         glue_1.8.0          bayesm_3.1-6       
[49] rstudioapi_0.17.1   vroom_1.6.5         jsonlite_2.0.0     
[52] R6_2.6.1            systemfonts_1.2.2  </code></pre>
</div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb205" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "ifcb-port aransas"</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb205-10"><a href="#cb205-10" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb205-11"><a href="#cb205-11" aria-hidden="true" tabindex="-1"></a><span class="co">    number-depth: 2</span></span>
<span id="cb205-12"><a href="#cb205-12" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb205-13"><a href="#cb205-13" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb205-14"><a href="#cb205-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-15"><a href="#cb205-15" aria-hidden="true" tabindex="-1"></a><span class="fu"># Set-up</span></span>
<span id="cb205-16"><a href="#cb205-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-17"><a href="#cb205-17" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb205-18"><a href="#cb205-18" aria-hidden="true" tabindex="-1"></a><span class="in"># | warning: false</span></span>
<span id="cb205-19"><a href="#cb205-19" aria-hidden="true" tabindex="-1"></a><span class="in"># | message: false</span></span>
<span id="cb205-20"><a href="#cb205-20" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb205-21"><a href="#cb205-21" aria-hidden="true" tabindex="-1"></a><span class="in">library(patchwork)</span></span>
<span id="cb205-22"><a href="#cb205-22" aria-hidden="true" tabindex="-1"></a><span class="in">library(svglite)</span></span>
<span id="cb205-23"><a href="#cb205-23" aria-hidden="true" tabindex="-1"></a><span class="in">library(scales)</span></span>
<span id="cb205-24"><a href="#cb205-24" aria-hidden="true" tabindex="-1"></a><span class="in">library(treemapify)</span></span>
<span id="cb205-25"><a href="#cb205-25" aria-hidden="true" tabindex="-1"></a><span class="in">library(compositions); library(vegan)</span></span>
<span id="cb205-26"><a href="#cb205-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-27"><a href="#cb205-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-28"><a href="#cb205-28" aria-hidden="true" tabindex="-1"></a><span class="fu"># Preliminary input data</span></span>
<span id="cb205-29"><a href="#cb205-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-30"><a href="#cb205-30" aria-hidden="true" tabindex="-1"></a>All data from Port Aransas. Counts by hour. Remove data before January 1 2008, as it was newly deployed and has some inconsistencies. Also using lubridate to convert to R-friendly date/time formats.</span>
<span id="cb205-31"><a href="#cb205-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-32"><a href="#cb205-32" aria-hidden="true" tabindex="-1"></a>Time zone is UTC and units of carbon are pg C per cell.</span>
<span id="cb205-33"><a href="#cb205-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-36"><a href="#cb205-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-37"><a href="#cb205-37" aria-hidden="true" tabindex="-1"></a><span class="co"># head(counts)</span></span>
<span id="cb205-38"><a href="#cb205-38" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"input-data/counts_hourly_Hu.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb205-39"><a href="#cb205-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use lubridate package to assign "date" format.</span></span>
<span id="cb205-40"><a href="#cb205-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DAY =</span> <span class="fu">ymd_hms</span>(X)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-41"><a href="#cb205-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE =</span> <span class="fu">date</span>(DAY),</span>
<span id="cb205-42"><a href="#cb205-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(DAY),</span>
<span id="cb205-43"><a href="#cb205-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">HOUR =</span> <span class="fu">hour</span>(DAY)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-44"><a href="#cb205-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DAY, DATE, MONTH, HOUR, <span class="fu">everything</span>(), <span class="sc">-</span>X) <span class="sc">%&gt;%</span> </span>
<span id="cb205-45"><a href="#cb205-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as_date</span>(DAY) <span class="sc">&gt;=</span> <span class="fu">as_date</span>(<span class="st">"2008-01-01"</span>) <span class="sc">&amp;</span> </span>
<span id="cb205-46"><a href="#cb205-46" aria-hidden="true" tabindex="-1"></a>           <span class="fu">as_date</span>(DAY) <span class="sc">&lt;=</span> <span class="fu">as_date</span>(<span class="st">"2017-08-24"</span>))</span>
<span id="cb205-47"><a href="#cb205-47" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(counts)</span></span>
<span id="cb205-48"><a href="#cb205-48" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(counts<span class="sc">$</span>DAY)</span>
<span id="cb205-49"><a href="#cb205-49" aria-hidden="true" tabindex="-1"></a><span class="co"># head(counts)</span></span>
<span id="cb205-50"><a href="#cb205-50" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-51"><a href="#cb205-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-52"><a href="#cb205-52" aria-hidden="true" tabindex="-1"></a>Carbon biomass by day. pgC per cell.</span>
<span id="cb205-53"><a href="#cb205-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-56"><a href="#cb205-56" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-57"><a href="#cb205-57" aria-hidden="true" tabindex="-1"></a>carbon <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"input-data/carbon_hourly.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-58"><a href="#cb205-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DAY =</span> <span class="fu">ymd_hms</span>(X)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-59"><a href="#cb205-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE =</span> <span class="fu">date</span>(DAY),</span>
<span id="cb205-60"><a href="#cb205-60" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(DAY),</span>
<span id="cb205-61"><a href="#cb205-61" aria-hidden="true" tabindex="-1"></a>         <span class="at">HOUR =</span> <span class="fu">hour</span>(DAY)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-62"><a href="#cb205-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DAY, DATE, MONTH, HOUR, <span class="fu">everything</span>(), <span class="sc">-</span>X) <span class="sc">%&gt;%</span> </span>
<span id="cb205-63"><a href="#cb205-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as_date</span>(DAY) <span class="sc">&gt;=</span> <span class="fu">as_date</span>(<span class="st">"2008-01-01"</span>) <span class="sc">&amp;</span> </span>
<span id="cb205-64"><a href="#cb205-64" aria-hidden="true" tabindex="-1"></a>           <span class="fu">as_date</span>(DAY) <span class="sc">&lt;=</span> <span class="fu">as_date</span>(<span class="st">"2017-08-24"</span>))</span>
<span id="cb205-65"><a href="#cb205-65" aria-hidden="true" tabindex="-1"></a><span class="co"># head(carbon)</span></span>
<span id="cb205-66"><a href="#cb205-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-67"><a href="#cb205-67" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(carbon<span class="sc">$</span>DAY)</span>
<span id="cb205-68"><a href="#cb205-68" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(carbon)</span></span>
<span id="cb205-69"><a href="#cb205-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-70"><a href="#cb205-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-71"><a href="#cb205-71" aria-hidden="true" tabindex="-1"></a>Subset so dataset includes "2008-01-01" to "2017-08-24".</span>
<span id="cb205-72"><a href="#cb205-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-75"><a href="#cb205-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-76"><a href="#cb205-76" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(carbon)</span>
<span id="cb205-77"><a href="#cb205-77" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(counts)</span>
<span id="cb205-78"><a href="#cb205-78" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-79"><a href="#cb205-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-80"><a href="#cb205-80" aria-hidden="true" tabindex="-1"></a><span class="fu">### Export taxa names for manual curation</span></span>
<span id="cb205-81"><a href="#cb205-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-82"><a href="#cb205-82" aria-hidden="true" tabindex="-1"></a>Export for manual curation</span>
<span id="cb205-83"><a href="#cb205-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-86"><a href="#cb205-86" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-87"><a href="#cb205-87" aria-hidden="true" tabindex="-1"></a><span class="co"># tax_export &lt;- counts %&gt;% </span></span>
<span id="cb205-88"><a href="#cb205-88" aria-hidden="true" tabindex="-1"></a><span class="co">#     pivot_longer(cols = -c(DAY), names_to = "CELL_ID", values_to = "COUNT") %&gt;% #Add in time here when we have it.</span></span>
<span id="cb205-89"><a href="#cb205-89" aria-hidden="true" tabindex="-1"></a><span class="co">#     select(CELL_ID) %&gt;% distinct()</span></span>
<span id="cb205-90"><a href="#cb205-90" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-91"><a href="#cb205-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-92"><a href="#cb205-92" aria-hidden="true" tabindex="-1"></a><span class="fu">### Add taxa curated to cell IDs and carbon data</span></span>
<span id="cb205-93"><a href="#cb205-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-94"><a href="#cb205-94" aria-hidden="true" tabindex="-1"></a>Siddarth contributed to this taxa list.</span>
<span id="cb205-95"><a href="#cb205-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-98"><a href="#cb205-98" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-99"><a href="#cb205-99" aria-hidden="true" tabindex="-1"></a>tax_curated <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"input-data/tax-list.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb205-100"><a href="#cb205-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CELL_ID<span class="sc">:</span>Species) </span>
<span id="cb205-101"><a href="#cb205-101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-102"><a href="#cb205-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-103"><a href="#cb205-103" aria-hidden="true" tabindex="-1"></a>Add to cell ID information</span>
<span id="cb205-104"><a href="#cb205-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-107"><a href="#cb205-107" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-108"><a href="#cb205-108" aria-hidden="true" tabindex="-1"></a>counts_long_wtax <span class="ot">&lt;-</span> counts <span class="sc">%&gt;%</span> </span>
<span id="cb205-109"><a href="#cb205-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(DAY, DATE, MONTH, HOUR), <span class="at">names_to =</span> <span class="st">"CELL_ID"</span>, <span class="at">values_to =</span> <span class="st">"COUNT"</span>, <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-110"><a href="#cb205-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COUNT <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-111"><a href="#cb205-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tax_curated)</span>
<span id="cb205-112"><a href="#cb205-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-113"><a href="#cb205-113" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(counts_long_wtax)</span>
<span id="cb205-114"><a href="#cb205-114" aria-hidden="true" tabindex="-1"></a><span class="co"># range(counts_long_wtax$COUNT)</span></span>
<span id="cb205-115"><a href="#cb205-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-116"><a href="#cb205-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-117"><a href="#cb205-117" aria-hidden="true" tabindex="-1"></a>Add to carbon data</span>
<span id="cb205-118"><a href="#cb205-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-121"><a href="#cb205-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-122"><a href="#cb205-122" aria-hidden="true" tabindex="-1"></a>carbon_long_wtax <span class="ot">&lt;-</span> carbon <span class="sc">%&gt;%</span> </span>
<span id="cb205-123"><a href="#cb205-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(DAY, DATE, MONTH, HOUR), <span class="at">names_to =</span> <span class="st">"CELL_ID"</span>, <span class="at">values_to =</span> <span class="st">"CARBON"</span>, <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-124"><a href="#cb205-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CARBON <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-125"><a href="#cb205-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tax_curated)</span>
<span id="cb205-126"><a href="#cb205-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-127"><a href="#cb205-127" aria-hidden="true" tabindex="-1"></a><span class="co"># head(carbon_long_wtax)</span></span>
<span id="cb205-128"><a href="#cb205-128" aria-hidden="true" tabindex="-1"></a><span class="co"># range(carbon_long_wtax$CARBON)</span></span>
<span id="cb205-129"><a href="#cb205-129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-130"><a href="#cb205-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-131"><a href="#cb205-131" aria-hidden="true" tabindex="-1"></a><span class="fu">## Combine carbon and cell counts</span></span>
<span id="cb205-132"><a href="#cb205-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-135"><a href="#cb205-135" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-136"><a href="#cb205-136" aria-hidden="true" tabindex="-1"></a>combined_gom_long <span class="ot">&lt;-</span> carbon_long_wtax <span class="sc">%&gt;%</span> </span>
<span id="cb205-137"><a href="#cb205-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(counts_long_wtax)</span>
<span id="cb205-138"><a href="#cb205-138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-139"><a href="#cb205-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-140"><a href="#cb205-140" aria-hidden="true" tabindex="-1"></a>Types of classifications in dataset.</span>
<span id="cb205-141"><a href="#cb205-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-144"><a href="#cb205-144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-145"><a href="#cb205-145" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(combined_gom_long<span class="sc">$</span>COURSE_CLASSIFICATION)</span>
<span id="cb205-146"><a href="#cb205-146" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(combined_gom_long<span class="sc">$</span>TYPE)</span>
<span id="cb205-147"><a href="#cb205-147" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(combined_gom_long)</span></span>
<span id="cb205-148"><a href="#cb205-148" aria-hidden="true" tabindex="-1"></a><span class="co"># table(combined_gom_long$COURSE_CLASSIFICATION)</span></span>
<span id="cb205-149"><a href="#cb205-149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-150"><a href="#cb205-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-151"><a href="#cb205-151" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; What is the range of cellular carbon for each cell ID?</span></span>
<span id="cb205-152"><a href="#cb205-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-153"><a href="#cb205-153" aria-hidden="true" tabindex="-1"></a>There are 130 entries.</span>
<span id="cb205-154"><a href="#cb205-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-157"><a href="#cb205-157" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-158"><a href="#cb205-158" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(combined_gom_long<span class="sc">$</span>CELL_ID))</span>
<span id="cb205-159"><a href="#cb205-159" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(combined_gom_long<span class="sc">$</span>Phylum)</span>
<span id="cb205-160"><a href="#cb205-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-161"><a href="#cb205-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-162"><a href="#cb205-162" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=7, fig.width=28}</span></span>
<span id="cb205-163"><a href="#cb205-163" aria-hidden="true" tabindex="-1"></a><span class="in">rm &lt;- c("IFCB excess", "Larvae")</span></span>
<span id="cb205-164"><a href="#cb205-164" aria-hidden="true" tabindex="-1"></a><span class="in"># hist(combined_gom_long$CARBON)</span></span>
<span id="cb205-165"><a href="#cb205-165" aria-hidden="true" tabindex="-1"></a><span class="in">combined_gom_long %&gt;% </span></span>
<span id="cb205-166"><a href="#cb205-166" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(!(COURSE_CLASSIFICATION %in% rm)) %&gt;% </span></span>
<span id="cb205-167"><a href="#cb205-167" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(COURSE_CLASSIFICATION == "Microeukaryote") %&gt;%</span></span>
<span id="cb205-168"><a href="#cb205-168" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(Supergroup == "Alveolata") %&gt;% </span></span>
<span id="cb205-169"><a href="#cb205-169" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = CELL_ID, y = CARBON, fill = Phylum)) +</span></span>
<span id="cb205-170"><a href="#cb205-170" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_violin() +</span></span>
<span id="cb205-171"><a href="#cb205-171" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(cols = vars(Phylum), scales = "free_x", space = "free_x") +</span></span>
<span id="cb205-172"><a href="#cb205-172" aria-hidden="true" tabindex="-1"></a><span class="in">  # facet_wrap(vars(Phylum), scales = "free", as.table = FALSE) +</span></span>
<span id="cb205-173"><a href="#cb205-173" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb205-174"><a href="#cb205-174" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_log10() +</span></span>
<span id="cb205-175"><a href="#cb205-175" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "", y = bquote("pg C"~cell^-1)) +</span></span>
<span id="cb205-176"><a href="#cb205-176" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom", legend.title = element_blank(),</span></span>
<span id="cb205-177"><a href="#cb205-177" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text.y = element_text(color = "black", face = "bold", size = 14),</span></span>
<span id="cb205-178"><a href="#cb205-178" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.background = element_blank(),</span></span>
<span id="cb205-179"><a href="#cb205-179" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.placement = "outside",</span></span>
<span id="cb205-180"><a href="#cb205-180" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.x = element_text(color = "black", size = 10, angle = 45, vjust = 1, hjust = 1),</span></span>
<span id="cb205-181"><a href="#cb205-181" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title = element_text(color = "black", size = 10),</span></span>
<span id="cb205-182"><a href="#cb205-182" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.y = element_text(color = "black", size = 10),</span></span>
<span id="cb205-183"><a href="#cb205-183" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid.major = element_line(color = "#d9d9d9", linewidth = 0.2))</span></span>
<span id="cb205-184"><a href="#cb205-184" aria-hidden="true" tabindex="-1"></a><span class="in"># ?facet_wrap()</span></span>
<span id="cb205-185"><a href="#cb205-185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-186"><a href="#cb205-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-187"><a href="#cb205-187" aria-hidden="true" tabindex="-1"></a><span class="fu">## Add seasons</span></span>
<span id="cb205-188"><a href="#cb205-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-189"><a href="#cb205-189" aria-hidden="true" tabindex="-1"></a>Make data frames to assign season</span>
<span id="cb205-190"><a href="#cb205-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-191"><a href="#cb205-191" aria-hidden="true" tabindex="-1"></a>Spring = March 1 - May 31 Summer = June 1 - Aug 31 Fall = Sept 1 - Nov 30 Winter = Dec 1 - Feb (March 1 (-1))</span>
<span id="cb205-192"><a href="#cb205-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-193"><a href="#cb205-193" aria-hidden="true" tabindex="-1"></a>Make a new dataframe to just add seasons (manually) to the date. I'm subsetting to 2024 to include leap day years.</span>
<span id="cb205-194"><a href="#cb205-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-197"><a href="#cb205-197" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-198"><a href="#cb205-198" aria-hidden="true" tabindex="-1"></a>df_season <span class="ot">&lt;-</span> counts <span class="sc">%&gt;%</span> </span>
<span id="cb205-199"><a href="#cb205-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(DAY, DATE, MONTH, HOUR), <span class="at">names_to =</span> <span class="st">"CELL_ID"</span>, <span class="at">values_to =</span> <span class="st">"COUNT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb205-200"><a href="#cb205-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATA_GAP =</span> <span class="fu">case_when</span>(</span>
<span id="cb205-201"><a href="#cb205-201" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(COUNT) <span class="sc">~</span> <span class="st">"Missing"</span>,</span>
<span id="cb205-202"><a href="#cb205-202" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Not missing"</span></span>
<span id="cb205-203"><a href="#cb205-203" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb205-204"><a href="#cb205-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_tmp =</span>  <span class="fu">as.Date</span>(<span class="fu">format</span>(DAY, <span class="st">'2024-%m-%d'</span>)), </span>
<span id="cb205-205"><a href="#cb205-205" aria-hidden="true" tabindex="-1"></a>        <span class="at">SEASON =</span> <span class="fu">case_when</span>(<span class="fu">between</span>(date_tmp, <span class="fu">ymd</span>(<span class="st">'2024-03-01'</span>), <span class="fu">ymd</span>(<span class="st">'2024-05-31'</span>)) <span class="sc">~</span> <span class="st">"Spring"</span>,</span>
<span id="cb205-206"><a href="#cb205-206" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">between</span>(date_tmp, <span class="fu">ymd</span>(<span class="st">'2024-06-01'</span>), <span class="fu">ymd</span>(<span class="st">'2024-08-31'</span>)) <span class="sc">~</span> <span class="st">"Summer"</span>, </span>
<span id="cb205-207"><a href="#cb205-207" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">between</span>(date_tmp, <span class="fu">ymd</span>(<span class="st">'2024-09-01'</span>), <span class="fu">ymd</span>(<span class="st">'2024-11-30'</span>)) <span class="sc">~</span> <span class="st">"Fall"</span>, </span>
<span id="cb205-208"><a href="#cb205-208" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Winter"</span>)) <span class="sc">%&gt;%</span> <span class="co"># Winter needs to be "else" because you can't select between.</span></span>
<span id="cb205-209"><a href="#cb205-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DAY, date_tmp, SEASON, DATA_GAP) <span class="sc">|&gt;</span> <span class="fu">distinct</span>() <span class="sc">|&gt;</span> </span>
<span id="cb205-210"><a href="#cb205-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YEAR =</span> <span class="fu">year</span>(DAY),</span>
<span id="cb205-211"><a href="#cb205-211" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(DAY),</span>
<span id="cb205-212"><a href="#cb205-212" aria-hidden="true" tabindex="-1"></a>         <span class="at">DATE =</span> <span class="fu">day</span>(DAY),</span>
<span id="cb205-213"><a href="#cb205-213" aria-hidden="true" tabindex="-1"></a>         <span class="at">HOUR =</span> <span class="fu">hour</span>(DAY)) <span class="sc">|&gt;</span> </span>
<span id="cb205-214"><a href="#cb205-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SEASON) <span class="sc">|&gt;</span> </span>
<span id="cb205-215"><a href="#cb205-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month_start_tmp =</span> <span class="fu">case_when</span>(</span>
<span id="cb205-216"><a href="#cb205-216" aria-hidden="true" tabindex="-1"></a>    SEASON <span class="sc">==</span> <span class="st">"Winter"</span> <span class="sc">~</span> <span class="fu">max</span>(MONTH),</span>
<span id="cb205-217"><a href="#cb205-217" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">min</span>(MONTH)),</span>
<span id="cb205-218"><a href="#cb205-218" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_start_tmp =</span> <span class="fu">case_when</span>(SEASON <span class="sc">==</span> <span class="st">"Winter"</span> <span class="sc">~</span> YEAR <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb205-219"><a href="#cb205-219" aria-hidden="true" tabindex="-1"></a>                               <span class="cn">TRUE</span> <span class="sc">~</span> YEAR),</span>
<span id="cb205-220"><a href="#cb205-220" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb205-221"><a href="#cb205-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month_end_tmp =</span> <span class="fu">case_when</span>(</span>
<span id="cb205-222"><a href="#cb205-222" aria-hidden="true" tabindex="-1"></a>    SEASON <span class="sc">==</span> <span class="st">"Winter"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb205-223"><a href="#cb205-223" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">max</span>(MONTH))) <span class="sc">|&gt;</span> </span>
<span id="cb205-224"><a href="#cb205-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SEASON, MONTH) <span class="sc">|&gt;</span> </span>
<span id="cb205-225"><a href="#cb205-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">day_start_tmp =</span> <span class="fu">min</span>(<span class="fu">day</span>(DAY)),</span>
<span id="cb205-226"><a href="#cb205-226" aria-hidden="true" tabindex="-1"></a>         <span class="at">day_end_tmp =</span> <span class="fu">case_when</span>(</span>
<span id="cb205-227"><a href="#cb205-227" aria-hidden="true" tabindex="-1"></a>           (SEASON <span class="sc">==</span> <span class="st">"Winter"</span> <span class="sc">&amp;</span> <span class="fu">leap_year</span>(YEAR) <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="dv">29</span>,</span>
<span id="cb205-228"><a href="#cb205-228" aria-hidden="true" tabindex="-1"></a>           (SEASON <span class="sc">==</span> <span class="st">"Winter"</span> <span class="sc">&amp;</span> <span class="fu">leap_year</span>(YEAR) <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">~</span> <span class="dv">28</span>,</span>
<span id="cb205-229"><a href="#cb205-229" aria-hidden="true" tabindex="-1"></a>           (SEASON <span class="sc">==</span> <span class="st">"Summer"</span> <span class="sc">|</span> SEASON <span class="sc">==</span> <span class="st">"Spring"</span>) <span class="sc">~</span> <span class="dv">31</span>,</span>
<span id="cb205-230"><a href="#cb205-230" aria-hidden="true" tabindex="-1"></a>           SEASON <span class="sc">==</span> <span class="st">"Fall"</span> <span class="sc">~</span> <span class="dv">30</span></span>
<span id="cb205-231"><a href="#cb205-231" aria-hidden="true" tabindex="-1"></a>         )) <span class="sc">|&gt;</span> </span>
<span id="cb205-232"><a href="#cb205-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb205-233"><a href="#cb205-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"start"</span>, year_start_tmp, month_start_tmp, day_start_tmp, <span class="at">sep =</span> <span class="st">"-"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb205-234"><a href="#cb205-234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"end"</span>, YEAR, month_end_tmp, day_end_tmp, <span class="at">sep =</span> <span class="st">"-"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb205-235"><a href="#cb205-235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">START =</span> <span class="fu">ymd</span>(start),</span>
<span id="cb205-236"><a href="#cb205-236" aria-hidden="true" tabindex="-1"></a>         <span class="at">END =</span> <span class="fu">ymd</span>(end),</span>
<span id="cb205-237"><a href="#cb205-237" aria-hidden="true" tabindex="-1"></a>         <span class="at">START_noy =</span> <span class="fu">mdy</span>(<span class="fu">paste</span>(<span class="fu">month</span>(START), <span class="fu">day</span>(START), <span class="st">"2024"</span>, <span class="at">sep =</span> <span class="st">"-"</span>)),</span>
<span id="cb205-238"><a href="#cb205-238" aria-hidden="true" tabindex="-1"></a>         <span class="at">END_noy =</span> <span class="fu">mdy</span>(<span class="fu">paste</span>(<span class="fu">month</span>(END), <span class="fu">day</span>(END), <span class="st">"2024"</span>, <span class="at">sep =</span> <span class="st">"-"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb205-239"><a href="#cb205-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DAY, DATE, MONTH, YEAR, HOUR, SEASON, START, END, START_noy, END_noy) <span class="sc">|&gt;</span> <span class="fu">distinct</span>()</span>
<span id="cb205-240"><a href="#cb205-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-241"><a href="#cb205-241" aria-hidden="true" tabindex="-1"></a><span class="co"># head(df_season)</span></span>
<span id="cb205-242"><a href="#cb205-242" aria-hidden="true" tabindex="-1"></a><span class="co"># View(df_season |&gt; select(SEASON, START, </span><span class="re">END</span><span class="co">) |&gt; distinct())</span></span>
<span id="cb205-243"><a href="#cb205-243" aria-hidden="true" tabindex="-1"></a>df_oneyear <span class="ot">&lt;-</span> df_season <span class="sc">|&gt;</span> </span>
<span id="cb205-244"><a href="#cb205-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE =</span> <span class="fu">mdy</span>(<span class="fu">paste</span>(<span class="fu">month</span>(DAY), <span class="fu">day</span>(DAY), <span class="st">"2024"</span>, <span class="at">sep =</span> <span class="st">"-"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb205-245"><a href="#cb205-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SEASON, START_noy, END_noy, DATE) <span class="sc">|&gt;</span> </span>
<span id="cb205-246"><a href="#cb205-246" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(!(SEASON == "Winter" &amp; (month(START_noy) == 12))) |&gt; </span></span>
<span id="cb205-247"><a href="#cb205-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb205-248"><a href="#cb205-248" aria-hidden="true" tabindex="-1"></a><span class="co"># head(df_oneyear)</span></span>
<span id="cb205-249"><a href="#cb205-249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-250"><a href="#cb205-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-251"><a href="#cb205-251" aria-hidden="true" tabindex="-1"></a>Test seasonal plot</span>
<span id="cb205-252"><a href="#cb205-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-253"><a href="#cb205-253" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=4, fig.width=6}</span></span>
<span id="cb205-254"><a href="#cb205-254" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot multiple years</span></span>
<span id="cb205-255"><a href="#cb205-255" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(df_season, aes(x = as_date(DAY))) +</span></span>
<span id="cb205-256"><a href="#cb205-256" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_rect(data = (filter(df_season, SEASON == "Fall")), alpha = 0.2, fill = "#cc5500",</span></span>
<span id="cb205-257"><a href="#cb205-257" aria-hidden="true" tabindex="-1"></a><span class="in">            aes(xmin = START, xmax = END, ymin = 0, ymax = 10000)) +</span></span>
<span id="cb205-258"><a href="#cb205-258" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_rect(data = (filter(df_season, SEASON == "Spring")), alpha = 0.2, fill = "#bccbae",</span></span>
<span id="cb205-259"><a href="#cb205-259" aria-hidden="true" tabindex="-1"></a><span class="in">            aes(xmin = START, xmax = END, ymin = 0, ymax = 10000)) +</span></span>
<span id="cb205-260"><a href="#cb205-260" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_rect(data = (filter(df_season, SEASON == "Summer")), alpha = 0.2, fill = "#ffbf00",</span></span>
<span id="cb205-261"><a href="#cb205-261" aria-hidden="true" tabindex="-1"></a><span class="in">            aes(xmin = START, xmax = END, ymin = 0, ymax = 10000)) +</span></span>
<span id="cb205-262"><a href="#cb205-262" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_rect(data = (filter(df_season, SEASON == "Winter")), alpha = 0.2, fill = "#5d4e62",</span></span>
<span id="cb205-263"><a href="#cb205-263" aria-hidden="true" tabindex="-1"></a><span class="in">            aes(xmin = START, xmax = END, ymin = 0, ymax = 10000))</span></span>
<span id="cb205-264"><a href="#cb205-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-265"><a href="#cb205-265" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot one year</span></span>
<span id="cb205-266"><a href="#cb205-266" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(df_oneyear, aes(x = as_date(DATE))) +</span></span>
<span id="cb205-267"><a href="#cb205-267" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_rect(data = (filter(df_oneyear, SEASON == "Fall")), alpha = 0.2, fill = "#cc5500",</span></span>
<span id="cb205-268"><a href="#cb205-268" aria-hidden="true" tabindex="-1"></a><span class="in">            aes(xmin = START_noy, xmax = END_noy, ymin = 0, ymax = 10000)) +</span></span>
<span id="cb205-269"><a href="#cb205-269" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_rect(data = (filter(df_oneyear, SEASON == "Spring")), alpha = 0.2, fill = "#bccbae",</span></span>
<span id="cb205-270"><a href="#cb205-270" aria-hidden="true" tabindex="-1"></a><span class="in">            aes(xmin = START_noy, xmax = END_noy, ymin = 0, ymax = 10000)) +</span></span>
<span id="cb205-271"><a href="#cb205-271" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_rect(data = (filter(df_oneyear, SEASON == "Summer")), alpha = 0.2, fill = "#ffbf00",</span></span>
<span id="cb205-272"><a href="#cb205-272" aria-hidden="true" tabindex="-1"></a><span class="in">            aes(xmin = START_noy, xmax = END_noy, ymin = 0, ymax = 10000)) +</span></span>
<span id="cb205-273"><a href="#cb205-273" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_rect(data = (filter(df_oneyear, SEASON == "Winter")), alpha = 0.2, fill = "#5d4e62",</span></span>
<span id="cb205-274"><a href="#cb205-274" aria-hidden="true" tabindex="-1"></a><span class="in">            aes(xmin = as_date("2024-01-01"), xmax = END_noy, ymin = 0, ymax = 10000)) +</span></span>
<span id="cb205-275"><a href="#cb205-275" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_rect(data = (filter(df_oneyear, SEASON == "Winter")), alpha = 0.2, fill = "#5d4e62",</span></span>
<span id="cb205-276"><a href="#cb205-276" aria-hidden="true" tabindex="-1"></a><span class="in">            aes(xmin = START_noy, xmax = as_date("2024-12-31"), ymin = 0, ymax = 10000))</span></span>
<span id="cb205-277"><a href="#cb205-277" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-278"><a href="#cb205-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-279"><a href="#cb205-279" aria-hidden="true" tabindex="-1"></a>Combine with existing data frame.</span>
<span id="cb205-280"><a href="#cb205-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-283"><a href="#cb205-283" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-284"><a href="#cb205-284" aria-hidden="true" tabindex="-1"></a>combined_gom_long_season <span class="ot">&lt;-</span> combined_gom_long <span class="sc">%&gt;%</span> </span>
<span id="cb205-285"><a href="#cb205-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_season <span class="sc">%&gt;%</span> <span class="fu">select</span>(DAY, SEASON, START, END)) <span class="sc">%&gt;%</span></span>
<span id="cb205-286"><a href="#cb205-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">day_noyear =</span> <span class="fu">paste</span>(MONTH, <span class="fu">day</span>(DAY), <span class="st">"2024"</span>, <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb205-287"><a href="#cb205-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DAY_NOYEAR =</span> <span class="fu">mdy</span>(day_noyear)) <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>day_noyear)</span>
<span id="cb205-288"><a href="#cb205-288" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(df_season$SEASON)</span></span>
<span id="cb205-289"><a href="#cb205-289" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(combined_gom_long_season$SEASON)</span></span>
<span id="cb205-290"><a href="#cb205-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-291"><a href="#cb205-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-294"><a href="#cb205-294" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-295"><a href="#cb205-295" aria-hidden="true" tabindex="-1"></a><span class="co"># head()</span></span>
<span id="cb205-296"><a href="#cb205-296" aria-hidden="true" tabindex="-1"></a><span class="co"># save(combined_gom_long, combined_gom_long_season, df_season, file = "output-data/ifcb-data-04142025.RData") #</span></span>
<span id="cb205-297"><a href="#cb205-297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-298"><a href="#cb205-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-299"><a href="#cb205-299" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data checkpoint option here</span></span>
<span id="cb205-300"><a href="#cb205-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-303"><a href="#cb205-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-304"><a href="#cb205-304" aria-hidden="true" tabindex="-1"></a><span class="co"># load(file = "output-data/ifcb-data-04142025.RData", verbose = TRUE)</span></span>
<span id="cb205-305"><a href="#cb205-305" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-306"><a href="#cb205-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-307"><a href="#cb205-307" aria-hidden="true" tabindex="-1"></a><span class="fu"># Import Gulf metadata</span></span>
<span id="cb205-308"><a href="#cb205-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-309"><a href="#cb205-309" aria-hidden="true" tabindex="-1"></a>Metadata information compiled by Siddarth Seshampally.</span>
<span id="cb205-310"><a href="#cb205-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-311"><a href="#cb205-311" aria-hidden="true" tabindex="-1"></a><span class="fu">## Temperature &amp; Salinity</span></span>
<span id="cb205-312"><a href="#cb205-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-313"><a href="#cb205-313" aria-hidden="true" tabindex="-1"></a>Import from TABS D manual pull of data.</span>
<span id="cb205-314"><a href="#cb205-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-317"><a href="#cb205-317" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-318"><a href="#cb205-318" aria-hidden="true" tabindex="-1"></a>tabs_d <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="at">file =</span> <span class="st">"input-data/TABS_D/tabs_D_salt.asc"</span>,</span>
<span id="cb205-319"><a href="#cb205-319" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_names =</span> <span class="cn">FALSE</span>, <span class="at">delim =</span> <span class="st">" "</span>)</span>
<span id="cb205-320"><a href="#cb205-320" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tabs_d)</span>
<span id="cb205-321"><a href="#cb205-321" aria-hidden="true" tabindex="-1"></a><span class="co"># ?read_delim()</span></span>
<span id="cb205-322"><a href="#cb205-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-323"><a href="#cb205-323" aria-hidden="true" tabindex="-1"></a>tabs_d_qc <span class="ot">&lt;-</span> tabs_d <span class="sc">%&gt;%</span></span>
<span id="cb205-324"><a href="#cb205-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">date =</span> X1, <span class="at">time =</span> X2, <span class="at">temp =</span> X4, <span class="at">sal =</span> X9)</span>
<span id="cb205-325"><a href="#cb205-325" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tabs_d_qc)</span>
<span id="cb205-326"><a href="#cb205-326" aria-hidden="true" tabindex="-1"></a>tabs_temp_sal_2010 <span class="ot">&lt;-</span> tabs_d_qc <span class="sc">%&gt;%</span> </span>
<span id="cb205-327"><a href="#cb205-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE =</span> <span class="fu">mdy</span>(date),</span>
<span id="cb205-328"><a href="#cb205-328" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(DATE),</span>
<span id="cb205-329"><a href="#cb205-329" aria-hidden="true" tabindex="-1"></a>         <span class="at">DAY =</span> <span class="fu">day</span>(DATE),</span>
<span id="cb205-330"><a href="#cb205-330" aria-hidden="true" tabindex="-1"></a>         <span class="at">HOUR =</span> <span class="fu">hour</span>(<span class="fu">hms</span>(time)),</span>
<span id="cb205-331"><a href="#cb205-331" aria-hidden="true" tabindex="-1"></a>         <span class="at">MIN =</span> <span class="fu">minute</span>(<span class="fu">hms</span>(time))) <span class="sc">%&gt;%</span> </span>
<span id="cb205-332"><a href="#cb205-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DATE, MONTH, DAY, HOUR, MIN, <span class="at">TEMP =</span> temp, <span class="at">SAL =</span> sal) <span class="sc">%&gt;%</span> </span>
<span id="cb205-333"><a href="#cb205-333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as_date</span>(DATE) <span class="sc">&lt;=</span> <span class="fu">as_date</span>(<span class="st">"2017-08-24"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-334"><a href="#cb205-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">NOTES =</span> <span class="st">"temp and salinity from TABS D data water property data"</span>)</span>
<span id="cb205-335"><a href="#cb205-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-336"><a href="#cb205-336" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(tabs_temp_sal_2010<span class="sc">$</span>DATE)</span>
<span id="cb205-337"><a href="#cb205-337" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-338"><a href="#cb205-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-339"><a href="#cb205-339" aria-hidden="true" tabindex="-1"></a>Water Property Data (from TABS website).</span>
<span id="cb205-340"><a href="#cb205-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-341"><a href="#cb205-341" aria-hidden="true" tabindex="-1"></a>Date \| Time \| WaterT \|Conduct\| Salt \| Chloro \|Crude Oil\| Fuel Oil\| WaterT \| \| (UTC) \| (°C) \| \| \| \| \| \| (°C) \| ==========+========+========+=======+=======+=========+=========+=========+=========+ 04/14/2025 00:00:00 21.65 47.54 33.37 0.00 0.00 04/14/2025 00:30:00 21.60 47.54 33.40 0.00 0.00 04/14/2025 01:00:00 21.64 47.58 33.40 0.00 0.00</span>
<span id="cb205-342"><a href="#cb205-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-343"><a href="#cb205-343" aria-hidden="true" tabindex="-1"></a>Above data from TABs starts in 2010. Import other TABS data that has earlier temperature values. Column headers are: \| (UTC) \| (cm/s)\| (cm/s)\| (cm/s)\| (\xb0T) \| (\xb0C) \|</span>
<span id="cb205-344"><a href="#cb205-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-347"><a href="#cb205-347" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-348"><a href="#cb205-348" aria-hidden="true" tabindex="-1"></a>tabs_temp_vel <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"input-data/TABS_D/TABS_D_vel_2007-2016.txt"</span>, <span class="at">skip =</span> <span class="dv">3</span>, <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb205-349"><a href="#cb205-349" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tabs_temp_vel)</span>
<span id="cb205-350"><a href="#cb205-350" aria-hidden="true" tabindex="-1"></a><span class="co"># ?read_delim()</span></span>
<span id="cb205-351"><a href="#cb205-351" aria-hidden="true" tabindex="-1"></a>temp_tabs <span class="ot">&lt;-</span> tabs_temp_vel <span class="sc">%&gt;%</span> </span>
<span id="cb205-352"><a href="#cb205-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(X1, <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"time"</span>, <span class="st">"cm"</span>, <span class="st">"cm2"</span>, <span class="st">"cm3"</span>, <span class="st">"temp"</span>), <span class="at">sep =</span> <span class="st">"   "</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-353"><a href="#cb205-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE_TIME =</span> <span class="fu">str_trim</span>(date), <span class="at">TEMP =</span> <span class="fu">str_trim</span>(temp)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-354"><a href="#cb205-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DATE_TIME, TEMP) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb205-355"><a href="#cb205-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">whole_date =</span> <span class="fu">mdy_hms</span>(DATE_TIME),</span>
<span id="cb205-356"><a href="#cb205-356" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(whole_date),</span>
<span id="cb205-357"><a href="#cb205-357" aria-hidden="true" tabindex="-1"></a>         <span class="at">DAY =</span> <span class="fu">day</span>(whole_date),</span>
<span id="cb205-358"><a href="#cb205-358" aria-hidden="true" tabindex="-1"></a>         <span class="at">DATE =</span> <span class="fu">date</span>(whole_date),</span>
<span id="cb205-359"><a href="#cb205-359" aria-hidden="true" tabindex="-1"></a>         <span class="at">HOUR =</span> <span class="fu">hour</span>(whole_date),</span>
<span id="cb205-360"><a href="#cb205-360" aria-hidden="true" tabindex="-1"></a>         <span class="at">MIN =</span> <span class="fu">minute</span>(whole_date)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-361"><a href="#cb205-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DATE, MONTH, DAY, HOUR, MIN, TEMP) <span class="sc">%&gt;%</span> </span>
<span id="cb205-362"><a href="#cb205-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as_date</span>(DATE) <span class="sc">&gt;=</span> <span class="fu">as_date</span>(<span class="st">"2008-01-01"</span>) <span class="sc">&amp;</span> </span>
<span id="cb205-363"><a href="#cb205-363" aria-hidden="true" tabindex="-1"></a>           <span class="fu">as_date</span>(DATE) <span class="sc">&lt;=</span> <span class="fu">as_date</span>(<span class="st">"2010-10-15"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-364"><a href="#cb205-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">SAL =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-365"><a href="#cb205-365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">NOTES =</span> <span class="st">"temp from TABS D water vel data"</span>)</span>
<span id="cb205-366"><a href="#cb205-366" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb205-367"><a href="#cb205-367" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(temp_tabs)</span>
<span id="cb205-368"><a href="#cb205-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-369"><a href="#cb205-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-370"><a href="#cb205-370" aria-hidden="true" tabindex="-1"></a>Combine all temperature data and some salinity data.</span>
<span id="cb205-371"><a href="#cb205-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-374"><a href="#cb205-374" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-375"><a href="#cb205-375" aria-hidden="true" tabindex="-1"></a>temp_sal_tabs <span class="ot">&lt;-</span> <span class="fu">rbind</span>(temp_tabs, tabs_temp_sal_2010)</span>
<span id="cb205-376"><a href="#cb205-376" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(temp_sal_tabs)</span>
<span id="cb205-377"><a href="#cb205-377" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(temp_sal_tabs<span class="sc">$</span>DATE)</span>
<span id="cb205-378"><a href="#cb205-378" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-379"><a href="#cb205-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-380"><a href="#cb205-380" aria-hidden="true" tabindex="-1"></a>Import other salinity data from Siddarth</span>
<span id="cb205-381"><a href="#cb205-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-384"><a href="#cb205-384" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-385"><a href="#cb205-385" aria-hidden="true" tabindex="-1"></a><span class="co"># temp_sal &lt;- read.csv("input-data/NOAA_NERRS")</span></span>
<span id="cb205-386"><a href="#cb205-386" aria-hidden="true" tabindex="-1"></a><span class="co"># head(temp_sal)</span></span>
<span id="cb205-387"><a href="#cb205-387" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-388"><a href="#cb205-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-389"><a href="#cb205-389" aria-hidden="true" tabindex="-1"></a><span class="fu">## River height gauge</span></span>
<span id="cb205-390"><a href="#cb205-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-391"><a href="#cb205-391" aria-hidden="true" tabindex="-1"></a>Run <span class="in">`metadata-retrival/USGS pulling data.R`</span></span>
<span id="cb205-392"><a href="#cb205-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-395"><a href="#cb205-395" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-396"><a href="#cb205-396" aria-hidden="true" tabindex="-1"></a>usgs_clean <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"input-data/usgs_07374000_cleaned.csv"</span>)</span>
<span id="cb205-397"><a href="#cb205-397" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(usgs_clean)</span>
<span id="cb205-398"><a href="#cb205-398" aria-hidden="true" tabindex="-1"></a><span class="co"># hist(usgs_clean$gage_height_ft)</span></span>
<span id="cb205-399"><a href="#cb205-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-400"><a href="#cb205-400" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(usgs_clean, aes(x = date, y = gage_height_ft)) +</span></span>
<span id="cb205-401"><a href="#cb205-401" aria-hidden="true" tabindex="-1"></a><span class="co"># geom_bar(stat = "identity")</span></span>
<span id="cb205-402"><a href="#cb205-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-403"><a href="#cb205-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-404"><a href="#cb205-404" aria-hidden="true" tabindex="-1"></a>Clean up output and set up lubridate.</span>
<span id="cb205-405"><a href="#cb205-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-408"><a href="#cb205-408" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-409"><a href="#cb205-409" aria-hidden="true" tabindex="-1"></a>discharge_ft <span class="ot">&lt;-</span> usgs_clean <span class="sc">%&gt;%</span> </span>
<span id="cb205-410"><a href="#cb205-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, gage_height_ft) <span class="sc">%&gt;%</span> </span>
<span id="cb205-411"><a href="#cb205-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE =</span> <span class="fu">ymd</span>(date),</span>
<span id="cb205-412"><a href="#cb205-412" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(DATE),</span>
<span id="cb205-413"><a href="#cb205-413" aria-hidden="true" tabindex="-1"></a>         <span class="at">DAY =</span> <span class="fu">day</span>(DATE)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-414"><a href="#cb205-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>date)</span>
<span id="cb205-415"><a href="#cb205-415" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(discharge_ft)</span>
<span id="cb205-416"><a href="#cb205-416" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-417"><a href="#cb205-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-418"><a href="#cb205-418" aria-hidden="true" tabindex="-1"></a>Add water gauge height to temperature and salinity data</span>
<span id="cb205-419"><a href="#cb205-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-422"><a href="#cb205-422" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-423"><a href="#cb205-423" aria-hidden="true" tabindex="-1"></a>temp_sal_tabs_gauge <span class="ot">&lt;-</span> temp_sal_tabs <span class="sc">%&gt;%</span> </span>
<span id="cb205-424"><a href="#cb205-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(discharge_ft)</span>
<span id="cb205-425"><a href="#cb205-425" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(temp_sal_tabs_gauge)</span>
<span id="cb205-426"><a href="#cb205-426" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-427"><a href="#cb205-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-428"><a href="#cb205-428" aria-hidden="true" tabindex="-1"></a><span class="fu">## Rainfall</span></span>
<span id="cb205-429"><a href="#cb205-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-430"><a href="#cb205-430" aria-hidden="true" tabindex="-1"></a>Next steps: SKH - review precipitation from another source?</span>
<span id="cb205-431"><a href="#cb205-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-432"><a href="#cb205-432" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Any code to run for this? Siddard - can you document this?</span></span>
<span id="cb205-433"><a href="#cb205-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-434"><a href="#cb205-434" aria-hidden="true" tabindex="-1"></a>HPCP is likeley inches. Hourly Precipitation Data (HPD)</span>
<span id="cb205-435"><a href="#cb205-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-438"><a href="#cb205-438" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-439"><a href="#cb205-439" aria-hidden="true" tabindex="-1"></a>rainfall <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"input-data/precipitation.csv"</span>)</span>
<span id="cb205-440"><a href="#cb205-440" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(rainfall<span class="sc">$</span>HPCP)</span>
<span id="cb205-441"><a href="#cb205-441" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-442"><a href="#cb205-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-443"><a href="#cb205-443" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; What are rainfall units?? Is it HDCP?</span></span>
<span id="cb205-444"><a href="#cb205-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-447"><a href="#cb205-447" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-448"><a href="#cb205-448" aria-hidden="true" tabindex="-1"></a>rainfall_df <span class="ot">&lt;-</span> rainfall <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="at">date =</span> DATE, <span class="at">PRECIP_in =</span> HPCP) <span class="sc">%&gt;%</span></span>
<span id="cb205-449"><a href="#cb205-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE_TIME =</span> <span class="fu">ymd_hm</span>(date),</span>
<span id="cb205-450"><a href="#cb205-450" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(DATE_TIME),</span>
<span id="cb205-451"><a href="#cb205-451" aria-hidden="true" tabindex="-1"></a>         <span class="at">DAY =</span> <span class="fu">day</span>(DATE_TIME),</span>
<span id="cb205-452"><a href="#cb205-452" aria-hidden="true" tabindex="-1"></a>         <span class="at">HOUR =</span> <span class="fu">hour</span>(DATE_TIME),</span>
<span id="cb205-453"><a href="#cb205-453" aria-hidden="true" tabindex="-1"></a>         <span class="at">MIN =</span> <span class="fu">minute</span>(DATE_TIME),</span>
<span id="cb205-454"><a href="#cb205-454" aria-hidden="true" tabindex="-1"></a>         <span class="at">DATE =</span> <span class="fu">date</span>(DATE_TIME)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-455"><a href="#cb205-455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DATE, MONTH, DAY, HOUR, MIN, PRECIP_in)</span>
<span id="cb205-456"><a href="#cb205-456" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rainfall_df)</span>
<span id="cb205-457"><a href="#cb205-457" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(temp_sal_tabs_gauge)</span>
<span id="cb205-458"><a href="#cb205-458" aria-hidden="true" tabindex="-1"></a><span class="co"># range(rainfall_df$HOUR)</span></span>
<span id="cb205-459"><a href="#cb205-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-460"><a href="#cb205-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-463"><a href="#cb205-463" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-464"><a href="#cb205-464" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(temp_sal_tabs_gauge)</span>
<span id="cb205-465"><a href="#cb205-465" aria-hidden="true" tabindex="-1"></a><span class="co"># range(temp_sal_tabs_gauge$HOUR)</span></span>
<span id="cb205-466"><a href="#cb205-466" aria-hidden="true" tabindex="-1"></a>temp_sal_gauge_rain <span class="ot">&lt;-</span> temp_sal_tabs_gauge <span class="sc">%&gt;%</span> </span>
<span id="cb205-467"><a href="#cb205-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(rainfall_df)</span>
<span id="cb205-468"><a href="#cb205-468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-469"><a href="#cb205-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-470"><a href="#cb205-470" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lunar</span></span>
<span id="cb205-471"><a href="#cb205-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-474"><a href="#cb205-474" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-475"><a href="#cb205-475" aria-hidden="true" tabindex="-1"></a>lunar <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"input-data/Lunar cycle values.csv"</span>)</span>
<span id="cb205-476"><a href="#cb205-476" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lunar)</span>
<span id="cb205-477"><a href="#cb205-477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-478"><a href="#cb205-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-481"><a href="#cb205-481" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-482"><a href="#cb205-482" aria-hidden="true" tabindex="-1"></a>lunar_df <span class="ot">&lt;-</span> lunar <span class="sc">%&gt;%</span> </span>
<span id="cb205-483"><a href="#cb205-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Date, <span class="at">Phase =</span> Moon.Phase) <span class="sc">%&gt;%</span></span>
<span id="cb205-484"><a href="#cb205-484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE =</span> <span class="fu">ymd</span>(Date),</span>
<span id="cb205-485"><a href="#cb205-485" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(DATE),</span>
<span id="cb205-486"><a href="#cb205-486" aria-hidden="true" tabindex="-1"></a>         <span class="at">DAY =</span> <span class="fu">day</span>(DATE)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-487"><a href="#cb205-487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Date)</span>
<span id="cb205-488"><a href="#cb205-488" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lunar_df)</span>
<span id="cb205-489"><a href="#cb205-489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-490"><a href="#cb205-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-493"><a href="#cb205-493" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-494"><a href="#cb205-494" aria-hidden="true" tabindex="-1"></a>temp_sal_gauge_rain_moon <span class="ot">&lt;-</span> temp_sal_gauge_rain <span class="sc">%&gt;%</span> </span>
<span id="cb205-495"><a href="#cb205-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lunar_df)</span>
<span id="cb205-496"><a href="#cb205-496" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(temp_sal_gauge_rain_moon)</span>
<span id="cb205-497"><a href="#cb205-497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-498"><a href="#cb205-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-499"><a href="#cb205-499" aria-hidden="true" tabindex="-1"></a>All metadata is taking shape to be at minute 0 and 30 for every hour!</span>
<span id="cb205-500"><a href="#cb205-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-501"><a href="#cb205-501" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tide height</span></span>
<span id="cb205-502"><a href="#cb205-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-503"><a href="#cb205-503" aria-hidden="true" tabindex="-1"></a>see <span class="in">`Tide height.R`</span> code.</span>
<span id="cb205-504"><a href="#cb205-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-505"><a href="#cb205-505" aria-hidden="true" tabindex="-1"></a>Download MLLW</span>
<span id="cb205-506"><a href="#cb205-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-509"><a href="#cb205-509" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-510"><a href="#cb205-510" aria-hidden="true" tabindex="-1"></a>tide_height <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"input-data/port_aransas_water_levels_6min_2007_2017-4142025.csv"</span>)</span>
<span id="cb205-511"><a href="#cb205-511" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tide_height)</span>
<span id="cb205-512"><a href="#cb205-512" aria-hidden="true" tabindex="-1"></a><span class="co"># hist(tide_height$change)</span></span>
<span id="cb205-513"><a href="#cb205-513" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-514"><a href="#cb205-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-515"><a href="#cb205-515" aria-hidden="true" tabindex="-1"></a>Subtract tide height from previous entry to see if tide is incoming or outgoing.</span>
<span id="cb205-516"><a href="#cb205-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-519"><a href="#cb205-519" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-520"><a href="#cb205-520" aria-hidden="true" tabindex="-1"></a>tide_height_df <span class="ot">&lt;-</span> tide_height <span class="sc">%&gt;%</span> </span>
<span id="cb205-521"><a href="#cb205-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE_TIME =</span> <span class="fu">ymd_hm</span>(timestamp),</span>
<span id="cb205-522"><a href="#cb205-522" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(DATE_TIME),</span>
<span id="cb205-523"><a href="#cb205-523" aria-hidden="true" tabindex="-1"></a>         <span class="at">DAY =</span> <span class="fu">day</span>(DATE_TIME),</span>
<span id="cb205-524"><a href="#cb205-524" aria-hidden="true" tabindex="-1"></a>         <span class="at">HOUR =</span> <span class="fu">hour</span>(DATE_TIME),</span>
<span id="cb205-525"><a href="#cb205-525" aria-hidden="true" tabindex="-1"></a>         <span class="at">MIN =</span> <span class="fu">minute</span>(DATE_TIME),</span>
<span id="cb205-526"><a href="#cb205-526" aria-hidden="true" tabindex="-1"></a>         <span class="at">DATE =</span> <span class="fu">date</span>(DATE_TIME)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-527"><a href="#cb205-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MIN <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="co"># Sample only on the hour or at 30 minutes.</span></span>
<span id="cb205-528"><a href="#cb205-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DIFFERENCE =</span> MLLW <span class="sc">-</span> <span class="fu">lag</span>(MLLW, <span class="at">default =</span> <span class="fu">first</span>(MLLW))) <span class="sc">%&gt;%</span> </span>
<span id="cb205-529"><a href="#cb205-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tide_direction =</span> <span class="fu">case_when</span>(</span>
<span id="cb205-530"><a href="#cb205-530" aria-hidden="true" tabindex="-1"></a>      DIFFERENCE <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Incoming"</span>,</span>
<span id="cb205-531"><a href="#cb205-531" aria-hidden="true" tabindex="-1"></a>      DIFFERENCE <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Outgoing"</span>,</span>
<span id="cb205-532"><a href="#cb205-532" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No Change"</span></span>
<span id="cb205-533"><a href="#cb205-533" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span> </span>
<span id="cb205-534"><a href="#cb205-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DATE, MONTH, DAY, HOUR, MIN, MLLW, DIFFERENCE, tide_direction) </span>
<span id="cb205-535"><a href="#cb205-535" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb205-536"><a href="#cb205-536" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tide_height_df)</span>
<span id="cb205-537"><a href="#cb205-537" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(tide_height_df<span class="sc">$</span>DIFFERENCE)</span>
<span id="cb205-538"><a href="#cb205-538" aria-hidden="true" tabindex="-1"></a><span class="co"># table(tide_height_df$tide_direction)</span></span>
<span id="cb205-539"><a href="#cb205-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-540"><a href="#cb205-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-541"><a href="#cb205-541" aria-hidden="true" tabindex="-1"></a><span class="fu"># Combine all metadata</span></span>
<span id="cb205-542"><a href="#cb205-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-543"><a href="#cb205-543" aria-hidden="true" tabindex="-1"></a>Combine with all other data</span>
<span id="cb205-544"><a href="#cb205-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-547"><a href="#cb205-547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-548"><a href="#cb205-548" aria-hidden="true" tabindex="-1"></a>temp_sal_gauge_rain_moon_tide <span class="ot">&lt;-</span> temp_sal_gauge_rain_moon <span class="sc">%&gt;%</span> </span>
<span id="cb205-549"><a href="#cb205-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tide_height_df)</span>
<span id="cb205-550"><a href="#cb205-550" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(temp_sal_gauge_rain_moon_tide)</span>
<span id="cb205-551"><a href="#cb205-551" aria-hidden="true" tabindex="-1"></a><span class="co"># View(temp_sal_gauge_rain_moon_tide)</span></span>
<span id="cb205-552"><a href="#cb205-552" aria-hidden="true" tabindex="-1"></a><span class="co"># hist(temp_sal_gauge_rain_moon_tide$SAL)</span></span>
<span id="cb205-553"><a href="#cb205-553" aria-hidden="true" tabindex="-1"></a>hourly_metadata <span class="ot">&lt;-</span> temp_sal_gauge_rain_moon_tide <span class="sc">%&gt;%</span> </span>
<span id="cb205-554"><a href="#cb205-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MIN <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb205-555"><a href="#cb205-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-556"><a href="#cb205-556" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(temp_sal_gauge_rain_moon_tide, <span class="at">file =</span> <span class="st">"output-data/allmetadata-04142025.csv"</span>)</span>
<span id="cb205-557"><a href="#cb205-557" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(hourly_metadata, <span class="at">file =</span> <span class="st">"output-data/hourly_allmetadata-04142025.csv"</span>)</span>
<span id="cb205-558"><a href="#cb205-558" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-559"><a href="#cb205-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-560"><a href="#cb205-560" aria-hidden="true" tabindex="-1"></a><span class="fu"># Archive</span></span>
<span id="cb205-561"><a href="#cb205-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-562"><a href="#cb205-562" aria-hidden="true" tabindex="-1"></a>Downloaded from TABS D historical data.</span>
<span id="cb205-563"><a href="#cb205-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-566"><a href="#cb205-566" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-567"><a href="#cb205-567" aria-hidden="true" tabindex="-1"></a><span class="co"># folder_path &lt;- "/Users/skhu/Desktop/Projects/GoM-IFCB-PortAransas/input-data/TABS_D"</span></span>
<span id="cb205-568"><a href="#cb205-568" aria-hidden="true" tabindex="-1"></a><span class="co"># file_list &lt;- list.files(folder_path, pattern = "*.txt", full.names = TRUE)</span></span>
<span id="cb205-569"><a href="#cb205-569" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-570"><a href="#cb205-570" aria-hidden="true" tabindex="-1"></a><span class="co"># # Print the list of files to ensure they are correctly detected</span></span>
<span id="cb205-571"><a href="#cb205-571" aria-hidden="true" tabindex="-1"></a><span class="co"># print(file_list)</span></span>
<span id="cb205-572"><a href="#cb205-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-573"><a href="#cb205-573" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-574"><a href="#cb205-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-575"><a href="#cb205-575" aria-hidden="true" tabindex="-1"></a>Function to load and format input data</span>
<span id="cb205-576"><a href="#cb205-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-579"><a href="#cb205-579" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-580"><a href="#cb205-580" aria-hidden="true" tabindex="-1"></a><span class="co"># load_and_preprocess &lt;- function(file_path) {</span></span>
<span id="cb205-581"><a href="#cb205-581" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Read the file, skipping the first two header lines</span></span>
<span id="cb205-582"><a href="#cb205-582" aria-hidden="true" tabindex="-1"></a><span class="co">#   data &lt;- read_table(file_path, skip = 2, col_names = FALSE)</span></span>
<span id="cb205-583"><a href="#cb205-583" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-584"><a href="#cb205-584" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Assign proper column names for PTAT2</span></span>
<span id="cb205-585"><a href="#cb205-585" aria-hidden="true" tabindex="-1"></a><span class="co">#   colnames(data) &lt;- c("YY","MM","DD","hh","mm",</span></span>
<span id="cb205-586"><a href="#cb205-586" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "DEPTH","OTMP","COND","SAL","O2%","O2PPM",</span></span>
<span id="cb205-587"><a href="#cb205-587" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "CLCON","TURB","PH","EH")</span></span>
<span id="cb205-588"><a href="#cb205-588" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-589"><a href="#cb205-589" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Combine date and time columns into a datetime column using lubridate</span></span>
<span id="cb205-590"><a href="#cb205-590" aria-hidden="true" tabindex="-1"></a><span class="co">#   data &lt;- data %&gt;%</span></span>
<span id="cb205-591"><a href="#cb205-591" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(</span></span>
<span id="cb205-592"><a href="#cb205-592" aria-hidden="true" tabindex="-1"></a><span class="co">#       YY = as.integer(YY),</span></span>
<span id="cb205-593"><a href="#cb205-593" aria-hidden="true" tabindex="-1"></a><span class="co">#       MM = as.integer(MM),</span></span>
<span id="cb205-594"><a href="#cb205-594" aria-hidden="true" tabindex="-1"></a><span class="co">#       DD = as.integer(DD),</span></span>
<span id="cb205-595"><a href="#cb205-595" aria-hidden="true" tabindex="-1"></a><span class="co">#       hh = as.integer(hh),</span></span>
<span id="cb205-596"><a href="#cb205-596" aria-hidden="true" tabindex="-1"></a><span class="co">#       mm = as.integer(mm),</span></span>
<span id="cb205-597"><a href="#cb205-597" aria-hidden="true" tabindex="-1"></a><span class="co">#       datetime = make_datetime(YY, MM, DD, hh, mm)  # Ensure hourly accuracy</span></span>
<span id="cb205-598"><a href="#cb205-598" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb205-599"><a href="#cb205-599" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-600"><a href="#cb205-600" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(data)</span></span>
<span id="cb205-601"><a href="#cb205-601" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb205-602"><a href="#cb205-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-603"><a href="#cb205-603" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-604"><a href="#cb205-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-607"><a href="#cb205-607" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-608"><a href="#cb205-608" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and merge all data files</span></span>
<span id="cb205-609"><a href="#cb205-609" aria-hidden="true" tabindex="-1"></a><span class="co"># all_data &lt;- file_list %&gt;%</span></span>
<span id="cb205-610"><a href="#cb205-610" aria-hidden="true" tabindex="-1"></a><span class="co">#   lapply(load_and_preprocess) %&gt;%</span></span>
<span id="cb205-611"><a href="#cb205-611" aria-hidden="true" tabindex="-1"></a><span class="co">#   bind_rows()</span></span>
<span id="cb205-612"><a href="#cb205-612" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-613"><a href="#cb205-613" aria-hidden="true" tabindex="-1"></a><span class="co"># # Check the combined dataset</span></span>
<span id="cb205-614"><a href="#cb205-614" aria-hidden="true" tabindex="-1"></a><span class="co"># print(dim(all_data))  # Print the dimensions of the data</span></span>
<span id="cb205-615"><a href="#cb205-615" aria-hidden="true" tabindex="-1"></a><span class="co"># print(head(all_data))  # View the first few rows</span></span>
<span id="cb205-616"><a href="#cb205-616" aria-hidden="true" tabindex="-1"></a><span class="co"># table(all_data$O2PPM)</span></span>
<span id="cb205-617"><a href="#cb205-617" aria-hidden="true" tabindex="-1"></a><span class="co"># range(all_data$datetime)</span></span>
<span id="cb205-618"><a href="#cb205-618" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-619"><a href="#cb205-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-620"><a href="#cb205-620" aria-hidden="true" tabindex="-1"></a><span class="fu">## ARCHIVE</span></span>
<span id="cb205-621"><a href="#cb205-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-624"><a href="#cb205-624" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-625"><a href="#cb205-625" aria-hidden="true" tabindex="-1"></a><span class="co"># folder_path &lt;- "/Users/skhu/Desktop/Projects/GoM-IFCB-PortAransas/input-data/PTAT2/Standard-Meterological-Data/"</span></span>
<span id="cb205-626"><a href="#cb205-626" aria-hidden="true" tabindex="-1"></a><span class="co"># file_list &lt;- list.files(folder_path, pattern = "*.txt", full.names = TRUE)</span></span>
<span id="cb205-627"><a href="#cb205-627" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-628"><a href="#cb205-628" aria-hidden="true" tabindex="-1"></a><span class="co"># # Print the list of files to ensure they are correctly detected</span></span>
<span id="cb205-629"><a href="#cb205-629" aria-hidden="true" tabindex="-1"></a><span class="co"># print(file_list)</span></span>
<span id="cb205-630"><a href="#cb205-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-631"><a href="#cb205-631" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-632"><a href="#cb205-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-633"><a href="#cb205-633" aria-hidden="true" tabindex="-1"></a>Function to load and format input data</span>
<span id="cb205-634"><a href="#cb205-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-637"><a href="#cb205-637" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-638"><a href="#cb205-638" aria-hidden="true" tabindex="-1"></a><span class="co"># load_and_preprocess &lt;- function(file_path) {</span></span>
<span id="cb205-639"><a href="#cb205-639" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Read the file, skipping the first two header lines</span></span>
<span id="cb205-640"><a href="#cb205-640" aria-hidden="true" tabindex="-1"></a><span class="co">#   data &lt;- read_table(file_path, skip = 2, col_names = FALSE)</span></span>
<span id="cb205-641"><a href="#cb205-641" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb205-642"><a href="#cb205-642" aria-hidden="true" tabindex="-1"></a><span class="co">#   # # Assign proper column names for PTAT2</span></span>
<span id="cb205-643"><a href="#cb205-643" aria-hidden="true" tabindex="-1"></a><span class="co">#   # colnames(data) &lt;- c("YY", "MM", "DD", "hh", "mm", "WDIR", "WSPD", "GST",</span></span>
<span id="cb205-644"><a href="#cb205-644" aria-hidden="true" tabindex="-1"></a><span class="co">#   #                     "WVHT", "DPD", "APD", "MWD", "PRES", "ATMP", "WTMP",</span></span>
<span id="cb205-645"><a href="#cb205-645" aria-hidden="true" tabindex="-1"></a><span class="co">#   #                     "DEWP", "VIS", "TIDE")</span></span>
<span id="cb205-646"><a href="#cb205-646" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-647"><a href="#cb205-647" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Combine date and time columns into a datetime column using lubridate</span></span>
<span id="cb205-648"><a href="#cb205-648" aria-hidden="true" tabindex="-1"></a><span class="co">#   data &lt;- data %&gt;%</span></span>
<span id="cb205-649"><a href="#cb205-649" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(</span></span>
<span id="cb205-650"><a href="#cb205-650" aria-hidden="true" tabindex="-1"></a><span class="co">#       YY = as.integer(YY),</span></span>
<span id="cb205-651"><a href="#cb205-651" aria-hidden="true" tabindex="-1"></a><span class="co">#       MM = as.integer(MM),</span></span>
<span id="cb205-652"><a href="#cb205-652" aria-hidden="true" tabindex="-1"></a><span class="co">#       DD = as.integer(DD),</span></span>
<span id="cb205-653"><a href="#cb205-653" aria-hidden="true" tabindex="-1"></a><span class="co">#       hh = as.integer(hh),</span></span>
<span id="cb205-654"><a href="#cb205-654" aria-hidden="true" tabindex="-1"></a><span class="co">#       mm = as.integer(mm),</span></span>
<span id="cb205-655"><a href="#cb205-655" aria-hidden="true" tabindex="-1"></a><span class="co">#       datetime = make_datetime(YY, MM, DD, hh, mm)  # Ensure hourly accuracy</span></span>
<span id="cb205-656"><a href="#cb205-656" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb205-657"><a href="#cb205-657" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-658"><a href="#cb205-658" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(data)</span></span>
<span id="cb205-659"><a href="#cb205-659" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb205-660"><a href="#cb205-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-661"><a href="#cb205-661" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-662"><a href="#cb205-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-665"><a href="#cb205-665" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-666"><a href="#cb205-666" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and merge all data files</span></span>
<span id="cb205-667"><a href="#cb205-667" aria-hidden="true" tabindex="-1"></a><span class="co"># all_data &lt;- file_list %&gt;%</span></span>
<span id="cb205-668"><a href="#cb205-668" aria-hidden="true" tabindex="-1"></a><span class="co">#   lapply(load_and_preprocess) %&gt;%</span></span>
<span id="cb205-669"><a href="#cb205-669" aria-hidden="true" tabindex="-1"></a><span class="co">#   bind_rows()</span></span>
<span id="cb205-670"><a href="#cb205-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-671"><a href="#cb205-671" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the combined dataset</span></span>
<span id="cb205-672"><a href="#cb205-672" aria-hidden="true" tabindex="-1"></a><span class="co"># print(dim(all_data))  # Print the dimensions of the data</span></span>
<span id="cb205-673"><a href="#cb205-673" aria-hidden="true" tabindex="-1"></a><span class="co"># print(head(all_data))  # View the first few rows</span></span>
<span id="cb205-674"><a href="#cb205-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-675"><a href="#cb205-675" aria-hidden="true" tabindex="-1"></a><span class="co"># range(all_data$datetime)</span></span>
<span id="cb205-676"><a href="#cb205-676" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-677"><a href="#cb205-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-678"><a href="#cb205-678" aria-hidden="true" tabindex="-1"></a>Below needs to modified. We cannot group by year - we need to look at a parameters over time.</span>
<span id="cb205-679"><a href="#cb205-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-682"><a href="#cb205-682" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-683"><a href="#cb205-683" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract year for aggregation</span></span>
<span id="cb205-684"><a href="#cb205-684" aria-hidden="true" tabindex="-1"></a><span class="co"># head(all_data)</span></span>
<span id="cb205-685"><a href="#cb205-685" aria-hidden="true" tabindex="-1"></a><span class="co"># all_data &lt;- all_data %&gt;%</span></span>
<span id="cb205-686"><a href="#cb205-686" aria-hidden="true" tabindex="-1"></a><span class="co">#   unite(day, YY, MM, DD, sep = "-", remove = FALSE) %&gt;% </span></span>
<span id="cb205-687"><a href="#cb205-687" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(year = format(datetime, "%Y"))</span></span>
<span id="cb205-688"><a href="#cb205-688" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-689"><a href="#cb205-689" aria-hidden="true" tabindex="-1"></a><span class="co"># # Group by year and calculate averages</span></span>
<span id="cb205-690"><a href="#cb205-690" aria-hidden="true" tabindex="-1"></a><span class="co"># yearly_data &lt;- all_data %&gt;%</span></span>
<span id="cb205-691"><a href="#cb205-691" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year) %&gt;%</span></span>
<span id="cb205-692"><a href="#cb205-692" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(</span></span>
<span id="cb205-693"><a href="#cb205-693" aria-hidden="true" tabindex="-1"></a><span class="co">#     avg_ATMP = mean(as.numeric(ATMP), na.rm = TRUE),</span></span>
<span id="cb205-694"><a href="#cb205-694" aria-hidden="true" tabindex="-1"></a><span class="co">#     avg_WTMP = mean(as.numeric(WTMP), na.rm = TRUE)</span></span>
<span id="cb205-695"><a href="#cb205-695" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb205-696"><a href="#cb205-696" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-697"><a href="#cb205-697" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert year to a numeric format for plotting</span></span>
<span id="cb205-698"><a href="#cb205-698" aria-hidden="true" tabindex="-1"></a><span class="co"># yearly_data$year &lt;- as.numeric(yearly_data$year)</span></span>
<span id="cb205-699"><a href="#cb205-699" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-700"><a href="#cb205-700" aria-hidden="true" tabindex="-1"></a><span class="co"># # Check the aggregated data</span></span>
<span id="cb205-701"><a href="#cb205-701" aria-hidden="true" tabindex="-1"></a><span class="co"># print(head(yearly_data))</span></span>
<span id="cb205-702"><a href="#cb205-702" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-703"><a href="#cb205-703" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-704"><a href="#cb205-704" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create a full sequence of years</span></span>
<span id="cb205-705"><a href="#cb205-705" aria-hidden="true" tabindex="-1"></a><span class="co"># full_years &lt;- data.frame(year = 2008:2017)</span></span>
<span id="cb205-706"><a href="#cb205-706" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-707"><a href="#cb205-707" aria-hidden="true" tabindex="-1"></a><span class="co"># # Merge the full sequence with the aggregated data</span></span>
<span id="cb205-708"><a href="#cb205-708" aria-hidden="true" tabindex="-1"></a><span class="co"># yearly_data &lt;- full_years %&gt;%</span></span>
<span id="cb205-709"><a href="#cb205-709" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(yearly_data, by = "year")</span></span>
<span id="cb205-710"><a href="#cb205-710" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-711"><a href="#cb205-711" aria-hidden="true" tabindex="-1"></a><span class="co"># # Check the updated yearly data</span></span>
<span id="cb205-712"><a href="#cb205-712" aria-hidden="true" tabindex="-1"></a><span class="co"># print(yearly_data)</span></span>
<span id="cb205-713"><a href="#cb205-713" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-714"><a href="#cb205-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-715"><a href="#cb205-715" aria-hidden="true" tabindex="-1"></a><span class="fu"># Combine with IFCB data</span></span>
<span id="cb205-716"><a href="#cb205-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-719"><a href="#cb205-719" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-720"><a href="#cb205-720" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_gom_long_season)</span>
<span id="cb205-721"><a href="#cb205-721" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hourly_metadata)</span>
<span id="cb205-722"><a href="#cb205-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-723"><a href="#cb205-723" aria-hidden="true" tabindex="-1"></a>combined_biol_metadata <span class="ot">&lt;-</span> hourly_metadata <span class="sc">%&gt;%</span> </span>
<span id="cb205-724"><a href="#cb205-724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(combined_gom_long_season, <span class="at">by =</span> <span class="fu">join_by</span>(DATE, MONTH, HOUR))</span>
<span id="cb205-725"><a href="#cb205-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-726"><a href="#cb205-726" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(combined_biol_metadata)</span></span>
<span id="cb205-727"><a href="#cb205-727" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(combined_biol_metadata$SEASON)</span></span>
<span id="cb205-728"><a href="#cb205-728" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_biol_metadata)</span>
<span id="cb205-729"><a href="#cb205-729" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-730"><a href="#cb205-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-731"><a href="#cb205-731" aria-hidden="true" tabindex="-1"></a><span class="fu"># IFCB data overview</span></span>
<span id="cb205-732"><a href="#cb205-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-733"><a href="#cb205-733" aria-hidden="true" tabindex="-1"></a>Make a bar plot of the course classification types available from the IFCB.</span>
<span id="cb205-734"><a href="#cb205-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-735"><a href="#cb205-735" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=4, fig.width=6}</span></span>
<span id="cb205-736"><a href="#cb205-736" aria-hidden="true" tabindex="-1"></a><span class="in">head(combined_gom_long_season)</span></span>
<span id="cb205-737"><a href="#cb205-737" aria-hidden="true" tabindex="-1"></a><span class="in">combined_gom_long_season |&gt; </span></span>
<span id="cb205-738"><a href="#cb205-738" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(COURSE_CLASSIFICATION, TYPE) |&gt; </span></span>
<span id="cb205-739"><a href="#cb205-739" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(total_OCCUR = n(),</span></span>
<span id="cb205-740"><a href="#cb205-740" aria-hidden="true" tabindex="-1"></a><span class="in">            total_counts = sum(COUNT),</span></span>
<span id="cb205-741"><a href="#cb205-741" aria-hidden="true" tabindex="-1"></a><span class="in">            total_carbon = sum(CARBON)) |&gt; </span></span>
<span id="cb205-742"><a href="#cb205-742" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_longer(cols = starts_with("total_")) %&gt;% </span></span>
<span id="cb205-743"><a href="#cb205-743" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(area = value, fill = COURSE_CLASSIFICATION)) +</span></span>
<span id="cb205-744"><a href="#cb205-744" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_treemap(color = "white") +</span></span>
<span id="cb205-745"><a href="#cb205-745" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_grid(rows = vars(TYPE), cols = vars(name)) +</span></span>
<span id="cb205-746"><a href="#cb205-746" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_classic()</span></span>
<span id="cb205-747"><a href="#cb205-747" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-748"><a href="#cb205-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-749"><a href="#cb205-749" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Based on the above, we will focus primarily on the pink color, microeukaryotes, which will include cells and cell type.</span></span>
<span id="cb205-750"><a href="#cb205-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-751"><a href="#cb205-751" aria-hidden="true" tabindex="-1"></a>Repeat with only microeukaryotes</span>
<span id="cb205-752"><a href="#cb205-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-753"><a href="#cb205-753" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=4, fig.width=6}</span></span>
<span id="cb205-754"><a href="#cb205-754" aria-hidden="true" tabindex="-1"></a><span class="in">combined_gom_long_season |&gt; </span></span>
<span id="cb205-755"><a href="#cb205-755" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(COURSE_CLASSIFICATION == "Microeukaryote") |&gt; </span></span>
<span id="cb205-756"><a href="#cb205-756" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Supergroup, Phylum) |&gt; </span></span>
<span id="cb205-757"><a href="#cb205-757" aria-hidden="true" tabindex="-1"></a><span class="in">    summarise(var_sum_count = sum(COUNT),</span></span>
<span id="cb205-758"><a href="#cb205-758" aria-hidden="true" tabindex="-1"></a><span class="in">              var_sum_carbon = sum(CARBON)) |&gt; </span></span>
<span id="cb205-759"><a href="#cb205-759" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_longer(cols = starts_with("var_")) %&gt;% </span></span>
<span id="cb205-760"><a href="#cb205-760" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Supergroup, y = value, fill = Phylum)) +</span></span>
<span id="cb205-761"><a href="#cb205-761" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity", color = "black") +</span></span>
<span id="cb205-762"><a href="#cb205-762" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_flip() +</span></span>
<span id="cb205-763"><a href="#cb205-763" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb205-764"><a href="#cb205-764" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(cols = vars(name), scales = "free") +</span></span>
<span id="cb205-765"><a href="#cb205-765" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(y = "Sum of cell counts", x = "Supergroup")</span></span>
<span id="cb205-766"><a href="#cb205-766" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-767"><a href="#cb205-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-768"><a href="#cb205-768" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cells, Carbon, and carbon per cell</span></span>
<span id="cb205-769"><a href="#cb205-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-770"><a href="#cb205-770" aria-hidden="true" tabindex="-1"></a>Carbon units are pgC per cell; Cells are cells per ml.</span>
<span id="cb205-771"><a href="#cb205-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-772"><a href="#cb205-772" aria-hidden="true" tabindex="-1"></a>cell <span class="sc">\*</span> carbon = pgC per ml</span>
<span id="cb205-773"><a href="#cb205-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-776"><a href="#cb205-776" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-777"><a href="#cb205-777" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_biol_metadata)</span>
<span id="cb205-778"><a href="#cb205-778" aria-hidden="true" tabindex="-1"></a>plot_biotic <span class="ot">&lt;-</span> combined_biol_metadata <span class="sc">%&gt;%</span> </span>
<span id="cb205-779"><a href="#cb205-779" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pgC_ml =</span> COUNT <span class="sc">*</span> CARBON) <span class="sc">%&gt;%</span> </span>
<span id="cb205-780"><a href="#cb205-780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DATE, CELL_ID, COURSE_CLASSIFICATION, TYPE, Domain, Supergroup, Phylum, Class, Order, Family, Genus, Species, SEASON, CARBON, COUNT, pgC_ml, START, END, DAY_NOYEAR)</span>
<span id="cb205-781"><a href="#cb205-781" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb205-782"><a href="#cb205-782" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-783"><a href="#cb205-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-784"><a href="#cb205-784" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot biotic - all years</span></span>
<span id="cb205-785"><a href="#cb205-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-786"><a href="#cb205-786" aria-hidden="true" tabindex="-1"></a>We want to add information to the dates for when there are Karenia notifications and a data gap.</span>
<span id="cb205-787"><a href="#cb205-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-790"><a href="#cb205-790" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-791"><a href="#cb205-791" aria-hidden="true" tabindex="-1"></a>kar_gap <span class="ot">&lt;-</span> plot_biotic <span class="sc">%&gt;%</span> </span>
<span id="cb205-792"><a href="#cb205-792" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CELL_ID <span class="sc">==</span> <span class="st">"Karenia_brevis"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-793"><a href="#cb205-793" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ADD =</span> <span class="fu">case_when</span>(</span>
<span id="cb205-794"><a href="#cb205-794" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">grepl</span>(<span class="st">"Karenia_brevis"</span>, CELL_ID) <span class="sc">&amp;</span> COUNT <span class="sc">&gt;</span> <span class="dv">2</span>) <span class="sc">~</span> <span class="st">"Notification"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-795"><a href="#cb205-795" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">WEEK =</span> <span class="fu">cut</span>(DATE, <span class="st">"week"</span>, <span class="at">start.on.monday =</span> <span class="cn">TRUE</span>),</span>
<span id="cb205-796"><a href="#cb205-796" aria-hidden="true" tabindex="-1"></a>         <span class="at">YEAR =</span> <span class="fu">year</span>(<span class="fu">as_date</span>(DATE))) <span class="sc">%&gt;%</span> </span>
<span id="cb205-797"><a href="#cb205-797" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(WEEK, YEAR, ADD) <span class="sc">%&gt;%</span> </span>
<span id="cb205-798"><a href="#cb205-798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb205-799"><a href="#cb205-799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb205-800"><a href="#cb205-800" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-801"><a href="#cb205-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-804"><a href="#cb205-804" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-805"><a href="#cb205-805" aria-hidden="true" tabindex="-1"></a>values_byweek <span class="ot">&lt;-</span> plot_biotic <span class="sc">%&gt;%</span> </span>
<span id="cb205-806"><a href="#cb205-806" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COURSE_CLASSIFICATION <span class="sc">==</span> <span class="st">"Microeukaryote"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-807"><a href="#cb205-807" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Plantae"</span> <span class="sc">&amp;</span> Supergroup <span class="sc">!=</span> <span class="st">"Animalia/Metazoa"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-808"><a href="#cb205-808" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>START, <span class="sc">-</span>END, <span class="sc">-</span>DAY_NOYEAR) <span class="sc">%&gt;%</span> </span>
<span id="cb205-809"><a href="#cb205-809" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(DATE, CELL_ID, COURSE_CLASSIFICATION, TYPE, Domain, Supergroup, Phylum, Class, Order, Family, Genus, Species, SEASON), <span class="at">names_to =</span> <span class="st">"VARIABLE"</span>, <span class="at">values_to =</span> <span class="st">"VALUE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-810"><a href="#cb205-810" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb205-811"><a href="#cb205-811" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average the variable PER day for a single Cell ID type</span></span>
<span id="cb205-812"><a href="#cb205-812" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(VARIABLE, DATE, CELL_ID, SEASON) <span class="sc">%&gt;%</span> </span>
<span id="cb205-813"><a href="#cb205-813" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">MEAN_bycell_day =</span> <span class="fu">mean</span>(VALUE)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-814"><a href="#cb205-814" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb205-815"><a href="#cb205-815" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sum total cells for a single day</span></span>
<span id="cb205-816"><a href="#cb205-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DATE, SEASON, VARIABLE) <span class="sc">%&gt;%</span> </span>
<span id="cb205-817"><a href="#cb205-817" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM_byday =</span> <span class="fu">sum</span>(MEAN_bycell_day)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-818"><a href="#cb205-818" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb205-819"><a href="#cb205-819" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a column to specify the WEEK - have week start on Mondays</span></span>
<span id="cb205-820"><a href="#cb205-820" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">WEEK =</span> <span class="fu">cut</span>(DATE, <span class="st">"week"</span>, <span class="at">start.on.monday =</span> <span class="cn">TRUE</span>),</span>
<span id="cb205-821"><a href="#cb205-821" aria-hidden="true" tabindex="-1"></a>         <span class="at">MONTH =</span> <span class="fu">month</span>(<span class="fu">as_date</span>(DATE)),</span>
<span id="cb205-822"><a href="#cb205-822" aria-hidden="true" tabindex="-1"></a>         <span class="at">YEAR =</span> <span class="fu">year</span>(<span class="fu">as_date</span>(DATE))) <span class="sc">%&gt;%</span> </span>
<span id="cb205-823"><a href="#cb205-823" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get mean, min, and max for each week</span></span>
<span id="cb205-824"><a href="#cb205-824" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(WEEK, SEASON, YEAR, VARIABLE) <span class="sc">%&gt;%</span> </span>
<span id="cb205-825"><a href="#cb205-825" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">MEAN_WEEK =</span> <span class="fu">mean</span>(SUM_byday),</span>
<span id="cb205-826"><a href="#cb205-826" aria-hidden="true" tabindex="-1"></a>              <span class="at">MAX_WEEK =</span> <span class="fu">max</span>(SUM_byday),</span>
<span id="cb205-827"><a href="#cb205-827" aria-hidden="true" tabindex="-1"></a>              <span class="at">MIN_WEEK =</span> <span class="fu">min</span>(SUM_byday)) </span>
<span id="cb205-828"><a href="#cb205-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-829"><a href="#cb205-829" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(values_byweek)</span>
<span id="cb205-830"><a href="#cb205-830" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-831"><a href="#cb205-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-832"><a href="#cb205-832" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=7, fig.width=30}</span></span>
<span id="cb205-833"><a href="#cb205-833" aria-hidden="true" tabindex="-1"></a><span class="in">oneyr_counts &lt;- values_byweek %&gt;% </span></span>
<span id="cb205-834"><a href="#cb205-834" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(VARIABLE_LABEL = factor(VARIABLE, levels = c("COUNT", "CARBON", "pgC_ml"), labels = c(bquote("Cells"~ml^-1), bquote("pg Carbon"~cell^-1), bquote("pg Carbon"~ml^-1)))) %&gt;% </span></span>
<span id="cb205-835"><a href="#cb205-835" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = as_date(WEEK), y = MEAN_WEEK)) + </span></span>
<span id="cb205-836"><a href="#cb205-836" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_line(color = "black", alpha = 0.4) +</span></span>
<span id="cb205-837"><a href="#cb205-837" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_linerange(aes(ymin = MIN_WEEK, ymax = MAX_WEEK, color = SEASON, alpha = 0.5), linewidth = 0.5) +</span></span>
<span id="cb205-838"><a href="#cb205-838" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_point(shape = 19, size = 2, aes(color = SEASON)) +</span></span>
<span id="cb205-839"><a href="#cb205-839" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb205-840"><a href="#cb205-840" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(rows = vars(VARIABLE_LABEL), scales = "free", </span></span>
<span id="cb205-841"><a href="#cb205-841" aria-hidden="true" tabindex="-1"></a><span class="in">             labeller = label_parsed, switch = "y") +</span></span>
<span id="cb205-842"><a href="#cb205-842" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_date(date_labels = "%b %y", expand = c(0,0), date_breaks = "3 months", date_minor_breaks = "month") +</span></span>
<span id="cb205-843"><a href="#cb205-843" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(values = c("#cc5500","#bccbae","#ffbf00","#5d4e62")) +</span></span>
<span id="cb205-844"><a href="#cb205-844" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_log10() +</span></span>
<span id="cb205-845"><a href="#cb205-845" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "IFCB time series", y = "") +</span></span>
<span id="cb205-846"><a href="#cb205-846" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom", legend.title = element_blank(),</span></span>
<span id="cb205-847"><a href="#cb205-847" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text.y = element_text(color = "black", face = "bold", size = 14),</span></span>
<span id="cb205-848"><a href="#cb205-848" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.background = element_blank(),</span></span>
<span id="cb205-849"><a href="#cb205-849" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.placement = "outside",</span></span>
<span id="cb205-850"><a href="#cb205-850" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.x = element_text(color = "black", face = "bold", size = 14),</span></span>
<span id="cb205-851"><a href="#cb205-851" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title = element_text(color = "black", face = "bold", size = 14),</span></span>
<span id="cb205-852"><a href="#cb205-852" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.y = element_text(color = "black", face = "bold", size = 14),</span></span>
<span id="cb205-853"><a href="#cb205-853" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid.major = element_line(color = "#d9d9d9", linewidth = 0.3)) +</span></span>
<span id="cb205-854"><a href="#cb205-854" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = (kar_gap %&gt;% filter(ADD == "Notification")), aes(x = as_date(WEEK), y = 10000), shape = 19, color = "red", alpha = 0.6)</span></span>
<span id="cb205-855"><a href="#cb205-855" aria-hidden="true" tabindex="-1"></a><span class="in"># labs(y = bquote("FLP cells " ~ mL^-1), x = "Incubation hours") + </span></span>
<span id="cb205-856"><a href="#cb205-856" aria-hidden="true" tabindex="-1"></a><span class="in">oneyr_counts</span></span>
<span id="cb205-857"><a href="#cb205-857" aria-hidden="true" tabindex="-1"></a><span class="in">  # geom_point(data = (kar_gap %&gt;% filter(ADD == "Notification")), aes(x = as_date(WEEK), y = 10000), shape = 19, color = "red", alpha = 0.6) +</span></span>
<span id="cb205-858"><a href="#cb205-858" aria-hidden="true" tabindex="-1"></a><span class="in">  # geom_point(data = (kar_gap %&gt;% filter(ADD != "Notification")), aes(x = as_date(WEEK), y = 0), size = 3, alpha = 0.6, shape = 17, color = "#bdbdbd")</span></span>
<span id="cb205-859"><a href="#cb205-859" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-860"><a href="#cb205-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-861"><a href="#cb205-861" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; This is a good supplementary figure or summary figure for a poster explaining the IFCB.</span></span>
<span id="cb205-862"><a href="#cb205-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-863"><a href="#cb205-863" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot biotic - one year</span></span>
<span id="cb205-864"><a href="#cb205-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-867"><a href="#cb205-867" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-868"><a href="#cb205-868" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(plot_biotic)</span>
<span id="cb205-869"><a href="#cb205-869" aria-hidden="true" tabindex="-1"></a>biotic_1yr <span class="ot">&lt;-</span> plot_biotic <span class="sc">%&gt;%</span> </span>
<span id="cb205-870"><a href="#cb205-870" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Group by cell ID to get mean for a single day</span></span>
<span id="cb205-871"><a href="#cb205-871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DAY_NOYEAR, DATE, CELL_ID, SEASON, COURSE_CLASSIFICATION) <span class="sc">%&gt;%</span> </span>
<span id="cb205-872"><a href="#cb205-872" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">PER_DAY_CELL =</span> <span class="fu">mean</span>(COUNT),</span>
<span id="cb205-873"><a href="#cb205-873" aria-hidden="true" tabindex="-1"></a>              <span class="at">PER_DAY_CARBON =</span> <span class="fu">mean</span>(CARBON),</span>
<span id="cb205-874"><a href="#cb205-874" aria-hidden="true" tabindex="-1"></a>              <span class="at">PER_DAY_CARBON_ml =</span> <span class="fu">mean</span>(pgC_ml)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-875"><a href="#cb205-875" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb205-876"><a href="#cb205-876" aria-hidden="true" tabindex="-1"></a>  <span class="co"># NOW sum up the different cell types that contribute to the course classification per day</span></span>
<span id="cb205-877"><a href="#cb205-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DAY_NOYEAR, DATE, SEASON, COURSE_CLASSIFICATION) <span class="sc">%&gt;%</span> </span>
<span id="cb205-878"><a href="#cb205-878" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">PER_DAY_COURSE_CELL =</span> <span class="fu">sum</span>(PER_DAY_CELL),</span>
<span id="cb205-879"><a href="#cb205-879" aria-hidden="true" tabindex="-1"></a>              <span class="at">PER_DAY_COURSE_CARBON =</span> <span class="fu">sum</span>(PER_DAY_CARBON),</span>
<span id="cb205-880"><a href="#cb205-880" aria-hidden="true" tabindex="-1"></a>              <span class="at">PER_DAY_COURSE_CARBONml =</span> <span class="fu">sum</span>(PER_DAY_CARBON_ml)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-881"><a href="#cb205-881" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb205-882"><a href="#cb205-882" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now average by year</span></span>
<span id="cb205-883"><a href="#cb205-883" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DAY_NOYEAR, COURSE_CLASSIFICATION, SEASON) <span class="sc">%&gt;%</span>  </span>
<span id="cb205-884"><a href="#cb205-884" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">MEAN_COUNTS_1yr =</span> <span class="fu">mean</span>(PER_DAY_COURSE_CELL),</span>
<span id="cb205-885"><a href="#cb205-885" aria-hidden="true" tabindex="-1"></a>              <span class="at">MEAN_CARBON_1yr =</span> <span class="fu">mean</span>(PER_DAY_COURSE_CARBON),</span>
<span id="cb205-886"><a href="#cb205-886" aria-hidden="true" tabindex="-1"></a>              <span class="at">MEAN_CARBONml_1yr =</span> <span class="fu">mean</span>(PER_DAY_COURSE_CARBONml)) </span>
<span id="cb205-887"><a href="#cb205-887" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(biotic_1yr)</span>
<span id="cb205-888"><a href="#cb205-888" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-889"><a href="#cb205-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-890"><a href="#cb205-890" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=9}</span></span>
<span id="cb205-891"><a href="#cb205-891" aria-hidden="true" tabindex="-1"></a><span class="in">YMAX &lt;- max(biotic_1yr$MEAN_CARBON_1yr)</span></span>
<span id="cb205-892"><a href="#cb205-892" aria-hidden="true" tabindex="-1"></a><span class="in">YMAX &lt;-0</span></span>
<span id="cb205-893"><a href="#cb205-893" aria-hidden="true" tabindex="-1"></a><span class="in"># YMAX</span></span>
<span id="cb205-894"><a href="#cb205-894" aria-hidden="true" tabindex="-1"></a><span class="in">biotic_1yr %&gt;% </span></span>
<span id="cb205-895"><a href="#cb205-895" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_longer(cols = starts_with("MEAN_")) %&gt;% </span></span>
<span id="cb205-896"><a href="#cb205-896" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(VARIABLE_LABEL = factor(name, levels = c("MEAN_COUNTS_1yr", "MEAN_CARBON_1yr", "MEAN_CARBONml_1yr"), labels = c(bquote("Cells"~ml^-1), bquote("pg Carbon"~cell^-1), bquote("pg Carbon"~ml^-1)))) %&gt;% </span></span>
<span id="cb205-897"><a href="#cb205-897" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = DAY_NOYEAR, y = value, fill = COURSE_CLASSIFICATION)) + </span></span>
<span id="cb205-898"><a href="#cb205-898" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_area(position = "stack") +</span></span>
<span id="cb205-899"><a href="#cb205-899" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb205-900"><a href="#cb205-900" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_date(date_labels = "%b", expand = c(0,0)) +</span></span>
<span id="cb205-901"><a href="#cb205-901" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(expand = c(0,0)) +</span></span>
<span id="cb205-902"><a href="#cb205-902" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(rows = vars(VARIABLE_LABEL), scales = "free", labeller = label_parsed) +</span></span>
<span id="cb205-903"><a href="#cb205-903" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "", y = "") +</span></span>
<span id="cb205-904"><a href="#cb205-904" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c("#fead5d", "#1468b3","#00ac43","#f6f86d","#fc7e66", "#c304aa")) +</span></span>
<span id="cb205-905"><a href="#cb205-905" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom", legend.title = element_blank(),</span></span>
<span id="cb205-906"><a href="#cb205-906" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.x = element_text(color = "black", face = "bold", size = 12),</span></span>
<span id="cb205-907"><a href="#cb205-907" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.y = element_text(color = "black", face = "bold", size = 12),</span></span>
<span id="cb205-908"><a href="#cb205-908" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.background = element_blank()) +</span></span>
<span id="cb205-909"><a href="#cb205-909" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_rect(xmin = as_date("2024-09-01"), xmax = as_date("2024-11-30"), ymin = (YMAX), ymax = (YMAX+40), alpha = 0.2, fill = "#cc5500") +</span></span>
<span id="cb205-910"><a href="#cb205-910" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_rect(xmin = as_date("2024-03-01"), xmax = as_date("2024-5-31"), ymin = (YMAX), ymax = (YMAX+40), alpha = 0.2, fill = "#bccbae") +</span></span>
<span id="cb205-911"><a href="#cb205-911" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_rect(xmin = as_date("2024-06-01"), xmax = as_date("2024-08-31"), ymin = (YMAX), ymax = (YMAX+40), alpha = 0.2, fill = "#ffbf00") +</span></span>
<span id="cb205-912"><a href="#cb205-912" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_rect(xmin = as_date("2024-12-01"), xmax = as_date("2024-12-31"), ymin = (YMAX), ymax = (YMAX+40), alpha = 0.2, fill = "#5d4e62") +</span></span>
<span id="cb205-913"><a href="#cb205-913" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_rect(xmin = as_date("2024-01-01"), xmax = as_date("2024-02-29"), ymin = (YMAX), ymax = (YMAX+40),, alpha = 0.2, fill = "#5d4e62")</span></span>
<span id="cb205-914"><a href="#cb205-914" aria-hidden="true" tabindex="-1"></a><span class="in">#Spring = March 1 - May 31 </span></span>
<span id="cb205-915"><a href="#cb205-915" aria-hidden="true" tabindex="-1"></a><span class="in">#Summer = June 1 - Aug 31 </span></span>
<span id="cb205-916"><a href="#cb205-916" aria-hidden="true" tabindex="-1"></a><span class="in">#Fall = Sept 1 - Nov 30 </span></span>
<span id="cb205-917"><a href="#cb205-917" aria-hidden="true" tabindex="-1"></a><span class="in">#Winter = Dec 1 - Feb (March 1 (-1))</span></span>
<span id="cb205-918"><a href="#cb205-918" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-919"><a href="#cb205-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-920"><a href="#cb205-920" aria-hidden="true" tabindex="-1"></a><span class="fu">## All daily</span></span>
<span id="cb205-921"><a href="#cb205-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-922"><a href="#cb205-922" aria-hidden="true" tabindex="-1"></a>Look at by hour and season for different supergroups.</span>
<span id="cb205-923"><a href="#cb205-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-924"><a href="#cb205-924" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=10}</span></span>
<span id="cb205-925"><a href="#cb205-925" aria-hidden="true" tabindex="-1"></a><span class="in">combined_biol_metadata |&gt; </span></span>
<span id="cb205-926"><a href="#cb205-926" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(COURSE_CLASSIFICATION == "Microeukaryote") %&gt;% </span></span>
<span id="cb205-927"><a href="#cb205-927" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Phylum != "Cnidaria") %&gt;% </span></span>
<span id="cb205-928"><a href="#cb205-928" aria-hidden="true" tabindex="-1"></a><span class="in">  # Remove any zeroes</span></span>
<span id="cb205-929"><a href="#cb205-929" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(COUNT &gt; 0 | is.na(COUNT)) %&gt;% </span></span>
<span id="cb205-930"><a href="#cb205-930" aria-hidden="true" tabindex="-1"></a><span class="in">  # Get average for a given hour in the same month and season for an individual day.</span></span>
<span id="cb205-931"><a href="#cb205-931" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(HOUR, SEASON, Supergroup, Phylum) %&gt;% </span></span>
<span id="cb205-932"><a href="#cb205-932" aria-hidden="true" tabindex="-1"></a><span class="in">    summarise(MEAN_COUNT_DAILY = mean(COUNT),</span></span>
<span id="cb205-933"><a href="#cb205-933" aria-hidden="true" tabindex="-1"></a><span class="in">              MAX_COUNT_DAILY = max(COUNT),</span></span>
<span id="cb205-934"><a href="#cb205-934" aria-hidden="true" tabindex="-1"></a><span class="in">              MIN_COUNT_DAILY = min(COUNT)) %&gt;% </span></span>
<span id="cb205-935"><a href="#cb205-935" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = (HOUR), y = MEAN_COUNT_DAILY, color = SEASON)) +</span></span>
<span id="cb205-936"><a href="#cb205-936" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_path(aes(group = Phylum)) +</span></span>
<span id="cb205-937"><a href="#cb205-937" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_point(shape = 19) +</span></span>
<span id="cb205-938"><a href="#cb205-938" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_grid(rows = vars(Supergroup), cols = vars(SEASON), scales = "free") +</span></span>
<span id="cb205-939"><a href="#cb205-939" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb205-940"><a href="#cb205-940" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(values = c("#cc5500","#bccbae","#ffbf00","#5d4e62")) +</span></span>
<span id="cb205-941"><a href="#cb205-941" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_log10() +</span></span>
<span id="cb205-942"><a href="#cb205-942" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "", y = bquote("log cell"~ml^-1)) +</span></span>
<span id="cb205-943"><a href="#cb205-943" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom", legend.title = element_blank(),</span></span>
<span id="cb205-944"><a href="#cb205-944" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.x = element_text(color = "black", face = "bold", size = 10),</span></span>
<span id="cb205-945"><a href="#cb205-945" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title = element_text(color = "black", face = "bold", size = 11),</span></span>
<span id="cb205-946"><a href="#cb205-946" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.y = element_text(color = "black", face = "bold", size = 10),</span></span>
<span id="cb205-947"><a href="#cb205-947" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid.major = element_line(color = "#d9d9d9", linewidth = 0.3))</span></span>
<span id="cb205-948"><a href="#cb205-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-949"><a href="#cb205-949" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-950"><a href="#cb205-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-951"><a href="#cb205-951" aria-hidden="true" tabindex="-1"></a>Each line represents a phylum, so there are some withe more variability than others. We also know that cell types are not equally represented across the supergroups in the IFCB data, therefore, we need to focus on the stramenopiles and alveolata vs. other supergroups.</span>
<span id="cb205-952"><a href="#cb205-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-953"><a href="#cb205-953" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=10}</span></span>
<span id="cb205-954"><a href="#cb205-954" aria-hidden="true" tabindex="-1"></a><span class="in">alv_stram &lt;- c("Stramenopiles", "Alveolata")</span></span>
<span id="cb205-955"><a href="#cb205-955" aria-hidden="true" tabindex="-1"></a><span class="in"># counts_long_wtax_wseason</span></span>
<span id="cb205-956"><a href="#cb205-956" aria-hidden="true" tabindex="-1"></a><span class="in">combined_biol_metadata |&gt; </span></span>
<span id="cb205-957"><a href="#cb205-957" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(COURSE_CLASSIFICATION == "Microeukaryote") %&gt;% </span></span>
<span id="cb205-958"><a href="#cb205-958" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Phylum != "Cnidaria") %&gt;% </span></span>
<span id="cb205-959"><a href="#cb205-959" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!(Supergroup %in% alv_stram)) %&gt;% </span></span>
<span id="cb205-960"><a href="#cb205-960" aria-hidden="true" tabindex="-1"></a><span class="in">  # Remove any zeroes</span></span>
<span id="cb205-961"><a href="#cb205-961" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(COUNT &gt; 0 | is.na(COUNT)) %&gt;% </span></span>
<span id="cb205-962"><a href="#cb205-962" aria-hidden="true" tabindex="-1"></a><span class="in">  # Get average for a given hour in the same month and season for an individual day.</span></span>
<span id="cb205-963"><a href="#cb205-963" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(HOUR, SEASON, Supergroup, Phylum, CELL_ID) %&gt;% </span></span>
<span id="cb205-964"><a href="#cb205-964" aria-hidden="true" tabindex="-1"></a><span class="in">    summarise(MEAN_COUNT_DAILY = mean(COUNT),</span></span>
<span id="cb205-965"><a href="#cb205-965" aria-hidden="true" tabindex="-1"></a><span class="in">              MAX_COUNT_DAILY = max(COUNT),</span></span>
<span id="cb205-966"><a href="#cb205-966" aria-hidden="true" tabindex="-1"></a><span class="in">              MIN_COUNT_DAILY = min(COUNT)) %&gt;% </span></span>
<span id="cb205-967"><a href="#cb205-967" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = (HOUR), y = MEAN_COUNT_DAILY, color = SEASON)) +</span></span>
<span id="cb205-968"><a href="#cb205-968" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_path(aes(group = CELL_ID)) +</span></span>
<span id="cb205-969"><a href="#cb205-969" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_point(shape = 19) +</span></span>
<span id="cb205-970"><a href="#cb205-970" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_grid(rows = vars(Supergroup), cols = vars(SEASON), scales = "free") +</span></span>
<span id="cb205-971"><a href="#cb205-971" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb205-972"><a href="#cb205-972" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(values = c("#cc5500","#bccbae","#ffbf00","#5d4e62")) +</span></span>
<span id="cb205-973"><a href="#cb205-973" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_log10() +</span></span>
<span id="cb205-974"><a href="#cb205-974" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "", y = bquote("log cell"~ml^-1)) +</span></span>
<span id="cb205-975"><a href="#cb205-975" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom", legend.title = element_blank(),</span></span>
<span id="cb205-976"><a href="#cb205-976" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.x = element_text(color = "black", face = "bold", size = 10),</span></span>
<span id="cb205-977"><a href="#cb205-977" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title = element_text(color = "black", face = "bold", size = 11),</span></span>
<span id="cb205-978"><a href="#cb205-978" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.y = element_text(color = "black", face = "bold", size = 10),</span></span>
<span id="cb205-979"><a href="#cb205-979" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid.major = element_line(color = "#d9d9d9", linewidth = 0.3))</span></span>
<span id="cb205-980"><a href="#cb205-980" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-981"><a href="#cb205-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-982"><a href="#cb205-982" aria-hidden="true" tabindex="-1"></a><span class="fu"># A focus on Dinoflagellates, Haptophytes, Ciliates, and diatoms</span></span>
<span id="cb205-983"><a href="#cb205-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-986"><a href="#cb205-986" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-987"><a href="#cb205-987" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_biol_metadata)</span>
<span id="cb205-988"><a href="#cb205-988" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(combined_biol_metadata<span class="sc">$</span>Phylum)</span>
<span id="cb205-989"><a href="#cb205-989" aria-hidden="true" tabindex="-1"></a>dino_diatom_cil_hapto <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Ochrophyta"</span>, <span class="st">"Dinoflagellate"</span>, <span class="st">"Ciliophora"</span>, <span class="st">"Haptophyta"</span>)</span>
<span id="cb205-990"><a href="#cb205-990" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-991"><a href="#cb205-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-994"><a href="#cb205-994" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-995"><a href="#cb205-995" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> combined_biol_metadata <span class="sc">|&gt;</span> </span>
<span id="cb205-996"><a href="#cb205-996" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Phylum <span class="sc">%in%</span> dino_diatom_cil_hapto) <span class="sc">%&gt;%</span> </span>
<span id="cb205-997"><a href="#cb205-997" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Phylum, Class, CELL_ID) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb205-998"><a href="#cb205-998" aria-hidden="true" tabindex="-1"></a>?<span class="fu">count</span>()</span>
<span id="cb205-999"><a href="#cb205-999" aria-hidden="true" tabindex="-1"></a><span class="co"># head(tmp)</span></span>
<span id="cb205-1000"><a href="#cb205-1000" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1001"><a href="#cb205-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1002"><a href="#cb205-1002" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot a year trend at Phylum level</span></span>
<span id="cb205-1003"><a href="#cb205-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1004"><a href="#cb205-1004" aria-hidden="true" tabindex="-1"></a>First cell counts.</span>
<span id="cb205-1005"><a href="#cb205-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1006"><a href="#cb205-1006" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=10}</span></span>
<span id="cb205-1007"><a href="#cb205-1007" aria-hidden="true" tabindex="-1"></a><span class="in">oneyr_phylum &lt;- combined_biol_metadata |&gt; </span></span>
<span id="cb205-1008"><a href="#cb205-1008" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Phylum %in% dino_diatom_cil_hapto) %&gt;% </span></span>
<span id="cb205-1009"><a href="#cb205-1009" aria-hidden="true" tabindex="-1"></a><span class="in">  # Remove any zeroes</span></span>
<span id="cb205-1010"><a href="#cb205-1010" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(COUNT &gt; 0 | is.na(COUNT)) %&gt;% </span></span>
<span id="cb205-1011"><a href="#cb205-1011" aria-hidden="true" tabindex="-1"></a><span class="in">  select(DATE, COUNT, Phylum, CELL_ID, CARBON, Class, DAY_NOYEAR) %&gt;%</span></span>
<span id="cb205-1012"><a href="#cb205-1012" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct() %&gt;% </span></span>
<span id="cb205-1013"><a href="#cb205-1013" aria-hidden="true" tabindex="-1"></a><span class="in">  # Add up cell types for a single day. </span></span>
<span id="cb205-1014"><a href="#cb205-1014" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(DATE, Phylum, CELL_ID, DAY_NOYEAR) %&gt;% </span></span>
<span id="cb205-1015"><a href="#cb205-1015" aria-hidden="true" tabindex="-1"></a><span class="in">    summarise(SUM_CELLS_day = sum(COUNT),</span></span>
<span id="cb205-1016"><a href="#cb205-1016" aria-hidden="true" tabindex="-1"></a><span class="in">              SUM_CARBON_day = sum(CARBON)) %&gt;% </span></span>
<span id="cb205-1017"><a href="#cb205-1017" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb205-1018"><a href="#cb205-1018" aria-hidden="true" tabindex="-1"></a><span class="in">  # Add a column to specify the WEEK - have week start on Mondays</span></span>
<span id="cb205-1019"><a href="#cb205-1019" aria-hidden="true" tabindex="-1"></a><span class="in">  # mutate(WEEK = cut(DATE, "week", start.on.monday = TRUE),</span></span>
<span id="cb205-1020"><a href="#cb205-1020" aria-hidden="true" tabindex="-1"></a><span class="in">  #        MONTH = month(as_date(DATE)),</span></span>
<span id="cb205-1021"><a href="#cb205-1021" aria-hidden="true" tabindex="-1"></a><span class="in">  #        YEAR = year(as_date(DATE))) %&gt;% </span></span>
<span id="cb205-1022"><a href="#cb205-1022" aria-hidden="true" tabindex="-1"></a><span class="in">  # Get mean, min, and max for each week</span></span>
<span id="cb205-1023"><a href="#cb205-1023" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(DAY_NOYEAR, Phylum) %&gt;% </span></span>
<span id="cb205-1024"><a href="#cb205-1024" aria-hidden="true" tabindex="-1"></a><span class="in">  # Take average across years.</span></span>
<span id="cb205-1025"><a href="#cb205-1025" aria-hidden="true" tabindex="-1"></a><span class="in">  # group_by(DAY_NOYEAR, Phylum) %&gt;% </span></span>
<span id="cb205-1026"><a href="#cb205-1026" aria-hidden="true" tabindex="-1"></a><span class="in">    summarise(MEAN_CELLS_day_1yr = mean(SUM_CELLS_day),</span></span>
<span id="cb205-1027"><a href="#cb205-1027" aria-hidden="true" tabindex="-1"></a><span class="in">              MAX_CELLS_day_1yr = max(SUM_CELLS_day),</span></span>
<span id="cb205-1028"><a href="#cb205-1028" aria-hidden="true" tabindex="-1"></a><span class="in">              MIN_CELLS_day_1yr = min(SUM_CELLS_day),</span></span>
<span id="cb205-1029"><a href="#cb205-1029" aria-hidden="true" tabindex="-1"></a><span class="in">              SEM_CELLS_day_1yr = (sd(SUM_CELLS_day)/n()),</span></span>
<span id="cb205-1030"><a href="#cb205-1030" aria-hidden="true" tabindex="-1"></a><span class="in">              MEAN_C_day_1yr = mean(SUM_CARBON_day),</span></span>
<span id="cb205-1031"><a href="#cb205-1031" aria-hidden="true" tabindex="-1"></a><span class="in">              MAX_C_day_1yr = max(SUM_CARBON_day),</span></span>
<span id="cb205-1032"><a href="#cb205-1032" aria-hidden="true" tabindex="-1"></a><span class="in">              MIN_C_day_1yr = min(SUM_CARBON_day),</span></span>
<span id="cb205-1033"><a href="#cb205-1033" aria-hidden="true" tabindex="-1"></a><span class="in">              SEM_C_day_1yr = (sd(SUM_CARBON_day/n()))) </span></span>
<span id="cb205-1034"><a href="#cb205-1034" aria-hidden="true" tabindex="-1"></a><span class="in"># Standard error of the mean = SD / sample size</span></span>
<span id="cb205-1035"><a href="#cb205-1035" aria-hidden="true" tabindex="-1"></a><span class="in"># head(oneyr_phylum)</span></span>
<span id="cb205-1036"><a href="#cb205-1036" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1037"><a href="#cb205-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1038"><a href="#cb205-1038" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=10}</span></span>
<span id="cb205-1039"><a href="#cb205-1039" aria-hidden="true" tabindex="-1"></a><span class="in">oneyr_phylum %&gt;% </span></span>
<span id="cb205-1040"><a href="#cb205-1040" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = as_date(DAY_NOYEAR), fill = Phylum, color = Phylum)) +</span></span>
<span id="cb205-1041"><a href="#cb205-1041" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_ribbon(aes(ymin = (MEAN_CELLS_day_1yr-SEM_CELLS_day_1yr), ymax = (MEAN_CELLS_day_1yr+SEM_CELLS_day_1yr), fill = Phylum)) +</span></span>
<span id="cb205-1042"><a href="#cb205-1042" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(aes(y = MEAN_CELLS_day_1yr), shape = 19) +</span></span>
<span id="cb205-1043"><a href="#cb205-1043" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = MEAN_CELLS_day_1yr)) +</span></span>
<span id="cb205-1044"><a href="#cb205-1044" aria-hidden="true" tabindex="-1"></a><span class="in">  # geom_linerange(aes(ymin = MIN_CELLS_day_1yr, ymax = MAX_CELLS_day_1yr, color = Phylum, alpha = 0.3), linewidth = 0.3) +</span></span>
<span id="cb205-1045"><a href="#cb205-1045" aria-hidden="true" tabindex="-1"></a><span class="in">  #   geom_point(shape = 19, size = 2, aes(color = Phylum)) +</span></span>
<span id="cb205-1046"><a href="#cb205-1046" aria-hidden="true" tabindex="-1"></a><span class="in">  # geom_area(stat = "identity", position = "stack") +</span></span>
<span id="cb205-1047"><a href="#cb205-1047" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb205-1048"><a href="#cb205-1048" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_date(date_labels = "%b", expand = c(0,0)) +</span></span>
<span id="cb205-1049"><a href="#cb205-1049" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_log10() +</span></span>
<span id="cb205-1050"><a href="#cb205-1050" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(rows = vars(Phylum), scales = "free", labeller = label_parsed) +</span></span>
<span id="cb205-1051"><a href="#cb205-1051" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "", y = "Cells per ml") +</span></span>
<span id="cb205-1052"><a href="#cb205-1052" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(values = c("#1468b3","#fc7e66", "#00ac43","#fead5d", "#c304aa")) +</span></span>
<span id="cb205-1053"><a href="#cb205-1053" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c("#1468b3","#fc7e66", "#00ac43","#fead5d", "#c304aa")) +</span></span>
<span id="cb205-1054"><a href="#cb205-1054" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom", legend.title = element_blank(),</span></span>
<span id="cb205-1055"><a href="#cb205-1055" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.x = element_text(color = "black", face = "bold", size = 12),</span></span>
<span id="cb205-1056"><a href="#cb205-1056" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.y = element_text(color = "black", face = "bold", size = 12),</span></span>
<span id="cb205-1057"><a href="#cb205-1057" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text.y = element_text(color = "black", face = "bold", size = 12),</span></span>
<span id="cb205-1058"><a href="#cb205-1058" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.background = element_blank(),</span></span>
<span id="cb205-1059"><a href="#cb205-1059" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid.major.x = element_line(color = "grey80"))</span></span>
<span id="cb205-1060"><a href="#cb205-1060" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1061"><a href="#cb205-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1062"><a href="#cb205-1062" aria-hidden="true" tabindex="-1"></a>Repeat with carbon</span>
<span id="cb205-1063"><a href="#cb205-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1064"><a href="#cb205-1064" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=10}</span></span>
<span id="cb205-1065"><a href="#cb205-1065" aria-hidden="true" tabindex="-1"></a><span class="in">oneyr_phylum %&gt;% </span></span>
<span id="cb205-1066"><a href="#cb205-1066" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = as_date(DAY_NOYEAR), fill = Phylum, color = Phylum)) +</span></span>
<span id="cb205-1067"><a href="#cb205-1067" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_ribbon(aes(ymin = (MEAN_C_day_1yr-SEM_C_day_1yr), ymax = (MEAN_C_day_1yr+SEM_C_day_1yr), fill = Phylum)) +</span></span>
<span id="cb205-1068"><a href="#cb205-1068" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(aes(y = MEAN_C_day_1yr), shape = 19) +</span></span>
<span id="cb205-1069"><a href="#cb205-1069" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = MEAN_C_day_1yr)) +</span></span>
<span id="cb205-1070"><a href="#cb205-1070" aria-hidden="true" tabindex="-1"></a><span class="in">  # geom_linerange(aes(ymin = MIN_CELLS_day_1yr, ymax = MAX_CELLS_day_1yr, color = Phylum, alpha = 0.3), linewidth = 0.3) +</span></span>
<span id="cb205-1071"><a href="#cb205-1071" aria-hidden="true" tabindex="-1"></a><span class="in">  #   geom_point(shape = 19, size = 2, aes(color = Phylum)) +</span></span>
<span id="cb205-1072"><a href="#cb205-1072" aria-hidden="true" tabindex="-1"></a><span class="in">  # geom_area(stat = "identity", position = "stack") +</span></span>
<span id="cb205-1073"><a href="#cb205-1073" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb205-1074"><a href="#cb205-1074" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_date(date_labels = "%b", expand = c(0,0)) +</span></span>
<span id="cb205-1075"><a href="#cb205-1075" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_log10() +</span></span>
<span id="cb205-1076"><a href="#cb205-1076" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(rows = vars(Phylum), scales = "free", labeller = label_parsed) +</span></span>
<span id="cb205-1077"><a href="#cb205-1077" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "", y = "pg Carbon") +</span></span>
<span id="cb205-1078"><a href="#cb205-1078" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(values = c("#1468b3","#fc7e66", "#00ac43","#fead5d", "#c304aa")) +</span></span>
<span id="cb205-1079"><a href="#cb205-1079" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c("#1468b3","#fc7e66", "#00ac43","#fead5d", "#c304aa")) +</span></span>
<span id="cb205-1080"><a href="#cb205-1080" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom", legend.title = element_blank(),</span></span>
<span id="cb205-1081"><a href="#cb205-1081" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.x = element_text(color = "black", face = "bold", size = 12),</span></span>
<span id="cb205-1082"><a href="#cb205-1082" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.y = element_text(color = "black", face = "bold", size = 12),</span></span>
<span id="cb205-1083"><a href="#cb205-1083" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text.y = element_text(color = "black", face = "bold", size = 12),</span></span>
<span id="cb205-1084"><a href="#cb205-1084" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.background = element_blank(),</span></span>
<span id="cb205-1085"><a href="#cb205-1085" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid.major.x = element_line(color = "grey80"))</span></span>
<span id="cb205-1086"><a href="#cb205-1086" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1087"><a href="#cb205-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1088"><a href="#cb205-1088" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plot at cell type level within each class</span></span>
<span id="cb205-1089"><a href="#cb205-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1092"><a href="#cb205-1092" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-1093"><a href="#cb205-1093" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_biol_metadata)</span>
<span id="cb205-1094"><a href="#cb205-1094" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1095"><a href="#cb205-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1096"><a href="#cb205-1096" aria-hidden="true" tabindex="-1"></a>Diatom genus of choice!</span>
<span id="cb205-1097"><a href="#cb205-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1100"><a href="#cb205-1100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-1101"><a href="#cb205-1101" aria-hidden="true" tabindex="-1"></a><span class="co"># diatom_genus &lt;- c("Chaetoceros", "")</span></span>
<span id="cb205-1102"><a href="#cb205-1102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1103"><a href="#cb205-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1104"><a href="#cb205-1104" aria-hidden="true" tabindex="-1"></a>Plot a year trend for Cell types within the classes.</span>
<span id="cb205-1105"><a href="#cb205-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1106"><a href="#cb205-1106" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=10}</span></span>
<span id="cb205-1107"><a href="#cb205-1107" aria-hidden="true" tabindex="-1"></a><span class="in">diatom_genus_oneyr &lt;- combined_biol_metadata |&gt; </span></span>
<span id="cb205-1108"><a href="#cb205-1108" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Class %in% "Bacillariophyceae") %&gt;% </span></span>
<span id="cb205-1109"><a href="#cb205-1109" aria-hidden="true" tabindex="-1"></a><span class="in">  # Remove any zeroes</span></span>
<span id="cb205-1110"><a href="#cb205-1110" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(COUNT &gt; 0 | is.na(COUNT)) %&gt;% </span></span>
<span id="cb205-1111"><a href="#cb205-1111" aria-hidden="true" tabindex="-1"></a><span class="in">  select(DATE, COUNT, Order, Family, Genus, CELL_ID, CARBON, DAY_NOYEAR) %&gt;%</span></span>
<span id="cb205-1112"><a href="#cb205-1112" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct() %&gt;% </span></span>
<span id="cb205-1113"><a href="#cb205-1113" aria-hidden="true" tabindex="-1"></a><span class="in">  # Add up Genus level types for a single day. </span></span>
<span id="cb205-1114"><a href="#cb205-1114" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(DATE, Order, Family, Genus, CELL_ID, DAY_NOYEAR) %&gt;% </span></span>
<span id="cb205-1115"><a href="#cb205-1115" aria-hidden="true" tabindex="-1"></a><span class="in">    summarise(SUM_CELLS_day = sum(COUNT),</span></span>
<span id="cb205-1116"><a href="#cb205-1116" aria-hidden="true" tabindex="-1"></a><span class="in">              SUM_CARBON_day = sum(CARBON)) %&gt;% </span></span>
<span id="cb205-1117"><a href="#cb205-1117" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb205-1118"><a href="#cb205-1118" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(DAY_NOYEAR, Genus) %&gt;% </span></span>
<span id="cb205-1119"><a href="#cb205-1119" aria-hidden="true" tabindex="-1"></a><span class="in">  # Take average across years.</span></span>
<span id="cb205-1120"><a href="#cb205-1120" aria-hidden="true" tabindex="-1"></a><span class="in">    summarise(MEAN_CELLS_day_1yr = mean(SUM_CELLS_day),</span></span>
<span id="cb205-1121"><a href="#cb205-1121" aria-hidden="true" tabindex="-1"></a><span class="in">              MAX_CELLS_day_1yr = max(SUM_CELLS_day),</span></span>
<span id="cb205-1122"><a href="#cb205-1122" aria-hidden="true" tabindex="-1"></a><span class="in">              MIN_CELLS_day_1yr = min(SUM_CELLS_day),</span></span>
<span id="cb205-1123"><a href="#cb205-1123" aria-hidden="true" tabindex="-1"></a><span class="in">              SEM_CELLS_day_1yr = (sd(SUM_CELLS_day)/n()),</span></span>
<span id="cb205-1124"><a href="#cb205-1124" aria-hidden="true" tabindex="-1"></a><span class="in">              MEAN_C_day_1yr = mean(SUM_CARBON_day),</span></span>
<span id="cb205-1125"><a href="#cb205-1125" aria-hidden="true" tabindex="-1"></a><span class="in">              MAX_C_day_1yr = max(SUM_CARBON_day),</span></span>
<span id="cb205-1126"><a href="#cb205-1126" aria-hidden="true" tabindex="-1"></a><span class="in">              MIN_C_day_1yr = min(SUM_CARBON_day),</span></span>
<span id="cb205-1127"><a href="#cb205-1127" aria-hidden="true" tabindex="-1"></a><span class="in">              SEM_C_day_1yr = (sd(SUM_CARBON_day/n()))) </span></span>
<span id="cb205-1128"><a href="#cb205-1128" aria-hidden="true" tabindex="-1"></a><span class="in"># Standard error of the mean = SD / sample size</span></span>
<span id="cb205-1129"><a href="#cb205-1129" aria-hidden="true" tabindex="-1"></a><span class="in">head(diatom_genus_oneyr)</span></span>
<span id="cb205-1130"><a href="#cb205-1130" aria-hidden="true" tabindex="-1"></a><span class="in"># length(unique(diatom_oneyr$CELL_ID)) # 37 unique cell types under diatoms. </span></span>
<span id="cb205-1131"><a href="#cb205-1131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1132"><a href="#cb205-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1133"><a href="#cb205-1133" aria-hidden="true" tabindex="-1"></a>Parse diatom data:</span>
<span id="cb205-1134"><a href="#cb205-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1137"><a href="#cb205-1137" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-1138"><a href="#cb205-1138" aria-hidden="true" tabindex="-1"></a>tmp_diatom <span class="ot">&lt;-</span> combined_biol_metadata <span class="sc">|&gt;</span> </span>
<span id="cb205-1139"><a href="#cb205-1139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Class <span class="sc">%in%</span> <span class="st">"Bacillariophyceae"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1140"><a href="#cb205-1140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Phylum, Class, Order, Family, Genus, Species, CELL_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1141"><a href="#cb205-1141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb205-1142"><a href="#cb205-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1143"><a href="#cb205-1143" aria-hidden="true" tabindex="-1"></a>perct_diatom  <span class="ot">&lt;-</span> combined_biol_metadata <span class="sc">|&gt;</span> </span>
<span id="cb205-1144"><a href="#cb205-1144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Class <span class="sc">%in%</span> <span class="st">"Bacillariophyceae"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1145"><a href="#cb205-1145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Phylum, Class, Order, Family, Genus, Species, CELL_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1146"><a href="#cb205-1146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb205-1147"><a href="#cb205-1147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1148"><a href="#cb205-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1149"><a href="#cb205-1149" aria-hidden="true" tabindex="-1"></a>Plot diatoms.</span>
<span id="cb205-1150"><a href="#cb205-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1151"><a href="#cb205-1151" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=15}</span></span>
<span id="cb205-1152"><a href="#cb205-1152" aria-hidden="true" tabindex="-1"></a><span class="in">diatom_genus_oneyr %&gt;% </span></span>
<span id="cb205-1153"><a href="#cb205-1153" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(!(Genus != "")) %&gt;% </span></span>
<span id="cb205-1154"><a href="#cb205-1154" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = as_date(DAY_NOYEAR), fill = Genus)) +</span></span>
<span id="cb205-1155"><a href="#cb205-1155" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_area(aes(y = MEAN_CELLS_day_1yr), color = "black", position = "fill") +</span></span>
<span id="cb205-1156"><a href="#cb205-1156" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb205-1157"><a href="#cb205-1157" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_date(date_labels = "%b", expand = c(0,0)) +</span></span>
<span id="cb205-1158"><a href="#cb205-1158" aria-hidden="true" tabindex="-1"></a><span class="in">  # scale_y_log10() +</span></span>
<span id="cb205-1159"><a href="#cb205-1159" aria-hidden="true" tabindex="-1"></a><span class="in">  # facet_grid(rows = vars(Order), scales = "free", labeller = label_parsed) +</span></span>
<span id="cb205-1160"><a href="#cb205-1160" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "", y = "Cells per ml") +</span></span>
<span id="cb205-1161"><a href="#cb205-1161" aria-hidden="true" tabindex="-1"></a><span class="in">  # scale_color_manual(values = c("#1468b3","#fc7e66", "#00ac43","#fead5d", "#c304aa")) +</span></span>
<span id="cb205-1162"><a href="#cb205-1162" aria-hidden="true" tabindex="-1"></a><span class="in">  # scale_fill_manual(values = c("#1468b3","#fc7e66", "#00ac43","#fead5d", "#c304aa")) +</span></span>
<span id="cb205-1163"><a href="#cb205-1163" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom", legend.title = element_blank(),</span></span>
<span id="cb205-1164"><a href="#cb205-1164" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.x = element_text(color = "black", face = "bold", size = 12),</span></span>
<span id="cb205-1165"><a href="#cb205-1165" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.y = element_text(color = "black", face = "bold", size = 12),</span></span>
<span id="cb205-1166"><a href="#cb205-1166" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text.y = element_text(color = "black", face = "bold", size = 12),</span></span>
<span id="cb205-1167"><a href="#cb205-1167" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.background = element_blank(),</span></span>
<span id="cb205-1168"><a href="#cb205-1168" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid.major.x = element_line(color = "grey80"))</span></span>
<span id="cb205-1169"><a href="#cb205-1169" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1170"><a href="#cb205-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1171"><a href="#cb205-1171" aria-hidden="true" tabindex="-1"></a><span class="fu">### Tile plots</span></span>
<span id="cb205-1172"><a href="#cb205-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1173"><a href="#cb205-1173" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=5, fig.width=6}</span></span>
<span id="cb205-1174"><a href="#cb205-1174" aria-hidden="true" tabindex="-1"></a><span class="in">combined_biol_metadata |&gt; </span></span>
<span id="cb205-1175"><a href="#cb205-1175" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Supergroup == "Alveolata") |&gt; </span></span>
<span id="cb205-1176"><a href="#cb205-1176" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Phylum, Class, Order) |&gt; </span></span>
<span id="cb205-1177"><a href="#cb205-1177" aria-hidden="true" tabindex="-1"></a><span class="in">    summarise(SUM = sum(COUNT),</span></span>
<span id="cb205-1178"><a href="#cb205-1178" aria-hidden="true" tabindex="-1"></a><span class="in">              COUNT = n()) |&gt; </span></span>
<span id="cb205-1179"><a href="#cb205-1179" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(area = SUM, fill = Class, subgroup = Order, label = Order)) +</span></span>
<span id="cb205-1180"><a href="#cb205-1180" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_treemap(color = "white") +</span></span>
<span id="cb205-1181"><a href="#cb205-1181" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_treemap_subgroup_border(color = "grey") +</span></span>
<span id="cb205-1182"><a href="#cb205-1182" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_treemap_text(place = "centre",size = 12) + </span></span>
<span id="cb205-1183"><a href="#cb205-1183" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb205-1184"><a href="#cb205-1184" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Most abundant Alveolata")</span></span>
<span id="cb205-1185"><a href="#cb205-1185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1186"><a href="#cb205-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1187"><a href="#cb205-1187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=5, fig.width=6}</span></span>
<span id="cb205-1188"><a href="#cb205-1188" aria-hidden="true" tabindex="-1"></a><span class="in">combined_biol_metadata |&gt; </span></span>
<span id="cb205-1189"><a href="#cb205-1189" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Supergroup == "Alveolata") |&gt; </span></span>
<span id="cb205-1190"><a href="#cb205-1190" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Phylum, Class, Order) |&gt; </span></span>
<span id="cb205-1191"><a href="#cb205-1191" aria-hidden="true" tabindex="-1"></a><span class="in">    summarise(SUM_CARBON = sum(CARBON)) |&gt; </span></span>
<span id="cb205-1192"><a href="#cb205-1192" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(area = SUM_CARBON, fill = Class, subgroup = Order, label = Order)) +</span></span>
<span id="cb205-1193"><a href="#cb205-1193" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_treemap(color = "white") +</span></span>
<span id="cb205-1194"><a href="#cb205-1194" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_treemap_subgroup_border(color = "grey") +</span></span>
<span id="cb205-1195"><a href="#cb205-1195" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_treemap_text(place = "centre",size = 12) + </span></span>
<span id="cb205-1196"><a href="#cb205-1196" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb205-1197"><a href="#cb205-1197" aria-hidden="true" tabindex="-1"></a><span class="in">  labs("Alveolata by carbon")</span></span>
<span id="cb205-1198"><a href="#cb205-1198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1199"><a href="#cb205-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1200"><a href="#cb205-1200" aria-hidden="true" tabindex="-1"></a><span class="fu">### Breakdown Stramenopiles</span></span>
<span id="cb205-1201"><a href="#cb205-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1202"><a href="#cb205-1202" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=5, fig.width=6}</span></span>
<span id="cb205-1203"><a href="#cb205-1203" aria-hidden="true" tabindex="-1"></a><span class="in">combined_biol_metadata |&gt; </span></span>
<span id="cb205-1204"><a href="#cb205-1204" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Supergroup == "Stramenopiles") |&gt; </span></span>
<span id="cb205-1205"><a href="#cb205-1205" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Phylum, Class, Order) |&gt; </span></span>
<span id="cb205-1206"><a href="#cb205-1206" aria-hidden="true" tabindex="-1"></a><span class="in">    summarise(SUM = sum(COUNT),</span></span>
<span id="cb205-1207"><a href="#cb205-1207" aria-hidden="true" tabindex="-1"></a><span class="in">              COUNT = n()) |&gt; </span></span>
<span id="cb205-1208"><a href="#cb205-1208" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(area = SUM, fill = Class, subgroup = Order, label = Order)) +</span></span>
<span id="cb205-1209"><a href="#cb205-1209" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_treemap(color = "white") +</span></span>
<span id="cb205-1210"><a href="#cb205-1210" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_treemap_subgroup_border(color = "grey") +</span></span>
<span id="cb205-1211"><a href="#cb205-1211" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_treemap_text(place = "centre",size = 12) + </span></span>
<span id="cb205-1212"><a href="#cb205-1212" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb205-1213"><a href="#cb205-1213" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Most abundant Stramenopiles")</span></span>
<span id="cb205-1214"><a href="#cb205-1214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1215"><a href="#cb205-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1216"><a href="#cb205-1216" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=5, fig.width=6}</span></span>
<span id="cb205-1217"><a href="#cb205-1217" aria-hidden="true" tabindex="-1"></a><span class="in">combined_biol_metadata |&gt; </span></span>
<span id="cb205-1218"><a href="#cb205-1218" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Supergroup == "Stramenopiles") |&gt; </span></span>
<span id="cb205-1219"><a href="#cb205-1219" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Phylum, Class, Order) |&gt; </span></span>
<span id="cb205-1220"><a href="#cb205-1220" aria-hidden="true" tabindex="-1"></a><span class="in">    summarise(SUM_CARBON = sum(CARBON)) |&gt; </span></span>
<span id="cb205-1221"><a href="#cb205-1221" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(area = SUM_CARBON, fill = Class, subgroup = Order, label = Order)) +</span></span>
<span id="cb205-1222"><a href="#cb205-1222" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_treemap(color = "white") +</span></span>
<span id="cb205-1223"><a href="#cb205-1223" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_treemap_subgroup_border(color = "grey") +</span></span>
<span id="cb205-1224"><a href="#cb205-1224" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_treemap_text(place = "centre",size = 12) + </span></span>
<span id="cb205-1225"><a href="#cb205-1225" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb205-1226"><a href="#cb205-1226" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Stramenopiles by carbon")</span></span>
<span id="cb205-1227"><a href="#cb205-1227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1228"><a href="#cb205-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1229"><a href="#cb205-1229" aria-hidden="true" tabindex="-1"></a><span class="fu"># Table summaries</span></span>
<span id="cb205-1230"><a href="#cb205-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1231"><a href="#cb205-1231" aria-hidden="true" tabindex="-1"></a>What is the overall range of pgC per ml for each of these cell types?</span>
<span id="cb205-1232"><a href="#cb205-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1235"><a href="#cb205-1235" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-1236"><a href="#cb205-1236" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_biol_metadata)</span>
<span id="cb205-1237"><a href="#cb205-1237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1238"><a href="#cb205-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1241"><a href="#cb205-1241" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-1242"><a href="#cb205-1242" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> combined_biol_metadata <span class="sc">%&gt;%</span></span>
<span id="cb205-1243"><a href="#cb205-1243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COURSE_CLASSIFICATION <span class="sc">==</span> <span class="st">"Microeukaryote"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1244"><a href="#cb205-1244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span> <span class="sc">|</span> Supergroup <span class="sc">==</span> <span class="st">"Stramenopiles"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1245"><a href="#cb205-1245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pgC_ml =</span> COUNT <span class="sc">*</span> CARBON) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1246"><a href="#cb205-1246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Supergroup, Phylum, Class, Order, Family, Genus, CELL_ID, COUNT, CARBON, pgC_ml) <span class="sc">%&gt;%</span></span>
<span id="cb205-1247"><a href="#cb205-1247" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(COUNT, CARBON, pgC_ml)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1248"><a href="#cb205-1248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Supergroup, Phylum, Class, Order, Family, Genus, CELL_ID, name) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1249"><a href="#cb205-1249" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">MEAN =</span> <span class="fu">mean</span>(value),</span>
<span id="cb205-1250"><a href="#cb205-1250" aria-hidden="true" tabindex="-1"></a>              <span class="at">MAX =</span> <span class="fu">max</span>(value),</span>
<span id="cb205-1251"><a href="#cb205-1251" aria-hidden="true" tabindex="-1"></a>              <span class="at">MIN =</span> <span class="fu">min</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1252"><a href="#cb205-1252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Taxonomy, Supergroup, Phylum, Class, Order, Family, Genus, <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1253"><a href="#cb205-1253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> name, <span class="at">values_from =</span> <span class="fu">c</span>(MEAN, MAX, MIN), <span class="at">names_sep =</span> <span class="st">"_"</span>)</span>
<span id="cb205-1254"><a href="#cb205-1254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1255"><a href="#cb205-1255" aria-hidden="true" tabindex="-1"></a><span class="co"># table</span></span>
<span id="cb205-1256"><a href="#cb205-1256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1257"><a href="#cb205-1257" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(table, file = "output-data/table_alveolata_stramenopiles_totalstats.csv")</span></span>
<span id="cb205-1258"><a href="#cb205-1258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1259"><a href="#cb205-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1262"><a href="#cb205-1262" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-1263"><a href="#cb205-1263" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_biol_metadata)</span>
<span id="cb205-1264"><a href="#cb205-1264" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(combined_biol_metadata$Class)</span></span>
<span id="cb205-1265"><a href="#cb205-1265" aria-hidden="true" tabindex="-1"></a>combined_biol_metadata <span class="sc">%&gt;%</span></span>
<span id="cb205-1266"><a href="#cb205-1266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COURSE_CLASSIFICATION <span class="sc">==</span> <span class="st">"Microeukaryote"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1267"><a href="#cb205-1267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span> <span class="sc">|</span> Supergroup <span class="sc">==</span> <span class="st">"Stramenopiles"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1268"><a href="#cb205-1268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Class <span class="sc">==</span> <span class="st">"Bacillariophyceae"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1269"><a href="#cb205-1269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pgC_ml =</span> COUNT <span class="sc">*</span> CARBON) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1270"><a href="#cb205-1270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DATE, Supergroup, Phylum, Class, Order, CELL_ID, COUNT, CARBON, pgC_ml) <span class="sc">%&gt;%</span></span>
<span id="cb205-1271"><a href="#cb205-1271" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(COUNT, CARBON, pgC_ml)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1272"><a href="#cb205-1272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1273"><a href="#cb205-1273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DATE, Supergroup, Phylum, Class, Order, CELL_ID, name) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1274"><a href="#cb205-1274" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">MEAN =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1275"><a href="#cb205-1275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VARIABLE_LABEL =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"COUNT"</span>, <span class="st">"CARBON"</span>, <span class="st">"pgC_ml"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="fu">bquote</span>(<span class="st">"Cells"</span><span class="sc">~</span>ml<span class="sc">^-</span><span class="dv">1</span>), <span class="fu">bquote</span>(<span class="st">"pg Carbon"</span><span class="sc">~</span>cell<span class="sc">^-</span><span class="dv">1</span>), <span class="fu">bquote</span>(<span class="st">"pg Carbon"</span><span class="sc">~</span>ml<span class="sc">^-</span><span class="dv">1</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb205-1276"><a href="#cb205-1276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Order, <span class="at">y =</span> MEAN)) <span class="sc">+</span></span>
<span id="cb205-1277"><a href="#cb205-1277" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb205-1278"><a href="#cb205-1278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb205-1279"><a href="#cb205-1279" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_x_date(date_labels = "%b", expand = c(0,0)) +</span></span>
<span id="cb205-1280"><a href="#cb205-1280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb205-1281"><a href="#cb205-1281" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_flip() +</span></span>
<span id="cb205-1282"><a href="#cb205-1282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(VARIABLE_LABEL), <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">labeller =</span> label_parsed) <span class="sc">+</span></span>
<span id="cb205-1283"><a href="#cb205-1283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>) <span class="co">#+</span></span>
<span id="cb205-1284"><a href="#cb205-1284" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_manual(values = c("#fead5d", "#1468b3","#00ac43","#f6f86d","#fc7e66", "#c304aa"))</span></span>
<span id="cb205-1285"><a href="#cb205-1285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1286"><a href="#cb205-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1287"><a href="#cb205-1287" aria-hidden="true" tabindex="-1"></a><span class="fu"># RDA analysis</span></span>
<span id="cb205-1288"><a href="#cb205-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1289"><a href="#cb205-1289" aria-hidden="true" tabindex="-1"></a>RDA reveals relationships among the sites (transcript profiles by site) and the environmental parameters. We can explore the relationship among all transcripts by site, and then model the effect that each environmental parameter has on it.</span>
<span id="cb205-1290"><a href="#cb205-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1291"><a href="#cb205-1291" aria-hidden="true" tabindex="-1"></a>To perform the RDA analysis, we need to isolate biotic vs. abiotic parameters. Normalize them individually and then run the RDA.</span>
<span id="cb205-1292"><a href="#cb205-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1295"><a href="#cb205-1295" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-1296"><a href="#cb205-1296" aria-hidden="true" tabindex="-1"></a><span class="co"># load("input-data/data_annotated_wtax_wseason.RData", verbose = TRUE)</span></span>
<span id="cb205-1297"><a href="#cb205-1297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1298"><a href="#cb205-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1299"><a href="#cb205-1299" aria-hidden="true" tabindex="-1"></a><span class="fu">### Subset and format data</span></span>
<span id="cb205-1300"><a href="#cb205-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1301"><a href="#cb205-1301" aria-hidden="true" tabindex="-1"></a>Goal is to keep as many parameters as possible, but also export the biological data as a matrix that has the same dimensions as the metadata.</span>
<span id="cb205-1302"><a href="#cb205-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1303"><a href="#cb205-1303" aria-hidden="true" tabindex="-1"></a>Isolate the abiotic parameters.</span>
<span id="cb205-1304"><a href="#cb205-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1307"><a href="#cb205-1307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-1308"><a href="#cb205-1308" aria-hidden="true" tabindex="-1"></a><span class="co"># Get non-numeric data here.</span></span>
<span id="cb205-1309"><a href="#cb205-1309" aria-hidden="true" tabindex="-1"></a><span class="co"># season_cat &lt;- combined_biol_metadata %&gt;% </span></span>
<span id="cb205-1310"><a href="#cb205-1310" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(DAY, SEASON) %&gt;% </span></span>
<span id="cb205-1311"><a href="#cb205-1311" aria-hidden="true" tabindex="-1"></a><span class="co">#   distinct()</span></span>
<span id="cb205-1312"><a href="#cb205-1312" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-1313"><a href="#cb205-1313" aria-hidden="true" tabindex="-1"></a><span class="co"># # Isolate numeric data</span></span>
<span id="cb205-1314"><a href="#cb205-1314" aria-hidden="true" tabindex="-1"></a><span class="co"># #WDIR, WSPD, ATMP, WTMP(SST), TIDE</span></span>
<span id="cb205-1315"><a href="#cb205-1315" aria-hidden="true" tabindex="-1"></a><span class="co"># abiotic_rda_input &lt;- combined_biol_metadata %&gt;% </span></span>
<span id="cb205-1316"><a href="#cb205-1316" aria-hidden="true" tabindex="-1"></a><span class="co">#   # select(DAY, WDIR, WSPD, ATMP, WTMP, TIDE) %&gt;% </span></span>
<span id="cb205-1317"><a href="#cb205-1317" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(DAY, ATMP, WTMP, TIDE) %&gt;% </span></span>
<span id="cb205-1318"><a href="#cb205-1318" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(ATMP != 999.0 | WTMP != 999.0 | TIDE != 999.0) %&gt;% </span></span>
<span id="cb205-1319"><a href="#cb205-1319" aria-hidden="true" tabindex="-1"></a><span class="co">#   distinct() </span></span>
<span id="cb205-1320"><a href="#cb205-1320" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1321"><a href="#cb205-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1322"><a href="#cb205-1322" aria-hidden="true" tabindex="-1"></a>Repeat for biotic data</span>
<span id="cb205-1323"><a href="#cb205-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1326"><a href="#cb205-1326" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-1327"><a href="#cb205-1327" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(combined_biol_metadata$Phylum)</span></span>
<span id="cb205-1328"><a href="#cb205-1328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1329"><a href="#cb205-1329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1332"><a href="#cb205-1332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-1333"><a href="#cb205-1333" aria-hidden="true" tabindex="-1"></a><span class="co"># biotic_rda_input &lt;- combined_biol_metadata %&gt;% </span></span>
<span id="cb205-1334"><a href="#cb205-1334" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(COURSE_CLASSIFICATION == "Microeukaryote" | COURSE_CLASSIFICATION == "Cyanobacteria") %&gt;% </span></span>
<span id="cb205-1335"><a href="#cb205-1335" aria-hidden="true" tabindex="-1"></a><span class="co">#   # filter(Phylum == "Ochrophyta") %&gt;% </span></span>
<span id="cb205-1336"><a href="#cb205-1336" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(DAY, CELL_ID, COUNT) %&gt;% distinct() %&gt;% </span></span>
<span id="cb205-1337"><a href="#cb205-1337" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_wider(names_from = CELL_ID, values_from = COUNT, values_fn = mean, values_fill = 0) %&gt;% </span></span>
<span id="cb205-1338"><a href="#cb205-1338" aria-hidden="true" tabindex="-1"></a><span class="co">#   distinct() </span></span>
<span id="cb205-1339"><a href="#cb205-1339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1340"><a href="#cb205-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1341"><a href="#cb205-1341" aria-hidden="true" tabindex="-1"></a>Compare dates. Create intersection of date time.</span>
<span id="cb205-1342"><a href="#cb205-1342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1345"><a href="#cb205-1345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-1346"><a href="#cb205-1346" aria-hidden="true" tabindex="-1"></a><span class="co"># biotic_rows &lt;- as.character((unique(biotic_rda_input$DAY)))</span></span>
<span id="cb205-1347"><a href="#cb205-1347" aria-hidden="true" tabindex="-1"></a><span class="co"># abiotic_rows &lt;- as.character((unique(abiotic_rda_input$DAY)))</span></span>
<span id="cb205-1348"><a href="#cb205-1348" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-1349"><a href="#cb205-1349" aria-hidden="true" tabindex="-1"></a><span class="co"># intersect_rows &lt;- intersect(biotic_rows, abiotic_rows)</span></span>
<span id="cb205-1350"><a href="#cb205-1350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1351"><a href="#cb205-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1352"><a href="#cb205-1352" aria-hidden="true" tabindex="-1"></a>Compile matrices with date select as well.</span>
<span id="cb205-1353"><a href="#cb205-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1356"><a href="#cb205-1356" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-1357"><a href="#cb205-1357" aria-hidden="true" tabindex="-1"></a><span class="co"># biotic_rda_input_filtered &lt;- biotic_rda_input %&gt;% </span></span>
<span id="cb205-1358"><a href="#cb205-1358" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(as_datetime(DAY) %in% as_datetime(intersect_rows)) %&gt;% </span></span>
<span id="cb205-1359"><a href="#cb205-1359" aria-hidden="true" tabindex="-1"></a><span class="co">#   column_to_rownames(var = "DAY") %&gt;% </span></span>
<span id="cb205-1360"><a href="#cb205-1360" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate_if(is.character, as.numeric) %&gt;%</span></span>
<span id="cb205-1361"><a href="#cb205-1361" aria-hidden="true" tabindex="-1"></a><span class="co">#   as.matrix</span></span>
<span id="cb205-1362"><a href="#cb205-1362" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-1363"><a href="#cb205-1363" aria-hidden="true" tabindex="-1"></a><span class="co"># abiotic_rda_input_filtered &lt;- abiotic_rda_input %&gt;% </span></span>
<span id="cb205-1364"><a href="#cb205-1364" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(as_datetime(DAY) %in% as_datetime(intersect_rows)) %&gt;% </span></span>
<span id="cb205-1365"><a href="#cb205-1365" aria-hidden="true" tabindex="-1"></a><span class="co">#   column_to_rownames(var = "DAY") %&gt;% </span></span>
<span id="cb205-1366"><a href="#cb205-1366" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate_if(is.character, as.numeric) %&gt;%</span></span>
<span id="cb205-1367"><a href="#cb205-1367" aria-hidden="true" tabindex="-1"></a><span class="co">#   as.matrix</span></span>
<span id="cb205-1368"><a href="#cb205-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1369"><a href="#cb205-1369" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(biotic_rda_input_filtered)</span></span>
<span id="cb205-1370"><a href="#cb205-1370" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(abiotic_rda_input_filtered)</span></span>
<span id="cb205-1371"><a href="#cb205-1371" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1372"><a href="#cb205-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1373"><a href="#cb205-1373" aria-hidden="true" tabindex="-1"></a>Perform standardizations / normalizations</span>
<span id="cb205-1374"><a href="#cb205-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1377"><a href="#cb205-1377" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-1378"><a href="#cb205-1378" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize</span></span>
<span id="cb205-1379"><a href="#cb205-1379" aria-hidden="true" tabindex="-1"></a><span class="co"># standard_metadata &lt;- vegan::decostand(abiotic_rda_input_filtered, MARGIN = 2, method = "standardize", na.action = na.exclude)</span></span>
<span id="cb205-1380"><a href="#cb205-1380" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-1381"><a href="#cb205-1381" aria-hidden="true" tabindex="-1"></a><span class="co"># metadata_normed_all &lt;- data.frame(standard_metadata) %&gt;% </span></span>
<span id="cb205-1382"><a href="#cb205-1382" aria-hidden="true" tabindex="-1"></a><span class="co">#   rownames_to_column(var = "DAY") %&gt;% </span></span>
<span id="cb205-1383"><a href="#cb205-1383" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(DAY = as_datetime(DAY)) %&gt;% </span></span>
<span id="cb205-1384"><a href="#cb205-1384" aria-hidden="true" tabindex="-1"></a><span class="co">#   right_join(season_cat) %&gt;% </span></span>
<span id="cb205-1385"><a href="#cb205-1385" aria-hidden="true" tabindex="-1"></a><span class="co">#   drop_na() %&gt;% </span></span>
<span id="cb205-1386"><a href="#cb205-1386" aria-hidden="true" tabindex="-1"></a><span class="co">#   column_to_rownames(var = "DAY")</span></span>
<span id="cb205-1387"><a href="#cb205-1387" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1388"><a href="#cb205-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1391"><a href="#cb205-1391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-1392"><a href="#cb205-1392" aria-hidden="true" tabindex="-1"></a><span class="co"># biotic_rda_standard_count &lt;- vegan::decostand(biotic_rda_input_filtered, MARGIN = 2, method = "normalize")</span></span>
<span id="cb205-1393"><a href="#cb205-1393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1394"><a href="#cb205-1394" aria-hidden="true" tabindex="-1"></a><span class="co">#chi.square</span></span>
<span id="cb205-1395"><a href="#cb205-1395" aria-hidden="true" tabindex="-1"></a><span class="co"># ?vegan::decostand</span></span>
<span id="cb205-1396"><a href="#cb205-1396" aria-hidden="true" tabindex="-1"></a><span class="co"># Repeat for carbon</span></span>
<span id="cb205-1397"><a href="#cb205-1397" aria-hidden="true" tabindex="-1"></a><span class="co"># repeat for carbon in ml.</span></span>
<span id="cb205-1398"><a href="#cb205-1398" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1399"><a href="#cb205-1399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1400"><a href="#cb205-1400" aria-hidden="true" tabindex="-1"></a>Run the RDA</span>
<span id="cb205-1401"><a href="#cb205-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1404"><a href="#cb205-1404" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-1405"><a href="#cb205-1405" aria-hidden="true" tabindex="-1"></a><span class="co"># rda_counts &lt;- rda(biotic_rda_standard_count ~ ., </span></span>
<span id="cb205-1406"><a href="#cb205-1406" aria-hidden="true" tabindex="-1"></a><span class="co">#                   data = metadata_normed_all)</span></span>
<span id="cb205-1407"><a href="#cb205-1407" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-1408"><a href="#cb205-1408" aria-hidden="true" tabindex="-1"></a><span class="co"># # ?rda()</span></span>
<span id="cb205-1409"><a href="#cb205-1409" aria-hidden="true" tabindex="-1"></a><span class="co"># # rda_counts</span></span>
<span id="cb205-1410"><a href="#cb205-1410" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(rda_counts)</span></span>
<span id="cb205-1411"><a href="#cb205-1411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb205-1412"><a href="#cb205-1412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-1415"><a href="#cb205-1415" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb205-1416"><a href="#cb205-1416" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb205-1417"><a href="#cb205-1417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>